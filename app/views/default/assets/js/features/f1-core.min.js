function haloSession(){this.data=new Object,this.set=function(key,val){return this.data[key]=val,this},this.get=function(key,def){return"undefined"==typeof this.data[key]?def:this.data[key]}}function __haloLoadScriptCb(){halo.location.hasGoogleScript=!0,halo.location.loadingScript=!1,halo.location.loadScriptCb.apply(this,halo.location.paramsCb);var _infoboxScript=document.createElement("script");_infoboxScript.type="text/javascript",_infoboxScript.src=halo_assets_url+"/js/infobox_packed.js",document.body.appendChild(_infoboxScript)}if("undefined"==typeof halo&&(halo={extend:function(obj){window.jQuery.extend(this,obj)}}),!halo_jax_targetUrl)var halo_jax_targetUrl="";if(!halo_assets_url)var halo_assets_url="";if(!$)var $=window.jQuery;jQuery(document).ready(function(){if(navigator.userAgent.match(/iPhone/i)){var viewportmeta=jQuery('meta[name="viewport"]');viewportmeta&&(jQuery(document.body).on("gesturestart",function(){viewportmeta.attr("content","width=device-width, minimum-scale=0, maximum-scale=10.0")}),jQuery(document.body).on("gesturechange",function(e){e.originalEvent.scale<=1&&viewportmeta.attr("content","width=device-width,minimum-scale=1.0,maximum-scale=1.0,initial-scale=1.0")}))}}),jQuery.extend(!0,halo,{log:function(msg){window.console&&console.log(msg)},ilog:function(msg){var log=jQuery("#gblog");log.length||(jQuery("body").append('<div id="gblog"></div>'),log=jQuery("#gblog")),log.append(msg+"\n"),log.scrollTop(log[0].scrollHeight)}}),"undefined"==typeof __halotext&&(__halotext=function(text){return"undefined"!=typeof haloTranslationJSON&&haloTranslationJSON&&haloTranslationJSON[text]?haloTranslationJSON[text]:text}),"undefined"==typeof __getGlobalMarkerIcon&&(__getGlobalMarkerIcon=function(type,cat){var iconBase=halo_assets_url+"/images/gmap_marker/",iconSet={"default":{icon:iconBase+"marker_default.png",iconHover:iconBase+"marker_default_hover.png"},shop:{cat_12:{icon:iconBase+"marker_shop_fashion.png",iconHover:iconBase+"marker_shop_fashion.png"},cat_23:{icon:iconBase+"marker_shop_computer.png",iconHover:iconBase+"marker_shop_computer.png"},cat_50:{icon:iconBase+"marker_shop_digital.png",iconHover:iconBase+"marker_shop_digital.png"},cat_3:{icon:iconBase+"marker_shop_realestate.png",iconHover:iconBase+"marker_shop_realestate.png"},cat_21:{icon:iconBase+"marker_shop_electronic.png",iconHover:iconBase+"marker_shop_electronic.png"},cat_24:{icon:iconBase+"marker_shop_vehicle.png",iconHover:iconBase+"marker_shop_vehicle.png"},cat_26:{icon:iconBase+"marker_shop_mombaby.png",iconHover:iconBase+"marker_shop_mombaby.png"},cat_25:{icon:iconBase+"marker_shop_food.png",iconHover:iconBase+"marker_shop_food.png"},cat_16:{icon:iconBase+"marker_shop_cellphone.png",iconHover:iconBase+"marker_shop_cellphone.png"},cat_67:{icon:iconBase+"marker_shop.png",iconHover:iconBase+"marker_shop_hover.png"},icon:iconBase+"marker_shop.png",iconHover:iconBase+"marker_shop_hover.png"},user:{cat_12:{icon:iconBase+"marker_user_fashion.png",iconHover:iconBase+"marker_user_fashion.png"},cat_23:{icon:iconBase+"marker_user_computer.png",iconHover:iconBase+"marker_user_computer.png"},cat_50:{icon:iconBase+"marker_user_digital.png",iconHover:iconBase+"marker_user_digital.png"},cat_3:{icon:iconBase+"marker_user_realestate.png",iconHover:iconBase+"marker_user_realestate.png"},cat_21:{icon:iconBase+"marker_user_electronic.png",iconHover:iconBase+"marker_user_electronic.png"},cat_24:{icon:iconBase+"marker_user_vehicle.png",iconHover:iconBase+"marker_user_vehicle.png"},cat_26:{icon:iconBase+"marker_user_mombaby.png",iconHover:iconBase+"marker_user_mombaby.png"},cat_25:{icon:iconBase+"marker_user_food.png",iconHover:iconBase+"marker_user_food.png"},cat_16:{icon:iconBase+"marker_user_cellphone.png",iconHover:iconBase+"marker_user_cellphone.png"},cat_67:{icon:iconBase+"marker_shop.png",iconHover:iconBase+"marker_shop_hover.png"},icon:iconBase+"marker_default.png",iconHover:iconBase+"marker_default_hover.png"}},icon={normal:iconSet["default"].icon,active:iconSet["default"].iconHover};return 1==type?"undefined"!=typeof iconSet.shop["cat_"+cat]&&(icon.normal=iconSet.shop["cat_"+cat].icon,icon.active=iconSet.shop["cat_"+cat].iconHover):0==type&&"undefined"!=typeof iconSet.user["cat_"+cat]&&(icon.normal=iconSet.user["cat_"+cat].icon,icon.active=iconSet.user["cat_"+cat].iconHover),icon}),jQuery.extend(!0,halo,{pushService:{init:function(){},sendUser:function(userid){socket.send(JSON.stringify({type:"user_id",data:userid}))}}}),jQuery.extend(!0,halo,{user:{getActive:function(){return 0},login:function(){var values=halo.util.getFormValues("loginForm"),_token=jQuery('#loginForm [name="_token"]').val();return jQuery('meta[name="csrf_token"]').attr("content",_token),halo.jax.call("user","Login",values),!1},showLogin:function(){halo.jax.call("user","ShowLogin","",document.URL)},showLoginToggle:function(ele){$e=jQuery(ele),$e.attr("data-htoggle","popover"),$e.attr("data-placement","bottom");var clickEveryWhere=($e.hpopover({html:!0,trigger:"click",delay:{show:100,hide:150},template:'<div class="popover"><div class="arrow"></div><div class="popover-content halo-login-wrapper"></div></div>',content:function(){var loadingDiv='<div data-halozone="halo-login-list" class="halo-login-loading">'+halo.template.getJaxLoading(2)+"</div>";return loadingDiv}}),function(e){0===jQuery(e.target).closest(".halo-login-wrapper").length&&$e.hpopover("toggle")}),pressEscapse=function(e){27===e.keyCode&&$e.hpopover("toggle")};$e.on("shown.bs.hpopover",function(){halo.jax.call("user","ShowLoginToggle",document.URL),jQuery(document).on("click",clickEveryWhere),jQuery(document).on("keydown",pressEscapse)}),$e.on("hide.bs.hpopover",function(){jQuery(document).off("click",clickEveryWhere),jQuery(document).off("keydown",pressEscapse)}),$e.hpopover("toggle")},setupSubmitLogin:function(){jQuery("#loginForm").submit(function(ev){ev.preventDefault(),halo.user.login()})},checkRegistrationRule:function(){jQuery("#halo-registration_rules").is(":checked")?jQuery("#halo-submit-registration").removeAttr("disabled"):jQuery("#halo-submit-registration").attr("disabled","disabled")},onRegistrationSubmit:function(form){var errorClasses="has-error has-feedback";return jQuery("#halo-registration_rules").is(":checked")?(jQuery(".halo-registration-rule-group").removeClass(errorClasses).find(".help-block").addClass("hide"),void jQuery(form).submit()):(jQuery(".halo-registration-rule-group").addClass(errorClasses).find(".help-block").removeClass("hide"),!1)},listStream:function(){},listAbout:function(){},displaySection:function(section,userid){var sectionWrapperSelector='[data-halozone="halo-'+section+'s-wrapper"]',$sectionContent=jQuery(sectionWrapperSelector),$sectionHeader=jQuery(".halo-section-heading",$sectionContent.parent());if(0==$sectionContent.children().length){if($sectionHeader.length&&jQuery(".filter_form",$sectionHeader).length)var form_id=jQuery(".filter_form",$sectionHeader).attr("id"),values=halo.util.getFormValues(form_id);else var values=halo.util.initFormValues();halo.util.setFormValue(values,"userid",userid),halo.util.setFormValue(values,"usec",section),halo.jax.call("user","DisplaySection",values)}},refreshSection:function(section,userid){var sectionWrapperSelector='[data-halozone="halo-'+section+'s-wrapper"]',$sectionContent=jQuery(sectionWrapperSelector);$sectionContent.children().remove(),halo.user.displaySection(section,userid)},showChangePassword:function(){halo.jax.call("user","ShowChangePassword")},changePassword:function(){var values=halo.util.getFormValues("popupForm");halo.jax.call("user","ChangePassword",values)},showChangeProfile:function(){halo.jax.call("user","ShowChangeProfile")},changeProfileType:function(ele){var profile_id=jQuery(ele).val();halo.jax.call("user","ChangeProfileType",profile_id)},changeRegisterProfileType:function(ele){var profile_id=jQuery(ele).val(),$hasProfile=jQuery('[name="has_profile"]');$hasProfile.val(""),$hasProfile.trigger("change"),halo.jax.call("user","ChangeProfileType",profile_id,function(){$profileFields=jQuery('[data-halozone="user_profile_edit"]');var $activeStep=jQuery("#registerForm .halo-wizard-step-title.active");$activeStep.length&&($profileFields.html().trim().length?$activeStep.next().removeClass("ignore"):$activeStep.next().addClass("ignore")),$hasProfile.val("1"),$hasProfile.trigger("change")})},changeProfile:function(){var values=halo.util.getFormValues("popupForm");halo.jax.call("user","ChangeProfile",values)},deleteUser:function(userId){halo.jax.call("admin,users","DeleteUser",userId)},deleteSelectedUser:function(){halo.util.getCheckedItem(halo.user.deleteUser)},deleteMe:function(){var values=halo.util.getFormValues("popupForm");halo.jax.call("user","DeleteMe",values)},setBadge:function(userId,badgeId,badgeType,content){var $badge=jQuery('.halo-user-list-wrapper [data-halo-userid="'+userId+'"] .halo-badge-wrapper');if($badge.length){var oldBadge=jQuery('[data-badge="'+badgeId+'"]',$badge);oldBadge.length?oldBadge.replaceWith(jQuery(halo.util.badge(badgeId,badgeType,content))):$badge.append(jQuery(halo.util.badge(badgeId,badgeType,content)))}},removeUserList:function(userId){var $user=jQuery('.halo-user-list-wrapper .halo-list-item-user[data-halo-userid="'+userId+'"]');$user.length&&$user.remove()},updateHaloMyId:function(userId){return"undefined"!=typeof userId?(halo_my_id=userId,halo_my_id):void 0},validateNewUser:function(){var $email=jQuery('#registerForm [name="email"]'),$username=jQuery('#registerForm [name="username"]');$username.val()&&$email.val()&&(halo.jax.session.set("formId","#registerForm"),halo.jax.call("user","ValidateNewUser",$email.val(),$username.val(),halo.user.validatePassword))},validatePassword:function(frm){frm||(frm="#registerForm");var form=jQuery(frm);if(form.length){var $password=form.find('[name="password"]'),$password_confirm=form.find('[name="password_confirmation"]');$password.val()&&$password.val()!==$password_confirm.val()?halo.template.setInputError($password_confirm,__halotext("Password miss matched")):halo.template.clearInputError($password_confirm)}}}}),jQuery.extend(!0,halo,{video:{displayShareVideo:function(title,description,embededPlayer,providerVid){jQuery('[name="video_title"]').val(title),jQuery('[name="video_description"]').val(description),jQuery('[name="video_vid"]').val(providerVid),embededPlayer=embededPlayer.length?embededPlayer:jQuery('<div class="text-center text-muted" style="padding-top:40%"><strong>'+__halotext("Unknown Video")+"</strong></div>"),jQuery(".halo-sharebox-embeded-player").html(embededPlayer)},validateForm:function(){jQuery("#status_form_video").valid()},remove:function(videoId,confirm){"undefined"==typeof confirm&&(confirm=0),halo.jax.call("video","RemoveVideo",videoId,confirm)},removeVideoUI:function(videoId){jQuery('[data-video-id="'+videoId+'"]').closest(".halo-list-wrapper-video").remove(),halo.popup.close()},init:function(scope){jQuery(".halo-video-popup",scope).each(function(){jQuery(this).haloMagnificPopup({delegate:"a",type:"iframe",tLoading:__halotext("Loading video #%curr%..."),mainClass:"mfp-img-mobile",iframe:{markup:'<div class="mfp-figure"><div class="halo-gallery-popup-content halo-video-popup-content" style="margin:0px;">   <div class="mfp-close"></div>   <div class="halo-gallery-body">       <div class="halo-gallery-left">           <div class="mfp-iframe-scaler"><iframe class="mfp-iframe" frameborder="0" allowfullscreen></iframe><div class="clearfix"></div></div>           <div class="mfp-bottom-bar clearfix"></div>       </div>       <div class="halo-gallery-right">           <div class="halo-gallery-right-container">               <div class="container-fluid halo-gallery-right-wrapper">           </div>       </div>   </div>   <div class="clearfix"></div>   </div></div></div>',patterns:{youtube:{index:"youtube.com/",id:"v=",src:"//www.youtube.com/embed/%id%?autoplay=1"},youtube_short:{index:"youtu.be/",id:"youtu.be/",src:"//www.youtube.com/embed/%id%?autoplay=1"},vimeo:{index:"vimeo.com/",id:"/",src:"//player.vimeo.com/video/%id%?autoplay=1"},dailymotion:{index:"dailymotion.com",id:function(url){var m=url.match(/^.+dailymotion.com\/(video|hub)\/([^_]+)[^#]*(#video=([^_&]+))?/);return null!==m?void 0!==m[4]?m[4]:m[2]:null},src:"http://www.dailymotion.com/embed/video/%id%"}},srcAction:"iframe_src"},callbacks:{change:function(){},open:function(){var context="video",videoId=this.currItem.el.data("video-id"),$wrapper=jQuery(".halo-gallery-right",".halo-video-popup-content").find("div.halo-gallery-right-wrapper");$wrapper.attr("data-halozone","popup_comment."+context+"."+videoId),halo.jax.call("video","LoadPopupContent",videoId)}}})})}}}),jQuery.extend(!0,halo,{photo:{nThumbPerCarousel:5,changeAvatar:function(context,userId){halo.jax.call("photo","ShowEditAvatarForm",context,userId)},saveAvatar:function(context,userId){var values=halo.util.getFormValues("popupForm");halo.jax.call("photo","SaveAvatar",context,userId,values)},changeCover:function(context,userId){halo.jax.call("photo","ShowEditCoverForm",context,userId)},saveCover:function(context,userId){var values=halo.util.getFormValues("popupForm");halo.jax.call("photo","SaveCover",context,userId,values)},remove:function(photoId,confirm){"undefined"==typeof confirm&&(confirm=0),halo.jax.call("photo","RemovePhoto",photoId,confirm)},removePhotoUI:function(photoId){jQuery('[data-photo-id="'+photoId+'"]').parent().remove(),halo.popup.close()},initCarousel:function(scope){jQuery(document).trigger("initCarousel",[scope]),jQuery(".halo-thumb-carousel",scope).each(function(){var $esCarousel=jQuery(this),$items=$esCarousel.find("ul > li"),options=jQuery(this).data(),defaults={mode:"carousel",showModes:1,current:0};options=jQuery.extend(defaults,options);var current=options.current,_showItem=function($item){var $esCarousel=$item.closest(".halo-thumb-carousel"),$items=$esCarousel.find("ul > li"),$oldItem=$items.filter(".selected");$items.removeClass("selected"),$item.addClass("selected"),$esCarousel.elastislide("setCurrent",$item.index()),$esCarousel.trigger("rg:shownItem",[$item,$oldItem])};$esCarousel.elastislide({imageW:128,minItems:3,onClick:function($item){_showItem($item)}}),$esCarousel.elastislide("setCurrent",current),_showItem($items.eq(current))})},initGallery:function(scope){var selector=".rg-gallery";void 0!==jQuery(scope).find(selector).attr("id"),jQuery(selector,scope).each(function(){var $rgGallery=jQuery(this),$esCarousel=jQuery("div.es-carousel-wrapper",$rgGallery),$items=$esCarousel.find("ul > li"),itemsCount=$items.length,options=jQuery(this).data(),defaults={mode:"carousel",showModes:1,current:0};options=jQuery.extend(defaults,options);var current=options.current,mode=options.mode,anim=!1,init=function(){(options.showModes||"fullview"==mode)&&$items.add('<img src="'+halo_assets_url+'/images/ajax-loader.gif"/><img src="'+halo_assets_url+'/images/black.png"/>').imagesLoaded(function(){options.showModes&&_addViewModes(),_addImageWrapper(),_showImage($items.eq(current))}),_initCarousel()},_initCarousel=function(){$esCarousel.elastislide({imageW:128,minItems:3,onClick:function($item){anim=!0,"fullview"==mode?_showImage($item):_popupImage($item),current=$item.index()}}),$esCarousel.elastislide("setCurrent",current),_setViewMode(mode)},_setViewMode=function(mode){$rgGallery.removeClass(function(index,css){return(css.match(/\brg-mode-\S+/g)||[]).join(" ")}),$rgGallery.addClass("rg-mode-"+mode)},_addViewModes=function(){var $viewfull=jQuery('<a href="#" class="rg-view-full halo-btn halo-btn-default halo-btn-xs halo-btn-nobg" title="'+__halotext("gallery view")+'"><i class="fa fa-square"></i>Fullview</a>'),$viewthumbs=jQuery('<a href="#" class="rg-view-thumbs halo-btn halo-btn-default halo-btn-xs halo-btn-nobg" title="'+__halotext("thumbnail view")+'"><i class="fa fa-th-list"></i>Thumbview</a>');"fullview"==mode?$viewfull.addClass("rg-view-selected"):$viewthumbs.addClass("rg-view-selected"),$rgGallery.prepend(jQuery('<div class="rg-view"/>').append($viewfull).append($viewthumbs)),$viewfull.bind("click.rgGallery",function(event){return $esCarousel.elastislide("destroy"),_initCarousel(),$viewfull.addClass("rg-view-selected"),$viewthumbs.removeClass("rg-view-selected"),mode="fullview",_setViewMode(mode),!1}),$viewthumbs.bind("click.rgGallery",function(event){return $esCarousel.elastislide("destroy"),_initCarousel(),$viewthumbs.addClass("rg-view-selected"),$viewfull.removeClass("rg-view-selected"),mode="carousel",_setViewMode(mode),!1})},_addImageWrapper=function(){var $navPrev=$rgGallery.find("a.rg-image-nav-prev"),$navNext=$rgGallery.find("a.rg-image-nav-next"),$imgWrapper=$rgGallery.find("div.rg-image");$navPrev.bind("click.rgGallery",function(event){return _navigate("left"),!1}),$navNext.bind("click.rgGallery",function(event){return _navigate("right"),!1}),$esCarousel.data("carousel").itemsCount<2&&($navPrev.hide(),$navNext.hide()),$imgWrapper.touchwipe({wipeLeft:function(){_navigate("right")},wipeRight:function(){_navigate("left")},preventDefaultEvents:!1}),jQuery(document).bind("keyup.rgGallery",function(event){39==event.keyCode?_navigate("right"):37==event.keyCode&&_navigate("left")})},_navigate=function(dir){return anim?!1:(anim=!0,"right"===dir?current+1>=itemsCount?current=0:++current:"left"===dir&&(0>current-1?current=itemsCount-1:--current),_showImage($items.eq(current)),void halo.lazyload.loadImages())},_popupImage=function($item){var photoId=jQuery("[data-photo-target]",$item).attr("data-photo-target"),$wrapper=$item.closest(".es-carousel-wrapper"),$targetPhoto=jQuery('[data-photo-id="'+photoId+'"]',$wrapper);$targetPhoto.click(),anim=!1};_showImage=function($item){var $esCarousel=$item.closest(".es-carousel-wrapper"),$rgGallery=$item.closest(selector),$items=$esCarousel.find("ul > li"),$loader=$rgGallery.find("div.rg-loading").show(),$oldItem=$items.filter(".selected");$items.removeClass("selected"),$item.addClass("selected");var $thumb=$item.find("img"),largesrc=$thumb.data("large"),title=$thumb.data("description");"undefined"!=typeof largesrc?jQuery("<img/>").load(function(){var image=jQuery('<a href="'+largesrc+'"><img src="'+largesrc+'"/></a>');"fullview"==mode&&image.on("click",function(e){return _popupImage($item),e.preventDefault(),!1}),$rgGallery.find("div.rg-image").empty().append(image),title&&$rgGallery.find("div.rg-caption").show().children("p").empty().text(title),$loader.hide(),"fullview"===mode&&($esCarousel.elastislide("reload"),$esCarousel.elastislide("setCurrent",current)),anim=!1}).attr("src",largesrc):($loader.hide(),$esCarousel.elastislide("reload"),$esCarousel.elastislide("setCurrent",current),anim=!1),$rgGallery.trigger("rg:shownItem",[$item,$oldItem])},init()})},init:function(scope){halo.photo.initGallery(scope),halo.photo.initCarousel(scope),jQuery(".halo-gallery-popup",scope).each(function(){jQuery(this).haloMagnificPopup({delegate:"a",type:"image",tLoading:__halotext("Loading image #%curr%..."),mainClass:"mfp-img-mobile",gallery:{enabled:!0,navigateByImgClick:!0,preload:[1,1]},image:{markup:'<div class="mfp-figure"><div class="halo-gallery-popup-content" style="margin:0px;">	<div class="mfp-close"></div>	<div class="halo-gallery-body">	<div class="halo-gallery-left">		<div class="mfp-img"></div>		<div class="halo-photo-tags"></div>		<div class="mfp-bottom-bar clearfix">			<div class="mfp-title halo-pull-left"></div>			<div class="mfp-counter halo-pull-left"></div>			<div class="halo-photo-actions halo-pull-left" data-halozone="halo-photo-actions">			</div>		</div>	</div>	<div class="halo-gallery-right">		<div class="halo-gallery-right-container">			<div class="container-fluid halo-gallery-right-wrapper">			</div>		</div>	</div>   <div class="clearfix"></div>	</div></div></div>',tError:__halotext('<a href="%url%">The image #%curr%</a> could not be loaded.'),titleSrc:function(item){return item.el.attr("title")}},callbacks:{change:function(){},buildControls:function(){"undefined"!=typeof this.arrowLeft&&this.arrowLeft&&"undefined"!=typeof this.arrowRight&&this.arrowRight&&jQuery(".halo-gallery-left",this.contentContainer).append(this.arrowLeft.add(this.arrowRight))},imageLoadComplete:function(){var photoId=this.currItem.el.data("photo-id"),context="photo";halo.photo.doneTagging(),jQuery(".halo-photo-tag").remove(),halo.photo.currentTagging.photoId=photoId;var wrapper=jQuery(".halo-gallery-right").find("div.halo-gallery-right-wrapper");wrapper.attr("data-halozone","popup_comment."+context+"."+photoId),halo.jax.call(context,"LoadPopupContent",photoId)},open:function(){jQuery(".halo-gallery-left").touchwipe({wipeLeft:function(){jQuery(".mfp-arrow-left").trigger("click")},wipeRight:function(){jQuery(".mfp-arrow-right").trigger("click")},preventDefaultEvents:!1})}}})})},initUploadBtn:function(selector,holderSelector){var uploaderId="photoUploader",holder=(jQuery(selector).attr("id","plupload-browse-button-"+uploaderId),jQuery(holderSelector).attr("id","halo-plupload-upload-ui-"+uploaderId).addClass("halo-uploader-holder"));halo.uploader.uploader_init(jQuery,holder,jQuery.extend({photoWidth:0,photoHeight:0,uploaderId:uploaderId},halo.uploader.progressOnlyOption))},updateEditingPhoto:function(selector,photoId,src){{var $container=jQuery(selector),$image=jQuery("img.img-dragtoedit",$container),$zoom=jQuery('[name="photoZoom"]',$container),$top=jQuery('[name="photoTop"]',$container),$left=jQuery('[name="photoLeft"]',$container),$photoId=(jQuery('[name="photoWidth"]',$container),jQuery('[name="photoId"]',$container));jQuery(".halo-photo-view-port-wrap",$container)}$photoId.val(photoId),jQuery('[href="#halo-popup-upload2edit-photo"]').htab("show"),$top.val(0),$left.val(0),$zoom.val(100),$image.attr("src",src),halo.photo.startEdit(selector),$zoom.slider("setValue",100)},startEdit:function(selector){var $container=jQuery(selector),$image=jQuery("img.img-dragtoedit",$container),$zoom=jQuery('[name="photoZoom"]',$container),$top=jQuery('[name="photoTop"]',$container),$left=jQuery('[name="photoLeft"]',$container),$width=jQuery('[name="photoWidth"]',$container),$viewport=(jQuery('[name="photoId"]',$container),jQuery(".halo-photo-view-port-wrap",$container));$image.off("load"),$image.one("load",function(){var minZoom;$image.css("top",$top.val()+"px").css("left",$left.val()+"px").css("width",parseInt($zoom.val())+"%");var viewportRatio=$viewport.data("viewport-ratio"),ratioParts=viewportRatio.split(":");2==ratioParts.length&&$viewport.height(Math.round($viewport.width()*parseInt(ratioParts[1])/parseInt(ratioParts[0]))),$width.val($viewport.width()),$viewport.height()>$image.height()?(minZoom=Math.floor(parseFloat($zoom.val())*($viewport.height()/$image.height()))+1,$zoom.val(minZoom),$image.css("width",parseInt($zoom.val())+"%")):minZoom=100,$image.draggable({drag:function(event,ui){var minTop=$viewport.height()-$image.height(),minLeft=$viewport.width()-$image.width();ui.position.top>0&&(ui.position.top=0),ui.position.left>0&&(ui.position.left=0),ui.position.top<minTop&&(ui.position.top=minTop),ui.position.left<minLeft&&(ui.position.left=minLeft)},stop:function(event,ui){$top.val(ui.position.top),$left.val(ui.position.left)}}),$zoom.slider({min:minZoom,max:minZoom+200,value:parseInt($zoom.val())}).on("slide",function(){var zoomVal=$zoom.val()+"%";$image.css({width:zoomVal});var remainingWidth=$image.position().left+$image.width(),remainingHeight=$image.position().top+$image.height();remainingWidth<$viewport.width()&&$image.css({left:$image.position().left+($viewport.width()-remainingWidth)+"px"}),remainingHeight<$viewport.height()&&$image.css({top:$image.position().top+($viewport.height()-remainingHeight)+"px"})}).on("slideStop",function(){var zoomVal=$zoom.val()+"%";$image.css({width:zoomVal})}),jQuery("[data-halo-photo-upload-btn]",$container).on("uploader.uploadSuccess",function(event,photo){"undefined"==typeof photo.error&&"undefined"!=typeof photo.image&&halo.photo.updateEditingPhoto($container,photo.id,photo.image)}),$image.css("visibility","")}).each(function(){this.complete&&jQuery(this).load()})},changeAlbumListing:function(albumId){halo.jax.call("photo","ChangeAlbumListing",albumId)},showAlbumPhotos:function(albumId){halo.jax.cancelRequests();var userId=jQuery('[data-halo-pagination] [name="userid"]').first().val();halo.jax.call("photo","ShowAlbumPhotos",albumId,userId)},showUserAlbums:function(userId){jQuery('[data-halozone="halo-albums-wrapper"]').html("");var values=halo.util.initFormValues();halo.util.setFormValue(values,"userid",userId),halo.util.setFormValue(values,"usec","album"),halo.jax.call("user","DisplaySection",values)},showAlbumListing:function(){halo.jax.call("photo","ShowAlbumListing")},editAlbumForm:function(albumId){"undefined"==typeof albumId&&(albumId=0),halo.popup.setConfirmClosing(function(){var confirmation=halo.util.validateDataConfirmation(".halo-popup-content");return confirmation.message=__halotext("You have unsaved changes. Are you sure you want to continue?"),confirmation.success||confirmation.input.closest(".form-album").addClass("has-error"),confirmation}),halo.jax.call("photo","EditAlbumForm",albumId)},saveAlbum:function(){var values=halo.util.getFormValues("popupForm");halo.jax.call("photo","SaveAlbum",values)},deleteAlbum:function(albumId){var values=halo.util.getFormValues("popupForm");halo.util.setFormValue(values,"albumid",albumId),halo.jax.call("photo","DeleteAlbum",values)},selectListingPhoto:function(photoId){halo.jax.call("photo","selectListingPhoto",photoId)},initTagForm:function(){var tagForm=jQuery('<form id="halo_photo_tags"></form>'),tagInput=jQuery('<input id="photo_tag_input" type="text" name="photo_tag_user"></input>');tagForm.append(tagInput)},clearTagInput:function(){jQuery(".halo-photo-tag-input").remove()},initTagInput:function(){function suggestionTemplate(context){return Hogan.compile('<p class="name"><image class="halo-suggestion-img" src={{image}}>{{name}}</p>').render(context)}function onTaggingUser(e,datum){halo.photo.addTag(datum.id),halo.photo.resetTagging()}var container=jQuery('<div class="halo-photo-tag-input"></div>'),input=jQuery('<input class="" type="text" name="photo_tag_user"/>');container.append(input);var users=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:halo.util.mergeUrlParams(halo_jax_targetUrl,{term:"%QUERY",com:"autocomplete",func:"searchUsers",csrf_token:jQuery('meta[name="csrf_token"]').attr("content")}),beforeSend:function(jqXhr,settings){return settings.data=JSON.stringify({com:"autocomplete",func:"searchUsers",csrf_token:jQuery('meta[name="csrf_token"]').attr("content")}),!0}}});return users.initialize(),input.typeahead({highlight:!0},{name:"taggedusers",displayKey:"name",source:users.ttAdapter(),templates:{empty:'<div class="halo-users-not-found text-center">'+__halotext("No User Matched")+"</div>",suggestion:suggestionTemplate},engine:Hogan}).on("typeahead:selected",onTaggingUser).on("typeahead:autocompleted",onTaggingUser),container},addTag:function(userId){var area=halo.photo.currentTagging.area,photoId=halo.photo.currentTagging.photoId,img=halo.photo.currentTagging.img,startPos=halo.photo.mapImageCoord(area.x1,area.y1,img,!1),endPos=halo.photo.mapImageCoord(area.x2,area.y2,img,!1),x1=startPos.x,y1=startPos.y,x2=endPos.x,y2=endPos.y;"undefined"!=typeof area&&halo.jax.call("photo","AddTag",photoId,userId,x1,y1,x2,y2)},removeTag:function(userId){var photoId=halo.photo.currentTagging.photoId;halo.jax.call("photo","RemoveTag",photoId,userId)},currentTagging:{},showTag:function(username,userId,x1,y1,x2,y2,removable){var $tagsContainer=jQuery(".halo-photo-tags"),tagHtml=jQuery('<div class="halo-photo-tag" data-tag-userid="'+userId+'"></div>'),removeTagHtml="true"==removable?'<a href="javascript:void(0)" title="'+__halotext("Remove Tag")+'" onclick="halo.photo.removeTag(\''+userId+'\')" class="halo-photo-tag-remove"><i class="fa fa-times"></i></a>':"",tagName=jQuery('<div class="halo-photo-tag-name">'+username+removeTagHtml+"</div>");tagHtml.append(tagName),$tagsContainer.append(tagHtml);var img=jQuery(".halo-gallery-left > img"),startPos=halo.photo.mapImageCoord(x1,y1,img,!0),endPos=halo.photo.mapImageCoord(x2,y2,img,!0);tagHtml.css("top",startPos.y+"px").css("left",startPos.x+"px").css("height",endPos.y-startPos.y).css("width",endPos.x-startPos.x);var tagUserName=jQuery('<span class="halo-tagged-user" data-halo-userid="'+userId+'">'+username+"</span>");jQuery(".halo-gallery-right .halo-tagged-users-wrapper").removeClass("hidden"),jQuery(".halo-gallery-right .halo-tagged-users-wrapper").append(tagUserName),jQuery("a",tagUserName).hover(function(){tagHtml.addClass("active")},function(){tagHtml.removeClass("active")})},showTagObject:function(tagData){halo.photo.showTag(tagData.username,tagData.userId,tagData.x1,tagData.y1,tagData.x2,tagData.y2,tagData.removable)},clearTag:function(userId){jQuery('[data-tag-userid="'+userId+'"]').remove(),jQuery('.halo-tagged-user[data-halo-userid="'+userId+'"]').remove()},startTagging:function(){jQuery(".halo-photo-end-tagging").hasClass("hidden")&&jQuery(".halo-photo-tag-btn").toggleClass("hidden"),jQuery(".halo-gallery-left .mfp-img").imgAreaSelect({handles:!0,parent:".halo-gallery-left",onSelectStart:function(){halo.photo.clearTagInput()},onSelectEnd:function(img,area){halo.photo.clearTagInput(),halo.photo.currentTagging.img=img,halo.photo.currentTagging.area=area;var tagInput=halo.photo.initTagInput();jQuery(img).after(tagInput),jQuery(".imgareaselect-outer").remove(),tagInput.css("position","absolute").css("top",area.y2+10).css("left",area.x1).css("z-index",2e3).css("width","150px").focus()}}).on("click.halotagging",function(e){e.stopPropagation()})},doneTagging:function(){jQuery(".halo-photo-begin-tagging").hasClass("hidden")&&jQuery(".halo-photo-tag-btn").toggleClass("hidden"),halo.photo.clearTagInput(),jQuery(".imgareaselect-selection").parent("div").remove(),jQuery(".halo-gallery-left .mfp-img").imgAreaSelect({remove:!0}).off("click.halotagging")},resetTagging:function(){halo.photo.clearTagInput(),jQuery(".imgareaselect-selection").parent("div").css("top",-9999)},mapImageCoord:function(x,y,img,toViewPort){var $img=jQuery(img),paddingTop=parseInt($img.css("padding-top")),paddingLeft=parseInt($img.css("padding-left"));if(0==$img.length)return{x:null,y:null};var nSize=halo.util.getImageNatureSize($img),vWidth=$img.width(),vHeight=$img.height(),xRatio=toViewPort?vWidth/nSize.width:nSize.width/vWidth,yRatio=toViewPort?vHeight/nSize.height:nSize.height/vHeight;return toViewPort?{x:Math.floor(x*xRatio)+paddingLeft,y:Math.floor(y*yRatio)+paddingTop}:{x:Math.floor((x-paddingLeft)*xRatio),y:Math.floor((y-paddingTop)*yRatio)}}}}),jQuery.extend(!0,halo,{follower:{follow:function(context,target_id){halo.jax.call("follower","Follow",context,target_id)},unfollow:function(context,target_id){halo.jax.call("follower","UnFollow",context,target_id)}}}),jQuery.extend(!0,halo,{friend:{sendRequest:function(userId){halo.jax.call("friend","SendFriendRequest",userId)},approveRequest:function(userId,refresh){return"undefined"==typeof refresh&&(refresh=0),halo.jax.call("friend","ApproveRequest",userId,refresh),window.event.stopPropagation(),!1},rejectRequest:function(userId,refresh){return"undefined"==typeof refresh&&(refresh=0),halo.jax.call("friend","RejectRequest",userId,refresh),window.event.stopPropagation(),!1},unFriend:function(userId){var values=halo.util.initFormValues();halo.util.setFormValue(values,"user_id",userId),halo.util.setFormValue(values,"url",location.href),halo.jax.call("friend","UnFriend",values)}}}),jQuery.extend(!0,halo,{websocket:{inited:!1,init:function(){if(halo.websocket.inited)return!0;if("undefined"==typeof halo_my_id||0==halo_my_id||"undefined"==typeof halo_feature_push||0==halo_feature_push)return!0;try{var serverAddr=halo_socket_address,socket=io.connect(serverAddr,{reconnection:!1});socket.on("open",function(){console.info("Socket is now opened.")}),socket.on("updater",function(data){halo.updater.start("",!0,data.message,data.params);

}),socket.emit("user",{userid:halo_my_id,host:window.location.hostname}),socket.on("close",function(){console.info("Socket is now closed.")}),socket.on("connect_error",function(obj){400==obj.description&&halo.log("Socket.io reported a generic error"),halo.updater.pushserver}),socket.on("connect_timeout",function(){halo.log("Connection timeout")}),socket.on("disconnect",function(){halo.log("Socket.io disconected")}),window.socket=socket,halo.websocket.inited=!0,halo.updater.pushserver=!0}catch(e){halo.log("exception: "+e)}}}}),jQuery.extend(!0,halo,{lang:function(){for(var str=arguments[0],i=1;i<arguments.length;i++)str=str.replace("%s",arguments[i]);return str}}),jQuery.extend(!0,halo,{init:function(scope){"function"==typeof halo.template.init&&halo.template.init.apply(this,[scope]);for(feature in halo)if("template"!==feature&&"function"==typeof halo[feature].init)try{halo[feature].init.apply(this,[scope])}catch(err){halo.log(err)}jQuery(document).trigger("afterHALOInit",scope)}}),jQuery.extend(!0,halo,{updater:{inited:!1,interval:1e4,pushserver:!1,lastUpdate:0,init:function(scope){halo.updater.inited||(setTimeout(function(){halo.updater.start(scope)},halo.updater.interval),halo.updater.inited=!0)},start:function(scope,noRepeat,features,params){var rules=[];"string"==typeof features&&features.length>0&&(features=features.split(" "));for(feature in halo)if("function"==typeof halo[feature].updater&&("undefined"==typeof features||0==features.length||features.indexOf(feature)>=0)){var rule=halo[feature].updater.apply(this,[scope,params]);"undefined"!=typeof rule&&rules.push(rule)}if(rules.length){var d=new Date,t=d.getTime(),delta=15e3;if(halo.updater.lastUpdate+delta<t||noRepeat){var params=["system","UpdateContent"];params=params.concat(rules),halo.jax.call.apply(this,params),halo.updater.lastUpdate=t}}1==halo.updater.pushserver,"undefined"!=typeof noRepeat&&1==noRepeat||setTimeout(function(){halo.updater.start("")},halo.updater.interval)},setInterval:function(interval){halo.updater.interval=parseInt(interval)||halo.updater.interval}}}),jQuery.extend(!0,halo,{util:{incomplete:!1,jsonData:{},init:function(scope){jQuery("[data-dropdown-target] a",scope).click(function(e){e.preventDefault();var ancestor=jQuery(this).parents("[data-dropdown-target]"),id=ancestor.attr("id"),label=jQuery(this).html(),input_target=jQuery('[data-dropdown-input="'+id+'"]'),val=jQuery(this).data("value"),button_target=jQuery('[data-dropdown="'+id+'"]');input_target.val(val),button_target.html(label).trigger("click")}),halo.util.onInputChanges({eventType:"change.halo.post keyup.halo.post",container:".halo-data-confirm-wrapper",selector:"[data-confirm]",handler:function(evt){var validator=halo.util.validateDataConfirmation(".halo-data-confirm-wrapper");halo.util.incomplete=!validator.success,halo.util.dataConfirm=validator}}),halo.util.bindShowLeaving(),jQuery(".haloj-ellipsis",scope).each(function(){var $this=jQuery(this);if(!$this.data("initedEllipsis")){var height=$this.data("height")||100;if($this.css("display","block"),$this.css("max-height",height),$this.css("overflow","hidden"),this.offsetHeight<this.scrollHeight){$this.addClass("haloj-truncated");var url=$this.data("link"),blank="",text="";url?(url+=url.indexOf("?")>=0?"&read_more=1":"?read_more=1",blank='target="_blank"',text=__halotext("Continue reading")):(url="javascript:void(0)",blank="",text=__halotext("See more"));var readMore=jQuery('<a class="haloj-readmore-btn haloj-readmore" href="'+url+'" '+blank+">"+text+"</a>");readMore.insertAfter($this),jQuery('<div class="haloj-readmore-wrapper">').append(readMore).insertAfter($this),readMore.data("target",$this),$this.data("link")||readMore.on("click",function(){var $this=jQuery(this),$target=$this.data("target");if($this.toggleClass("haloj-readmore"),$this.hasClass("haloj-readmore")){var scrollTop=jQuery(document).scrollTop(),height=$target.data("height")||100,realHeight=$target[0].offsetHeight;$target.css("max-height",height),$this.text(__halotext("See more")),jQuery(document).scrollTop(scrollTop-(realHeight-height))}else $target.css("max-height","none"),$this.text(__halotext("See less"))})}$this.data("initedEllipsis",!0)}})},lang:function(str){return str},addSlashes:function(str){return(str+"").replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")},getFormValues:function(frm){var objForm;("string"==typeof frm||frm instanceof String)&&(objForm=jQuery("#"+frm)),objForm&&objForm.length||(objForm=jQuery(frm));var disabled=objForm.find(":input:disabled").removeAttr("disabled"),frmValue=objForm.serializeArray(),selector="input:checkbox:not(:checked)",checkbox=objForm.find(selector);checkbox.length&&jQuery(selector).each(function(){frmValue.push({name:this.name,value:"0"})}),disabled.attr("disabled","disabled"),frmValue=halo.util.serializeObject(frmValue);var formId=objForm.attr("id");formId&&halo.jax.startSession().set("formId","#"+formId),rtn={form:frmValue};var ignoreInput=objForm.find(".ignore-input");ignoreInput.each(function(){var key=jQuery(this).attr("name");key&&halo.util.deleteFormKey(rtn,key)});var ignoreInput=objForm.find(".not-empty-input");return ignoreInput.each(function(){var key=jQuery(this).attr("name");if(key){var val=halo.util.getFormValue(rtn,key);val||halo.util.deleteFormKey(rtn,key)}}),rtn},initFormValues:function(){return{form:{}}},setFormValue:function(frm,key,val){"undefined"!=typeof frm.form&&(frm.form[key]=val)},extendFormValues:function(frmA,frmB){return frmA.form=jQuery.extend(frmA.form,frmB.form),frmA},deleteFormKey:function(frm,key){"undefined"!=typeof frm.form&&delete frm.form[key]},getFormValue:function(frm,key){return"undefined"!=typeof frm.form?frm.form[key]:void 0},getFormParams:function(frm){var objForm,formId="#"+frm;objForm=jQuery("#"+frm);var disabled=objForm.find(":input:disabled").removeAttr("disabled"),frmValue=jQuery(formId).serializeArray(),selector=formId+" input:checkbox:not(:checked)",checkbox=jQuery(selector);checkbox.length&&jQuery(selector).each(function(){frmValue.push({name:this.name,value:"0"})}),disabled.attr("disabled","disabled");var params={};return jQuery.each(frmValue,function(){params[this.name]=this.value}),params},resetFormValues:function(frm){var objForm;objForm=jQuery("#"+frm),objForm.find("[data-resetable], .data-resetable").each(function(){jQuery(this).val(""),jQuery(this).trigger("change"),jQuery(this).trigger("halo.onreset")}),objForm.find(":input").each(function(){var input=jQuery(this);halo.template.clearInputError(input)})},serializeObject:function(a){var o={};return a instanceof Array&&jQuery.each(a,function(){halo.util.parseInputName(o,this.name,this.value)}),o},parseInputName:function(o,param,val){var pos=param.indexOf("["),$currentKey=null,arr=[];if(pos>0){var key=param.substr(0,pos);arr.push(key);for(var i=pos,c=param.length;c>i;i++){var $char=param.charAt(i);if("["===$char){if(null!==$currentKey)return;$currentKey=""}else if("]"===$char)arr.push(null===$currentKey?"":$currentKey),$currentKey=null;else{if(null===$currentKey)return;$currentKey=$currentKey.concat($char)}}}else arr.push(param);for(var ref=o;arr.length;){var key=arr.shift();if(0==key.length){key=-1;for(var p in ref){var c=parseInt(p);key=c>key?c:key}key++}"undefined"==typeof ref[key]&&(ref[key]={}),0==arr.length?ref[key]=val:(jQuery.isPlainObject(ref[key])||(ref[key]={}),ref=ref[key])}return o},getCheckedItem:function(){callback=arguments[0];var checked=[];return jQuery("input[name='cid[]']:checked").each(function(){checked.push(parseInt(jQuery(this).val()))}),0==checked.length?alert(__halotext("No items selected")):callback&&"function"==typeof callback&&(arguments[0]=checked,callback.apply({},arguments)),checked},reload:function(){location.reload()},back:function(){location.href=document.referrer},redirect:function(url){location.href=url},reloadWithParam:function(params){var currParams=halo.util.getCurrentQueryObj();newParams=jQuery.extend({},currParams,params),window.location.search="?"+jQuery.param(newParams)},prettyUrl:function(url){return url=url.replace(/%2C|%2c/g,",").replace(/%3A/g,":").replace(/%5B/g,"[").replace(/%5D/g,"]").replace(/%25/g,"%")},mergeUrlParams:function(url,params){var parser=document.createElement("a");parser.href=url;var origParams=halo.util.getQueryObj(url),newParams=jQuery.extend({},origParams,params),newUrl=parser.protocol+"//"+parser.host+parser.pathname+"?"+jQuery.param(newParams);return halo.util.prettyUrl(newUrl)},setUrl:function(newUrl){newUrl=halo.util.prettyUrl(newUrl),newUrl!=document.URL&&history&&history.pushState&&history.pushState({},document.title,newUrl)},setUrlParam:function(params,currParams){if(history&&history.pushState){"undefined"==typeof currParams&&(currParams=halo.util.getCurrentQueryObj());var newParams=jQuery.extend({},currParams,params);for(var p in newParams)null!==newParams[p]&&newParams[p].length||delete newParams[p];var newUrl="//"+location.host+location.pathname+"?"+jQuery.param(newParams);newUrl=halo.util.prettyUrl(newUrl),history.pushState({},document.title,newUrl)}},getCurrentQueryObj:function(){if(""!=location.search){var params=halo.util.getQueryObj(location.href);return params}return{}},getQueryObj:function(url){var index=url.indexOf("?");if(-1!=index){var uri=decodeURIComponent(url.substring(index+1));uri=uri.replace(/\+/g," ");for(var chunks=uri.split("&"),params=Object(),i=0;i<chunks.length;i++){var chunk=chunks[i].split("=");-1!==chunk[0].search("\\[\\]")?"undefined"==typeof params[chunk[0]]?params[chunk[0]]=[chunk[1]]:params[chunk[0]].push(chunk[1]):params[chunk[0]]=chunk[1]}return params}return{}},setSystemError:function(msg){halo.util.setSystemMessage(msg,"error")},setRedirectMessage:function(msg,msgType){halo.storage.setDn("redirectMessage",{msg:msg,msgType:msgType})},scriptCall:function(func,data){var scr=func+"(";if(jQuery.isArray(data)){data[0]=(""+data[0]).replace(/\\\"/g,'"'),scr+="(data[0])";for(var l=1;l<data.length;l++)data[l]=(""+data[l]).replace(/\\\"/g,'"'),scr+=",(data["+l+"])"}else scr+="data";scr+=");",eval(scr)},scriptJsonCall:function(func,data){var data=data,scr=func+"(data)";eval(scr)},getRedirectMessage:function(){var data=halo.storage.getDn("redirectMessage");"undefined"!=typeof data&&data&&(halo.util.setSystemMessage(data.msg,data.msgType),halo.storage.deleteDn("redirectMessage"))},setSystemMessage:function(msg,msgType){if(msg.length){switch(msgType){case"message":msgType="info";break;case"error":msgType="warning"}if(halo.popup.isOpen())halo.popup.setMessage(msg,msgType);else{var msgDiv=jQuery('<div class="alert alert-'+msgType+'"><button type="button" class="close" data-dismiss="alert">&times;</button>'+msg+"</div>");jQuery("#halo-system-message-container").length||jQuery("body").append(jQuery('<div id="halo-system-message-container" class="halo-system-error">')),jQuery("#halo-system-message-container").append(msgDiv),msgDiv.fadeOut(6e3,function(){jQuery(this).remove()})}}},matchHeight:function(){jQuery("[data-match-height]").each(function(){var slaveCols=(jQuery(this),jQuery(this).find("[data-height-watch-slave]")),masterCols=jQuery(this).find("[data-height-watch-master]"),masterHeights=masterCols.map(function(){return jQuery(this).height()}).get(),tallestMaster=Math.max.apply(Math,masterHeights);slaveCols.each(function(){var $this=jQuery(this);$this.css("height",tallestMaster-80)})})},updatePageTitle:function(title){document.title=title},updateElapsedTime:function(){jQuery("[data-utime]").each(function(){var timestamp=jQuery(this).data("utime"),date=new Date(1e3*timestamp),now=new Date,timediff=Math.abs(now-date),elapsedStr=halo.util.toElapsedTime(timediff);elapsedStr||(elapsedStr=jQuery(this).attr("title")),jQuery(this).html(elapsedStr)}),setTimeout(function(){halo.util.updateElapsedTime()},5e3)},toElapsedTime:function(timediff){var elapse={},second=1e3,minute=60*second,hour=60*minute,day=24*hour,balance=timediff;elapse.days=Math.floor(balance/day),balance-=elapse.days*day,elapse.hours=Math.floor(balance/hour),balance-=elapse.hours*hour,elapse.minutes=Math.floor(balance/minute),balance-=elapse.minutes*minute,elapse.seconds=Math.floor(balance/second),balance-=elapse.seconds*second;var rtn=[];return 0==elapse.days&&(1==elapse.hours&&rtn.push(halo.lang(__halotext("an")+" "+__halotext("hour"))),elapse.hours>1?rtn.push(halo.lang("%s "+__halotext("hours"),elapse.hours)):(1==elapse.minutes&&rtn.push(halo.lang("%s "+__halotext("minute"),elapse.minutes)),elapse.minutes>1&&rtn.push(halo.lang("%s "+__halotext("minutes"),elapse.minutes)),elapse.seconds>1&&0==elapse.minutes&&rtn.push(halo.lang("%s "+__halotext("seconds"),elapse.seconds)))),rtn.length?halo.lang("%s "+__halotext("ago"),rtn.join(" ")):""},findZone:function(htmlStr){var $zone=jQuery(htmlStr),zoneId=$zone.attr("data-halozone");return"undefined"!=typeof zoneId&&zoneId||($zone=$zone.find("[data-halozone]").first()),$zone},addValToArrText:function(val,arrText){var arr=arrText.length?arrText.split(","):[],index=arr.indexOf(""+val);return 0>index&&arr.push(val),arr.join(",")},remValFromArrText:function(val,arrText){var arr=arrText.length?arrText.split(","):[],index=arr.indexOf(""+val);return index>-1&&arr.splice(index,1),arr.join(",")},toggleState:function(id,model,field){halo.jax.call("system","ToggleState",id,model,field)},startFlash:function(e,count){var $e=jQuery(e);if($e.addClass("halo-blinker"),count>0){var n=1e3*count;setTimeout(function(){halo.util.stopFlash(e)},n)}},stopFlash:function(e){var $e=jQuery(e);$e.removeClass("halo-blinker")},setCookie:function(name,value,expires,path,domain){var cookie=name+"="+escape(value)+";";expires&&(expires instanceof Date?isNaN(expires.getTime())&&(expires=new Date):expires=new Date((new Date).getTime()+1e3*parseInt(expires)*60*60*24),cookie+="expires="+expires.toGMTString()+";"),path&&(cookie+="path="+path+";"),domain&&(cookie+="domain="+domain+";"),document.cookie=cookie},getCookie:function(name){var regexp=new RegExp("(?:^"+name+"|;s*"+name+")=(.*?)(?:;|$)","g"),result=regexp.exec(document.cookie);return null===result?null:result[1]},throttle:function(fun,delay){var timer=null;return function(){var context=this,args=arguments;clearTimeout(timer),timer=setTimeout(function(){fun.apply(context,args)},delay)}},loopKeys:[],loop:function(key,fun,delay){halo.util.loopKeys[key]&&clearTimeout(halo.util.loopKeys[key]),halo.util.loopKeys[key]=setTimeout(function(){fun(),halo.util.loop(key,fun,delay)},delay)},staticThrottleKeys:[],staticThrottle:function(key,func,delay){return halo.util.staticThrottleKeys[key]||(halo.util.staticThrottleKeys[key]=halo.util.throttle(func,delay)),halo.util.staticThrottleKeys[key]},lockFunction:function(fun,delay){var lock=null,timer=null;return function(){var context=this,args=arguments;lock||(fun.apply(context,args),lock=!0),clearTimeout(timer),timer=setTimeout(function(){lock=!1},delay)}},mergeContent:function(contentA,contentB,attr){for(var valA,valB,ret=[],i=0,j=0,k=0;i<contentA.length&&j<contentB.length;)valA=parseInt(jQuery(contentA[i]).attr(attr)),valB=parseInt(jQuery(contentB[j]).attr(attr)),valB>=valA?ret[k++]=contentA[i++]:ret[k++]=contentB[j++];for(;i<contentA.length;)ret[k++]=contentA[i++];for(;j<contentB.length;)ret[k++]=contentB[j++];return jQuery(ret)},convertKeyArr2KeyDot:function(key){var rtn=key;if("undefined"!=typeof key){var i=key.indexOf("]"),j=key.indexOf("[");if(i-j>1){var arrIndex=key.substr(j,i-j+1),dotIndex="."+key.substr(j+1,i-j-1);rtn=key.replace(arrIndex,dotIndex)}}return rtn},dateToYMD:function(date){var d=date.getDate(),m=date.getMonth()+1,y=date.getFullYear();return""+y+"-"+(9>=m?"0"+m:m)+"-"+(9>=d?"0"+d:d)},isIE:function(){return navigator.appVersion.indexOf("MSIE")>=0?!0:!1},isMobile:function(){return"undefined"==typeof halo.util.mobile&&(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?halo.util.mobile=!0:halo.util.mobile=!1),halo.util.mobile},uniqTimePrefix:null,uniqTimeIndex:0,uniqID:function(){var timePrefix=(new Date).getTime();return timePrefix==halo.util.uniqTimePrefix?halo.util.uniqTimeIndex++:(halo.util.uniqTimePrefix=timePrefix,halo.util.uniqTimeIndex=0),halo.util.uniqTimePrefix+""+halo.util.uniqTimeIndex},getImageNatureSize:function(img){var $img=jQuery(img);if("undefined"!=typeof $img[0].naturalWidth)return{width:$img[0].naturalWidth,height:$img[0].naturalHeight};var oWidth=$img.width(),oHeight=$img.height();$img.css("width","auto"),$img.css("height","auto");var rVal=new Object;return rVal.width=$img.width(),rVal.height=$img.height(),$img.css("width",oWidth),$img.css("height",oHeight),rVal},addZonePagination:function(zoneId,paginationHtml){var $zone=jQuery('[data-halozone="'+zoneId+'"]');if($paginationHtml=jQuery(paginationHtml),$zone.length){var currPagination=$zone.siblings("[data-halo-pagination]").first();currPagination.length?currPagination.replaceWith($paginationHtml):$zone.after($paginationHtml),halo.init($paginationHtml)}},timeoutBtn:function(btnId){var $btn=jQuery("#"+btnId);if($btn.length){var timer=$btn.attr("data-timer");if("undefined"!=typeof timer)if(timer=parseInt(timer),0==timer)$btn.click();else{$btn.attr("data-timer",timer-1);var $counter=jQuery(".btn-counter",$btn);$counter.length||($counter=jQuery('<span class="btn-counter"></span>'),$counter.appendTo($btn)),$counter.html("("+timer+")"),setTimeout(function(){halo.util.timeoutBtn(btnId)},1e3)}}},badge:function(badgeId,badgeType,content){return html='<span data-badge="'+badgeId+'" class="badge badge-'+badgeType+' "><span class="halo-badge-name">'+content+"</span></span>"},enableTagging:function(selector){jQuery(selector).tagging()},focus:function(selector){jQuery(selector).focus()},executeFunctionByName:function(functionName,context){for(var args=Array.prototype.slice.call(arguments,2),namespaces=functionName.split("."),func=namespaces.pop(),$this=window,i=0;i<namespaces.length;i++)$this=$this[namespaces[i]];return $this[func].apply(context,args)},isElementInViewport:function(el,delta){el instanceof jQuery&&(el=el[0]),delta||(delta=0);var rect=el.getBoundingClientRect();return 0==rect.height&&0==rect.width?!1:rect.top>=0-delta&&rect.left>=0-delta&&rect.bottom-delta<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right-delta<=(window.innerWidth||document.documentElement.clientWidth)},onBlurSlug:function(e){var $ele=jQuery(e),$action=$ele.next("a");$action.tooltip({title:__halotext("Click to save slug"),placement:"left"}),$ele.val()!=$ele.data("confirm")&&$action.tooltip("show")},editSlug:function(context,id){halo.jax.call("system","editSlug",context,id)},saveSlug:function(e,context,id){var $ele=jQuery(e),$slug=$ele.prev('[name="slug"]');halo.jax.call("system","saveSlug",context,id,$slug.val())},getPosition:function($el){var el=$el[0];return jQuery.extend({},"function"==typeof el.getBoundingClientRect?el.getBoundingClientRect():{width:el.offsetWidth,height:el.offsetHeight},$el.offset())},canSubmit:function(){return halo.uploader.uploading?(halo.util.setSystemError(__halotext("Please wait until file upload completes.")),!1):!0},isXs:function(){return jQuery(window).width()<768},isUrl:function(s){var regexp=/(((ftp|http|https):\/\/)|(www\.{1}))(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return regexp.test(s)},parseWWWUrl:function(s){return halo.util.isUrl(s)&&/^(www)\.{1}/.test(s)?"http://"+s:s},parseUrls:function(s){for(var regexp=/(((ftp|http|https):\/\/)|(www\.{1}))(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/g,urls=[],url="";match=regexp.exec(s);)url=match.shift(),""!==url.trim()&&urls.push(url.trim());return urls},setViewMode:function(view,mode){var viewName="v"+view,opt={};opt[viewName]=mode,opt.pg=1,halo.util.reloadWithParam(opt)},setHtml:function(selector,html){var ele=jQuery(selector);ele.length&&ele.html(html)},updateResultCounter:function(selector,str){var $ele=jQuery(selector);$ele.length&&($ele.text(str),halo.pagination.insertRefreshFilterButton($ele.parent()))},counting:[],countdown:function(scope){jQuery(".halo-countdown",scope).each(function(){var $ele=jQuery(this),countdown=$ele.attr("data-countdown");if(countdown&&(countdown=parseInt(countdown),countdown>0))var interval=setInterval(function(){return $ele.text(halo.util.secondToDate(countdown)),0==countdown?(clearInterval(interval),$ele.remove(),void $ele.trigger("change")):void countdown--},1e3)})},secondToDate:function(seconds){var date=new Date(1e3*seconds),hh=date.getUTCHours(),mm=date.getUTCMinutes(),ss=date.getSeconds();hh>12&&(hh-=12),10>hh&&(hh="0"+hh),10>mm&&(mm="0"+mm),10>ss&&(ss="0"+ss);var t=hh+":"+mm+":"+ss;return t},bindShowLeaving:function(){jQuery(window).bind("beforeunload",function(evt){})},unbindShowLeaving:function(){jQuery(window).unbind("beforeunload")},setIncomplete:function(status){halo.util.incomplete=status},onInputChanges:function(params){jQuery(document).on(params.eventType,params.selector,halo.util.throttle(function(evt){params.handler(evt)},100))},changePage:function($form,page,keepUrl){if($form.length){var values=halo.util.getFormValues($form.attr("id")),com=halo.util.getFormValue(values,"com");halo.util.deleteFormKey(values,"com");var func=halo.util.getFormValue(values,"func");halo.util.deleteFormKey(values,"func"),halo.util.setFormValue(values,"pg",page),halo.jax.call(com,func,values),keepUrl||halo.util.setUrlParam({pg:page})}},setDataJson:function(key,value){halo.util.jsonData[key]=value},validateDataConfirmation:function(selector){var $selector=jQuery(selector),confirmed=!0,$input=null;return $selector.find("[data-confirm]").each(function(){var value=jQuery(this).val();return jQuery(this).data("confirm")!=value?(confirmed=!1,$input=jQuery(this),!1):void 0}),{success:confirmed,input:$input}},addRequiredScripts:function(scripts,callback){for(var loaded=0,haveLoadedScript=!1,i=0;i<scripts.length;i++){var script;if("object"==typeof scripts[i]){if(script=scripts[i].src,"undefined"!==eval("typeof "+scripts[i].object)){loaded++;continue}}else script=scripts[i];halo.util.loadJavaScript(script,function(){++loaded==scripts.length&&"function"==typeof callback&&callback()}),haveLoadedScript=!0}return haveLoadedScript||"function"!=typeof callback||callback(),haveLoadedScript},isFunction:function(functionToCheck){var getType={};return functionToCheck&&"[object Function]"===getType.toString.call(functionToCheck)},loadJavaScript:function(url,callback){var head=document.getElementsByTagName("head")[0];if(head){var script=document.createElement("script");script.type="text/javascript",script.src=url,"function"==typeof callback&&(script.onreadystatechange=function(e){e||(e=window.event);var el=e.target||e.srcElement;el&&["loaded","complete"].contains(el.readyState)&&callback()},script.onload=callback),head.appendChild(script)}},closest:function(ele,selector){for(var $parent=jQuery(ele).parent();$parent.length;){var found=$parent.find(selector);if(found.length)return jQuery(found[0]);$parent=$parent.parent()}return null},getHtmlData:function(data,key){var dataAttr=[];if(data&&"object"==typeof data)for(var name in data)(name==key||"undefined"==typeof key)&&dataAttr.push("data-"+name+'="'+data[name]+'"');return dataAttr.join(" ")}}}),jQuery.extend(!0,halo,{keycode:{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,NBSP:160}}),jQuery.extend(!0,halo,{storage:{getUniquedDnId:function(dn){var my_id;return my_id="undefined"==typeof halo_my_id?"id0_":"id"+halo_my_id+"_",""+my_id+dn},setAttr:function(dn,obj,attr,val){dn=halo.storage.getUniquedDnId(dn);var dnData=JSON.parse(localStorage.getItem(dn));null==dnData&&(dnData={}),"undefined"==typeof dnData[obj]&&(dnData[obj]={}),dnData[obj][attr]=val,localStorage.setItem(dn,JSON.stringify(dnData))},getAttr:function(dn,obj,attr){dn=halo.storage.getUniquedDnId(dn);var dnData=JSON.parse(localStorage.getItem(dn));return null==dnData||"undefined"==typeof dnData[obj]||"undefined"==typeof dnData[obj][attr]?null:dnData[obj][attr]},deleteAttr:function(dn,obj,attr){dn=halo.storage.getUniquedDnId(dn);var dnData=JSON.parse(localStorage.getItem(dn));null!=dnData&&"undefined"!=typeof dnData[obj]&&"undefined"!=typeof dnData[obj][attr]&&(delete dnData[obj][attr],localStorage.setItem(dn,JSON.stringify(dnData)))},setObj:function(dn,obj,val){dn=halo.storage.getUniquedDnId(dn);var dnData=JSON.parse(localStorage.getItem(dn));null==dnData&&(dnData={}),dnData[obj]=val,localStorage.setItem(dn,JSON.stringify(dnData))},getObj:function(dn,obj){dn=halo.storage.getUniquedDnId(dn);var dnData=JSON.parse(localStorage.getItem(dn));return null==dnData||"undefined"==typeof dnData[obj]?null:dnData[obj]},deleteObj:function(dn,obj){dn=halo.storage.getUniquedDnId(dn);var dnData=JSON.parse(localStorage.getItem(dn));null!=dnData&&"undefined"!=typeof dnData[obj]&&(delete dnData[obj],localStorage.setItem(dn,JSON.stringify(dnData)))},setDn:function(dn,val){dn=halo.storage.getUniquedDnId(dn);try{return localStorage.setItem(dn,JSON.stringify(val)),!0}catch(errors){return!1}},toggleDn:function(dn,val){var curr=halo.storage.getDn(dn),newVal=curr?0:1;dn=halo.storage.getUniquedDnId(dn);try{return localStorage.setItem(dn,newVal),!0}catch(errors){return!1}},getDn:function(dn){dn=halo.storage.getUniquedDnId(dn);var dnData=JSON.parse(localStorage.getItem(dn));return null==dnData?null:dnData},deleteDn:function(dn){dn=halo.storage.getUniquedDnId(dn),localStorage.removeItem(dn)}}}),jQuery.extend(!0,halo,{jax:{loadingTimeout:400,session:new haloSession,targetUrl:"",requests:[],recentPostData:[],requestObjects:[],onLoading:function(){var now=new Date;halo.jax.requests.push(now.getTime()),1==halo.jax.requests.length&&halo.jax.showLoadingState()},onDoneLoading:function(){halo.jax.requests.pop(),halo.jax.requestObjects.pop(),0==halo.jax.requests.length&&halo.jax.hideLoadingState()},cancelRequests:function(){for(;halo.jax.requestObjects.length;){var req=halo.jax.requestObjects.pop();req.abort()}},showLoadingState:function(){var $container=jQuery("#halo-onloading-wrapper");$container.length?$container.removeClass("hidden"):jQuery("body").append(jQuery('<div id="halo-onloading-wrapper" class="text-primary">'+halo.template.getJaxLoading(2)+"</div>"))},hideLoadingState:function(){jQuery("#halo-onloading-wrapper").addClass("hidden")},onProcessResponse:function(responseTxt){for(var result=eval(responseTxt),i=0;i<result.length;i++){var cmd=result[i][0],id=result[i][1],property=result[i][2],data=result[i][3],objElement=jQuery(id);switch(cmd){case"as":objElement&&eval("objElement."+property+"=  data ; ");break;case"uz":halo.zone.updateZone(data);break;case"az":halo.zone.afterZone(data,id);break;case"bz":halo.zone.beforeZone(data,id);break;case"iz":halo.zone.insertZone(data,id,property);break;case"izc":halo.zone.insertZoneContent(data,property);break;case"rz":halo.zone.removeZone(id);break;case"er":if(data){data=jQuery.parseJSON(data);var formId=this.session.get("formId","");if(formId&&halo.form.setInputError(formId,data),"undefined"!=typeof data.error){var msg=data.error;msg=msg.join("<br>"),halo.util.setSystemError(msg)}}break;case"al":data&&alert(data);break;case"rm":jQuery.remove(id);break;case"cs":halo.util.scriptCall(id,data);break;case"msg":halo.util.setSystemMessage(data,property);break;case"red":halo.util.setRedirectMessage(property,id),location.href=data;break;case"ref":location.reload(data);break;case"stop":jQuery("#halo-loading").hide();break;case"csj":halo.util.scriptJsonCall(id,data);break;default:alert("Unknow command: "+cmd)}}},call:function(comName,sFunction){var arg="",cbFunc=arguments[arguments.length-1],args=Array.prototype.slice.call(arguments);cbFunc&&halo.util.isFunction(cbFunc)&&(args=args.slice(0,-1)),arg=halo.jax.buildArgs(args),halo.jax.submitTask(comName,sFunction,arg,cbFunc)},buildArgs:function(arguments){var arg={};if(arguments.length>2)for(var i=2;i<arguments.length;i++){var a=arguments[i];pro="arg"+i;var d={};jQuery.isArray(a)?(d._a_=a,arg[pro]=JSON.stringify(d)):"string"==typeof a?(a=a.replace(/"/g,"&quot;"),d._d_=encodeURIComponent(a),arg[pro]=JSON.stringify(d)):"object"==typeof a&&a.hasOwnProperty("form")?(d._f_=a.form,arg[pro]=JSON.stringify(d)):(d._d_=encodeURIComponent(a),arg[pro]=JSON.stringify(d))}return arg},submitTask:function(comName,func,postData,responseFunc,cacheKey){var targetUrl=halo_jax_targetUrl;postData.com=comName,postData.func=func,postData.csrf_token=jQuery('meta[name="csrf_token"]').attr("content"),postData.__refer_url=document.URL;for(var i=0;i<halo.jax.recentPostData.length;i++)if(JSON.stringify(halo.jax.recentPostData[i])===JSON.stringify(postData))return;halo.jax.recentPostData.push(postData),setTimeout(function(){halo.jax.recentPostData.pop()},500),halo.jax.onLoading();var req=jQuery.ajax({url:targetUrl,type:"POST",data:postData,session:jQuery.extend(!0,{},halo.jax.session),dataType:"JSON"}).done(function(resp){try{halo.jax.onProcessResponse(resp)}catch(e){}halo.jax.onDoneLoading()}).fail(function(){halo.log("error"),halo.jax.onDoneLoading()}).always(function(data,textStatus){responseFunc&&halo.util.isFunction(responseFunc)&&responseFunc.apply(void 0,[data,textStatus]),halo.jax.onCompletedLoading(comName,func)});halo.jax.requestObjects.push(req)},successCb:function(func){return function(data,textStatus){"success"===textStatus&&func.apply(this,[data])}},errorCb:function(func){return function(data,textStatus){"error"===textStatus&&func.apply(this,[data])}},startSession:function(){return halo.jax.session=new haloSession,halo.jax.session},onCompletedLoading:function(comName,func){jQuery(document).trigger(comName+"."+func+".haloLoading")}}}),jQuery.extend(!0,halo,{popup:{title:"",content:"",message:"",actions:new Array,instance:null,confirmClosing:!1,reset:function(){halo.popup.title="",halo.popup.content="",halo.popup.message="",halo.popup.actions=[],halo.popup.instance=null},setFormTitle:function(title){halo.popup.title=title,halo.popup.isOpen()&&jQuery(".halo-popup-title").html(halo.popup.title)},setFormContent:function(content){halo.popup.content=content,halo.popup.isOpen()&&(jQuery(".halo-popup-content").html(halo.popup.content),halo.init(jQuery(".halo-popup-content")))},addFormContent:function(content){content=halo.popup.content+content,halo.popup.setFormContent(content)},setMessage:function(msg,msgType,clearContent){switch(msgType){case"message":msgType="info";break;case"error":msgType="warning"}message='<div data-alert class="alert fade in alert-box alert-'+msgType+'">'+msg+'<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button></div>',halo.popup.message=message,clearContent&&(halo.popup.content=""),halo.popup.isOpen()&&(jQuery(".halo-popup-message").html(message),clearContent&&(jQuery(".halo-popup-content").html(""),halo.popup.content=""))},resetFormAction:function(){halo.popup.actions=new Array},addFormAction:function(opts){"string"==typeof opts&&(opts=jQuery.parseJSON(opts));var options=jQuery.extend({name:"Action","class":"halo-btn-primary",onclick:"",href:"javascript:void(0);",icon:""},opts),icon="";""!==options.icon&&(icon='<i class="fa fa-'+options.icon+'"></i>'),data=halo.util.getHtmlData(options.data);var action="<button "+data+' type="button" class="halo-action-btn halo-btn '+options["class"]+'" onclick="'+options.onclick+'">'+icon+options.name+"</button>";halo.popup.actions.push(action),halo.popup.isOpen()&&jQuery(".halo-popup-actions").html(halo.popup.getFormAction())},getFormAction:function(){for(var formAction='<div class="button-bar row"><div class="button-bar-wrapper halo-pull-right">',i=0;i<halo.popup.actions.length;i++)formAction+=halo.popup.actions[i];return formAction+="</div></div>"},addFormActionCancel:function(opts){halo.popup.addFormAction({name:__halotext("Cancel"),onclick:"halo.popup.close()","class":"halo-btn-default",icon:"times"})},showForm:function(mode){var popupClass="";"undefined"!=typeof mode&&(popupClass=" halo-popup-"+mode);var formContent='<div class="halo-popup-wrapper'+popupClass+'">	<div class="halo-popup-title">'+halo.popup.title+'	</div>	<div class="halo-popup-message">'+halo.popup.message+'	</div>	<div class="halo-popup-content">'+halo.popup.content+'	</div>	<div class="clearfix"></div>	<div class="halo-popup-actions">'+halo.popup.getFormAction()+"	</div></div>";

jQuery.haloMagnificPopup.isOpen?(jQuery.haloMagnificPopup.currItem.src=formContent,jQuery.haloMagnificPopup.updateItemHTML()):(halo.popup.instance=jQuery.haloMagnificPopup.open({items:{src:formContent},type:"inline",callbacks:{open:function(){halo.popup.confirmClosing&&"function"==typeof halo.popup.confirmClosing&&(jQuery.haloMagnificPopup.instance.close=function(){var confirmation=halo.popup.confirmClosing();(confirmation.success||confirm(confirmation.message))&&jQuery.haloMagnificPopup.proto.close.call(this)})},afterClose:function(){halo.popup.setConfirmClosing(function(){return{success:!0}})}}}),jQuery(".mfp-wrap").on("scroll",halo.util.throttle(function(){jQuery(document).trigger("lazyloading.halo")},100))),halo.init(jQuery(".halo-popup-wrapper")),jQuery(document).trigger("lazyloading.halo"),halo.popup.actions=new Array},showLoadForm:function(ajaxCall){halo.popup.setFormTitle(halo.template.getLoadingIcon()+" "+__halotext("Loading")),halo.popup.setFormContent(""),halo.popup.showForm(),eval(ajaxCall)},confirmDialog:function(title,message,callback){halo.popup.setFormTitle(title),halo.popup.setFormContent(message),halo.popup.resetFormAction(),halo.popup.addFormAction({name:__halotext("OK"),onclick:callback,icon:"check","class":"halo-btn-primary"}),halo.popup.addFormActionCancel(),halo.popup.showForm()},confirmDelete:function(title,message,callback){var checked=[];jQuery("input[name='cid[]']:checked").each(function(){checked.push(parseInt(jQuery(this).val()))}),checked.length?halo.popup.confirmDialog(title,message,callback):halo.popup.confirmDialog(title,"Please select at least one item to delete.","halo.popup.close()")},showMsg:function(msg){halo.popup.setFormTitle("HALO"),halo.popup.setFormContent(msg),halo.popup.resetFormAction(),halo.popup.addFormAction({name:__halotext("OK"),onclick:"halo.popup.close()",icon:"check","class":"halo-btn-primary"}),halo.popup.showForm()},showWizard:function(){var formContent='<div class="halo-popup-wrapper">	<div class="halo-popup-message">'+halo.popup.message+'	</div>	<div class="halo-popup-content">'+halo.popup.content+'	</div>	<div class="halo-popup-actions">'+halo.popup.getFormAction()+"	</div></div>";jQuery.haloMagnificPopup.isOpen?(jQuery.haloMagnificPopup.currItem.src=formContent,jQuery.haloMagnificPopup.updateItemHTML()):halo.popup.instance=jQuery.haloMagnificPopup.open({items:{src:formContent},type:"inline"}),halo.popup.actions=new Array},showLoadWizard:function(ajaxCall){halo.popup.setFormContent(halo.template.getLoadingIcon(2)),halo.popup.showWizard(),eval(ajaxCall)},close:function(){jQuery.haloMagnificPopup.close()},isOpen:function(){return ele=jQuery(".halo-popup-wrapper"),ele.length>0?!0:!1},setConfirmClosing:function(handler){halo.popup.confirmClosing=handler}}}),jQuery.extend(!0,halo,{field:{setFieldConfig:function(configParams){jQuery("#fieldConfig").html(configParams),halo.init(jQuery("#fieldConfig"))},changeFieldUnit:function(el){var $el=jQuery(el),$unitSelect=$el.closest("[data-unit-target]"),targetId=$unitSelect.attr("data-unit-target");if("undefined"!=typeof targetId&&targetId.length){var $target=jQuery("#"+targetId),origVal=$target.attr("data-halo-value");if("undefined"==typeof origVal)var $oldUnit=jQuery("li.active a",$unitSelect),oldRate=parseFloat($oldUnit.attr("data-halo-rate")),newRate=parseFloat($el.attr("data-halo-rate")),oldVal=$target.autoNumeric("get"),newVal=oldVal*oldRate/newRate;else var newRate=parseFloat($el.attr("data-halo-rate")),oldVal=parseInt(origVal),newVal=oldVal/newRate;0!=newRate&&$target.autoNumeric("set",newVal)}halo.form.changeTreeSelectOption(el,!1)},initChainSelect:function(subOptions,subFields){for(var parent="",value="",i=0;i<subFields.length;i++){var fieldInput=jQuery('[name="'+subFields[i]+'"]');if(fieldInput.length){value=fieldInput.attr("data-halo-value");var optionsHtml=halo.field.getChainOptions(subOptions,i,parent,value);parent=value,halo.field.setChainOption(fieldInput,optionsHtml),fieldInput.on("change",{input:fieldInput,subOptions:subOptions,subFields:subFields},halo.field.onChangeChainSelect)}}},onChangeChainSelect:function(event){var el=event.data.input,subOptions=event.data.subOptions,subFields=event.data.subFields,$el=jQuery(el),level=subFields.indexOf($el.attr("name"));if(level>=0&&level<subFields.length){var parent=$el.val(),nextField=jQuery('[name="'+subFields[level+1]+'"]');if(nextField.length){var optionsHtml=halo.field.getChainOptions(subOptions,level+1,parent,"");halo.field.setChainOption(nextField,optionsHtml),nextField.trigger("change")}}},setChainOption:function(field,options){var emptyOption='<option value="" > -- '+__halotext("Select")+" -- </option>";options.length?(field.html(emptyOption+options),field[0].disabled=!1):(field.html(emptyOption),field[0].disabled=!0)},getChainOptions:function(subOptions,level,parent,value){for(var levelIndex=subOptions[0].indexOf("level"),valueIndex=subOptions[0].indexOf("value"),titleIndex=subOptions[0].indexOf("title"),parentIndex=subOptions[0].indexOf("parent"),options=[],optionHtml="",i=1;i<subOptions.length;i++)subOptions[i][levelIndex]==level&&subOptions[i][parentIndex]==parent&&(optionHtml='<option value="'+subOptions[i][valueIndex]+'"'+(subOptions[i][valueIndex]==value?' selected="true"':"")+">"+subOptions[i][titleIndex]+"</option>",options.push(optionHtml));return options.join("")},assignFieldToGroup:function(subFields,groupId){var groupWrapper=jQuery("#"+groupId);if(groupWrapper.length)for(var $scope=groupWrapper.closest(".halo-profile-fields"),i=0;i<subFields.length;i++){var fieldInput=jQuery('[name="'+subFields[i]+'"]',$scope);if(fieldInput.length){fieldInput.closest(".halo-field-layout-wrapper").appendTo(groupWrapper)}var fieldHtml=jQuery('[data-halo-field="'+subFields[i]+'"]',$scope);fieldHtml.length&&fieldHtml.appendTo(groupWrapper)}},assignFieldDateRange:function(subFields,rangeId){var rangeWrapper=jQuery("#"+rangeId);if(rangeWrapper.length){var $scope=rangeWrapper.closest(".halo-profile-fields"),startField=jQuery('[name="'+subFields.start+'"]',$scope);startField.length&&startField.closest(".halo-field-layout-wrapper").appendTo(jQuery(".halo-startdate",rangeWrapper));var endField=jQuery('[name="'+subFields.end+'"]',$scope);endField.length&&endField.closest(".halo-field-layout-wrapper").appendTo(jQuery(".halo-enddate",rangeWrapper)),startField.length&&endField.length&&startField.closest(".halo_field_date, .halo_field_datetime, .halo_field_time").on("changeDate",function(ev){var startDate=ev.date;startDate&&(startDate=new Date(startDate.valueOf()+6e4*startDate.getTimezoneOffset())),endField.closest(".halo_field_date, .halo_field_datetime, .halo_field_time").datetimepicker("setStartDate",startDate).datetimepicker("show")})}},init:function(scope){var $tabs=jQuery(".halo-field-tab",scope);if($tabs.length){var $tabContainer=jQuery('<div class="halo-field-tab-container"><ul class="halo-nav nav-tabs halo-tab-nav"></ul><div class="halo-tab-content"></div></div>');$tabContainer.insertBefore(jQuery($tabs[0])),$tabs.each(function(){var tabName=jQuery(this).attr("data-tab-name"),tabId=halo.util.uniqID();jQuery(".halo-tab-nav",$tabContainer).append(jQuery('<li class=""><a href="#'+tabId+'" data-htoggle="tab">'+tabName+"</a></li>"));var $tabContent=jQuery('<div class="tab-pane halo-tab" id="'+tabId+'"></div>');jQuery(".halo-tab-content",$tabContainer).append($tabContent);var $siblings=jQuery(this).nextUntil(".halo-field-tab");$siblings.appendTo($tabContent)}),jQuery(".halo-tab-nav a:first",$tabContainer).htab("show"),$tabs.remove()}},initDateRange:function(rangeId,startEle,endEle){var rangeWrapper=jQuery("#"+rangeId);if(rangeWrapper.length){var startField=jQuery(startEle,rangeWrapper),endField=jQuery(endEle,rangeWrapper),startInput=jQuery("input",startField),endInput=jQuery("input",endField);startField&&startField.length&&endField.length&&startInput.length&&endInput.length&&(startField.datetimepicker({weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:2,forceParse:0,pickerPosition:"bottom-left"}),endField.datetimepicker({weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:2,forceParse:0,pickerPosition:"bottom-left"}),startField.on("changeDate",function(ev){var startDate=ev.date;startDate&&(startDate=new Date(startDate.valueOf()+6e4*startDate.getTimezoneOffset())),endField.datetimepicker("setStartDate",startDate)}),endField.on("changeDate",function(ev){var endDate=ev.date;endDate=endDate?new Date(endDate.valueOf()+6e4*endDate.getTimezoneOffset()):startField.data("date-enddate"),startField.datetimepicker("setEndDate",endDate)}))}},showTooltip:function(show){var $tips=jQuery('#popupForm [name="tips"]').closest(".form-group");show=parseInt(show),$tips.length&&(show?$tips.show():$tips.hide())},setReadOnlyMode:function(readonly){readonly=parseInt(readonly);var $tips=jQuery('#popupForm [name="tips"]').closest(".form-group");$tips.length&&(readonly?$tips.hide():$tips.show());var $published=jQuery('#popupForm [name="published"]').closest(".form-group");$published.length&&(readonly?$published.removeClass("col-md-6"):$published.addClass("col-md-6"));var $highlight=jQuery('#popupForm [name="params[highlight]"]').closest(".form-group");$highlight.length&&(readonly?$highlight.hide():$highlight.show());var $required=jQuery('#popupForm [name="required"]').closest(".form-group");$required.length&&(readonly?$required.hide():$required.show());var $privacy=jQuery('#popupForm [name="params[enablePrivacy]"]').closest(".form-group");$privacy.length&&(readonly?$privacy.hide():$privacy.show())}}}),jQuery.extend(!0,halo,{label:{showLabelTypeOpt:function(opt){jQuery(".label_type_opt").addClass("hidden"),jQuery(".label_type_opt.opt_"+opt).removeClass("hidden")},showAssignLabel:function(context,target_id){halo.jax.call("label","ShowAssignLabelForm",context,target_id)},assignLabel:function(){var values=halo.util.getFormValues("popupForm");halo.jax.call("label","AssignLabel",values)}}}),jQuery.extend(!0,halo,{notification:{userId:0,list:function(e,userId){halo.notification.userId=userId},init:function(scope){jQuery(".halo-notification-toggle",scope).each(function(){$e=jQuery(this),$e.attr("data-htoggle","popover"),$e.attr("data-placement","bottom");var clickEveryWhere=($e.hpopover({html:!0,trigger:"click",delay:{show:100,hide:150},template:'<div class="popover"><div class="arrow"></div><div class="popover-content halo-notification-wrapper"></div></div>',content:function(){var loadingDiv='<div data-halozone="halo-notification-list" class="halo-notification-loading">'+halo.template.getJaxLoading(2)+"</div>";return loadingDiv}}),function(e){0===jQuery(e.target).closest(".halo-notification-wrapper").length&&jQuery(".halo-notification-toggle").hpopover("hide").parent().find(".popover").css("display","none")}),pressEscapse=function(e){27===e.keyCode&&jQuery(".halo-notification-toggle").hpopover("hide")};$e.on("shown.bs.hpopover",function(){if(halo.notification.userId){var values=halo.util.initFormValues();halo.jax.call("notification","loadNotification",values)}jQuery(document.body).on("click",clickEveryWhere),jQuery(document).on("keydown",pressEscapse)}),$e.on("hide.bs.hpopover",function(){jQuery(document.body).off("click",clickEveryWhere),jQuery(document).off("keydown",pressEscapse)})}),jQuery(".halo-notification-item",scope).each(function(){var $this=jQuery(this),notifId=jQuery(this).attr("data-notifid");$this.on("click",function(evt){"a"!=evt.target.nodeName.toLowerCase()&&"undefined"!=typeof notifId&&halo.jax.call("notification","showNotification",notifId)}),jQuery(".halo-notification-action .halo-notifiation-markread",$this).on("click",function(event){"undefined"!=typeof notifId&&halo.notification.markAsRead(notifId),event.stopPropagation()}),jQuery(".halo-notification-action .halo-notification-hide",$this).on("click",function(event){"undefined"!=typeof notifId&&halo.notification.hide(notifId),event.stopPropagation()})})},updater:function(scope){var values={};if("undefined"!=typeof halo_my_id&&0!=halo_my_id)return values.form={},values.form.context="notification",values},markAsRead:function(notifId){halo.jax.call("notification","markAsRead",notifId)},setReadState:function(notifId,isRead){isRead?jQuery("#halo-notification-item-"+notifId).removeClass("unread"):jQuery("#halo-notification-item-"+notifId).addClass("unread")},remove:function(notifId){jQuery("#halo-notification-item-"+notifId).remove()},hide:function(notifId){halo.jax.call("notification","hide",notifId)},showSettings:function(){var ajaxCall='halo.jax.call("notification", "ShowSettings");';halo.popup.showLoadForm(ajaxCall)},saveSettings:function(){var values=halo.util.getFormValues("popupForm");halo.jax.call("notification","SaveSettings",values)},showFullview:function(ele){halo.jax.call("notification","ShowFullview")}}}),jQuery.extend(!0,halo,{pagination:{changeLimit:function(value){halo.util.reloadWithParam({limit:value,pg:1})},changeFilter:function(){var filters=halo.util.getFormValues("filter_form");filters=filters.form;var param={};for(index=0;index<filters.length;++index)param[filters[index][0]]=filters[index][1];var filters=halo.util.getFormParams("filter_form");halo.util.reloadWithParam(jQuery.extend({pg:1},filters))},applyAjaxFilter:function(){},updatePagingNav:function(ele,direction){var $this=jQuery(ele),$wrapper=$this.closest(".halo-paging-nav"),currentPostLbl=jQuery(".halo-paging-nav-current",$wrapper),newPost=parseInt(currentPostLbl.text())+parseInt(direction)-1,postCount=parseInt($wrapper.data("count"));return newPost%=postCount,0>newPost&&(newPost+=postCount),currentPostLbl.text(newPost+1),newPost},refreshFilter:function(ele){var $this=jQuery(ele),$panel=$this.closest(".tab-pane.active");if($panel.length){var filterLabel=jQuery(".halo-filter-label-input",$panel);if(filterLabel.length){var html=filterLabel.outerHTML();html=html.replace("displaySection(","refreshSection(");var cloneLabel=jQuery(html).hide();filterLabel.after(cloneLabel),cloneLabel.trigger("change").remove()}}},insertRefreshFilterButton:function(beforeEle,strClass){var $beforeEle=jQuery(beforeEle);if(strClass=strClass?strClass:"",$beforeEle.length){if($beforeEle.siblings(".halo-refresh-filter-btn").length)return;var $panel=$beforeEle.closest(".tab-pane.active");if($panel.length){var filterLabel=jQuery(".halo-filter-label-input",$panel);if(filterLabel.length){var $btn=jQuery('<span class="halo-refresh-filter-btn'+strClass+'" onclick="halo.pagination.refreshFilter(this)" title="'+__halotext("Reload")+'"><i class="fa fa-refresh"></i></span>');$beforeEle.after($btn)}}}},init:function(scope){jQuery(".halo-pagination-ajax ul.pagination a.halo-pagination-link",scope).on("click",function(e){e.preventDefault()})}}}),jQuery.extend(!0,halo,{form:{checkAllBox:function(checkbox,stub){for(c=0,i=0,n=checkbox.form.elements.length;i<n;i++)e=checkbox.form.elements[i],e.type==checkbox.type&&(stub&&0==e.name.indexOf(stub)||!stub)&&(e.checked=checkbox.checked,c+=1==e.checked?1:0);return checkbox.form.boxchecked&&(checkbox.form.boxchecked.value=c),!0},submit:function(formId){document.forms[formId].submit()},setInputError:function(formId,errors){var form=jQuery(formId);form.length&&(jQuery(formId+" :input").each(function(){var input=jQuery(this);halo.template.clearInputError(input)}),jQuery(formId+" :input").each(function(){var input=jQuery(this),inputName=input.attr("name");inputName&&(inputName=inputName.replace("[]",""));var inputNameDot=halo.util.convertKeyArr2KeyDot(inputName);if("undefined"!=typeof errors[inputName]){var messages=errors[inputName];halo.template.setInputError(input,messages)}else if("undefined"!=typeof errors[inputNameDot]){var messages=errors[inputNameDot];halo.template.setInputError(input,messages)}}))},clearInputError:function(ele){var $input=jQuery(ele),$control=$input.closest(".form-group");$control.length&&($input.tooltip("destroy"),$control.removeClass("has-feedback has-error"),$control.find(".form-control-feedback").remove(),$control.find(".help-block").remove())},checkFormReady:function(formId,passCb,failCb){var form=jQuery(formId),checkFn=function(){form.find(".has-error").length?failCb&&failCb():passCb&&passCb()};form.find(":input").keyup(halo.util.throttle(function(){halo.form.clearInputError(jQuery(this)),halo.util.loop(formId,checkFn,4e3)},1e3)).change(checkFn)},changeTreeSelectOption:function(el,triggerEvent){var $el=jQuery(el),inputName=$el.data("halo-input"),input=($el.closest("form"),jQuery('[name="'+inputName+'"]')),isMultiple=input.data("halo-multiple");if(isMultiple="undefined"!=typeof isMultiple&&isMultiple!==!1?!0:!1){var selectedVal=$el.data("halo-value"),currVal=jQuery.trim(input.val()),currValArr=currVal.length?currVal.split(","):[],index=currValArr.indexOf(""+selectedVal);$el.parent().hasClass("active")?($el.find("i.halo-tree-selected").remove(),$el.parent().removeClass("active"),index>-1&&currValArr.splice(index,1)):($el.html(jQuery("i.fa",$el).length?$el.html():'<i class="halo-tree-selected fa fa-check"></i> '+$el.html()),$el.parent().addClass("active"),0>index&&currValArr.push(selectedVal)),input.val(currValArr.join(","));var sel=$el.closest("[data-tree-select]"),selected=jQuery("li.active",sel),selectedText=[];selected.each(function(){selectedText.push(jQuery(this).text())}),jQuery(".halo-filter-selected-val",sel).html(selectedText.join(","))}else{input.val($el.data("halo-value")),jQuery('[data-halo-input="'+inputName+'"]').each(function(){jQuery(this).find("i.halo-tree-selected").remove(),jQuery(this).parent().removeClass("active")}),$el.html(jQuery("i.fa",$el).length?$el.html():'<i class="halo-tree-selected fa fa-check"></i> '+$el.html()),$el.parent().addClass("active");var sel=$el.closest("[data-tree-select]");sel.children().first().html($el.html()),sel.children(".halo-toggle-display").addClass("hidden")}halo.template.clearInputError(input),("undefined"==typeof triggerEvent||triggerEvent)&&(input.trigger("change"),input.closest("form").length&&input.valid())},selectTreeNode:function(ele){var $changeLevel=jQuery(ele).siblings(".halo-tree-change-level");$changeLevel.length&&$changeLevel.trigger("click")},changeTreeLevel:function(levelId){var $treeOpts=jQuery('ul[data-level-id="'+levelId+'"]'),$levelWrapper=jQuery('<div class="halo-tree-select-wrapper halo-toggle-display"></div>'),$levelHeader=jQuery('<div class="halo-tree-level-header"></div>'),$levelOpts=$treeOpts.clone().removeClass("hidden halo-toggle-display"),$parentLevel=$treeOpts.parents("ul[data-level-id]");if(jQuery(".halo-tree-select-menu",$levelOpts).remove(),$parentLevel.length){var parentLevelId=$parentLevel.attr("data-level-id"),parentLevelTitle=$treeOpts.siblings(".halo-tree-level-title").find("span");parentLevelTitle.length&&$levelHeader.append('<div class="halo-tree-level-header-title"><a href="javascript:void(0)" data-level-id="'+parentLevelId+'" class="halo-tree-change-level"><i class="fa fa-angle-double-left"></i>'+parentLevelTitle.text()+"</a></div>"),$levelWrapper.append($levelHeader)}$levelWrapper.append($levelOpts),jQuery("a.halo-tree-change-level",$levelWrapper).on("click",function(){halo.form.changeTreeLevel(jQuery(this).attr("data-level-id"))});var $treeWrapper=$treeOpts.closest("[data-tree-select]");if($treeWrapper.length){var $optWrapper=jQuery(".halo-tree-select-wrapper",$treeWrapper);$optWrapper.length?$optWrapper.replaceWith($levelWrapper):($toggleBtn=jQuery('[data-htoggle="display"]',$treeWrapper),$toggleBtn.length&&$levelWrapper.addClass("hidden").insertAfter($toggleBtn))}},editInlineLocation:function(e){var $this=jQuery(e);$this.text(__halotext("Update"));var url=$this.attr("href"),context=$this.attr("data-context"),targetid=$this.attr("data-targetid");$this.attr("href","javascript:void(0)"),$this.attr("onclick","halo.form.refreshInlineLocation('"+context+"','"+targetid+"')"),window.open(url,"_blank")},refreshInlineLocation:function(context,targetid){halo.jax.call("system","RefreshInlineLocation",context,targetid)},showMobileForm:function(selector,title){var form=jQuery(selector);halo.popup.setFormTitle(title),form.length&&halo.popup.setFormContent(form.parent().html()),halo.popup.showForm(),halo.popup.addFormAction({name:__halotext("OK"),onclick:"halo.form.updateMobileForm(this)",href:"javascript:void(0);"}),halo.popup.addFormActionCancel()},updateMobileForm:function(ele){},subscribeNews:function(){var values=halo.util.getFormValues("popupForm");halo.jax.call("admin,dashboard","SubscribeNewsLetter",values)},initUserTag:function(scope){function suggestionTemplate(context){return Hogan.compile('<p class="name"><image class="halo-suggestion-img" src={{image}}>{{name}}</p>').render(context)}function onTaggingUser(e,datum){var parent=jQuery(e.target).closest(".form-group"),inputVal=jQuery(".halo-user-tag-value",parent),input=jQuery(".twitter-typeahead",parent);if(input.length&&inputVal.length){var html='<span class="tm-tag tm-tag-success"><span>'+datum.name+'</span> <a href="javascript:void(0)" class="tm-tag-remove" data-id="'+datum.id+'" onclick="halo.form.removeUserTag(this)">x</a></span>';if(jQuery('[data-mode="single"]',input).length)inputVal.val(datum.id),jQuery(".tm-tag",parent).remove();else{var newVal=halo.util.addValToArrText(datum.id,inputVal.val());inputVal.val(newVal)}inputVal.trigger("change"),jQuery(html).insertBefore(input)}}var input=jQuery(".halo-user-tag",scope);input.length&&input.each(function(){var $this=jQuery(this),users=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:halo.util.mergeUrlParams(halo_jax_targetUrl,{term:"%QUERY",com:"autocomplete",func:"searchUsers",csrf_token:jQuery('meta[name="csrf_token"]').attr("content")+(input.data("search")?"&param="+input.data("search"):"")}),beforeSend:function(jqXhr,settings){return settings.data=JSON.stringify({com:"autocomplete",func:"searchUsers",csrf_token:jQuery('meta[name="csrf_token"]').attr("content")}),!0}}});users.initialize(),$this.typeahead({highlight:!0},{name:"taggedusers",displayKey:"name",source:users.ttAdapter(),templates:{empty:'<div class="halo-users-not-found text-center">'+__halotext("No User Matched")+"</div>",suggestion:suggestionTemplate},engine:Hogan}).on("typeahead:selected",onTaggingUser).on("typeahead:autocompleted",onTaggingUser)})},initDateRange:function(startId,endId){var startInput=jQuery("#"+startId),endInput=jQuery("#"+endId);startInput.length&&endInput.length&&(startInput.datetimepicker({weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:2,forceParse:0,pickerPosition:"bottom-left"}),endInput.datetimepicker({weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:2,forceParse:0,pickerPosition:"bottom-left"}),startInput.on("changeDate",function(ev){var startDate=ev.date;startDate&&(startDate=new Date(startDate.valueOf()+6e4*startDate.getTimezoneOffset())),endInput.datetimepicker("setStartDate",startDate)}),endInput.on("changeDate",function(ev){var endDate=ev.date;endDate=endDate?new Date(endDate.valueOf()+6e4*endDate.getTimezoneOffset()):startInput.data("date-enddate"),startInput.datetimepicker("setEndDate",endDate)}))},removeUserTag:function(e){var $this=jQuery(e),parent=$this.closest(".form-group"),inputVal=jQuery(".halo-user-tag-value",parent);if(inputVal.length){var newVal=halo.util.remValFromArrText($this.data("id"),inputVal.val());inputVal.val(newVal),inputVal.trigger("change")}$this.closest(".tm-tag-success").remove()},initHashTag:function(scope){function suggestionTemplate(context){return Hogan.compile('<p class="name">{{name}}</p>').render(context)}function buildTMOptions($input){var options={deleteTagsOnBackspace:!1,preventSubmitOnEnter:!1,tagClass:"tm-tag-success",tagTarget:"_blank",tagsContainer:"#"+$input.data("container-id")};options=jQuery.extend(options,$input.data());var tagTargetId=$input.attr("data-targetid"),tagContext=$input.attr("data-context");return tagTargetId&&tagContext&&(options.AjaxPush=halo_jax_targetUrl+"?com=autocomplete&func=pushTags&csrf_token="+jQuery('meta[name="csrf_token"]').attr("content"),options.AjaxPushParameters={com:"autocomplete",func:"pushTags",targetid:tagTargetId,context:tagContext,csrf_token:jQuery('meta[name="csrf_token"]').attr("content")},options.AjaxPushAllTags=!0),options}var input=jQuery(".halo-hash-tag",scope);input.length&&input.each(function(){var $this=jQuery(this);if(!$this.data("initedTag")){var tmOptions=buildTMOptions($this);$this.tagsManager(tmOptions);var tags=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:halo.util.mergeUrlParams(halo_jax_targetUrl,{term:"%QUERY",com:"autocomplete",func:"searchTags",csrf_token:jQuery('meta[name="csrf_token"]').attr("content")+(input.data("search")?"&param="+input.data("search"):"")}),beforeSend:function(jqXhr,settings){return settings.data=JSON.stringify({com:"autocomplete",func:"searchTags",csrf_token:jQuery('meta[name="csrf_token"]').attr("content")}),!0}}});tags.initialize(),$this.typeahead({highlight:!0},{name:"taggedusers",displayKey:"name",source:tags.ttAdapter(),templates:{empty:'<div class="halo-tags-not-found text-center">'+__halotext("No Tag Found")+"</div>",suggestion:suggestionTemplate},engine:Hogan}),$this.data("initedTag",!0),$this.focus()}})},initTMTag:function(scope){function buildTMOptions($input){var options={deleteTagsOnBackspace:!1,preventSubmitOnEnter:!1,tagClass:"tm-tag-success",tagTarget:"_blank",tagsContainer:"#"+$input.data("container-id")};return options=jQuery.extend(options,$input.data())}var input=jQuery(".halo-tm-tag",scope);input.length&&input.each(function(){var $this=jQuery(this),tmOptions=buildTMOptions($this);$this.tagsManager(tmOptions)})},initMultipleSelect:function(scope){jQuery("select[multiple] option",scope).each(function(){var toggle=jQuery(this).prop("selected");jQuery(this).click(function(evt){jQuery(this).prop("selected",toggle=!toggle)})})},initWizard:function(scope){jQuery(".halo-wizard-wrapper",scope).each(function(){function hasPreviousStep($step){return $step.prevAll(":not(.ignore)").length}function hasNextStep($step){return $step.nextAll(":not(.ignore)").length}function displayButtons(){var $activeStep=getActiveStep();hasPreviousStep($activeStep)?$prevBtn.show():$prevBtn.hide(),hasNextStep($activeStep)?$nextBtn.show():$nextBtn.hide(),hasNextStep($activeStep)?$finishBtn.hide():$finishBtn.show(),options.validate&&"validate"==options.validate&&(validateStep($activeStep)?($nextBtn.removeClass("disabled"),$finishBtn.removeClass("disabled")):($nextBtn.addClass("disabled"),$finishBtn.addClass("disabled")))}function validateStep($step){getStepContent($step);var $stepContent=getStepContent($step);if($stepContent.find(".form-group.has-error").length>0)return!1;for(var $requiredInputs=$stepContent.find("[required]"),i=0;i<$requiredInputs.length;i++)if(jQuery($requiredInputs[i]).is(":radio,:checkbox")){var $radioControl=jQuery($requiredInputs[i]).closest(".form-group");if(0==$radioControl.find(":radio:checked,:checkbox:checked").length)return!1}else if(0==jQuery($requiredInputs[i]).val().length)return!1;return!0}function getStepContent($step){var id=$step.find('a[data-htoggle="wizard"]').data("target");return jQuery(id)}function getActiveStep(){return $wizard.find(".halo-wizard-steps > .halo-wizard-step-title.active")}function bindButtons(){$nextBtn.on("click",function(){var $activeStep=getActiveStep(),$nextSteps=$activeStep.nextAll(":not(.ignore)");if($nextSteps.length){var $nextStep=jQuery($nextSteps[0]);$activeStep.addClass("completed"),$nextStep.removeClass("disabled"),$nextStep.find("a").wizard("show")}}),$prevBtn.on("click",function(){var $activeStep=getActiveStep(),$prevSteps=$activeStep.prevAll(":not(.ignore)");if($prevSteps.length){var $newStep=jQuery($prevSteps[0]);$newStep.find("a").wizard("show")}})}function bindSteps(){$wizard.find('.halo-wizard-steps > .halo-wizard-step-title > a[data-htoggle="wizard"]').on("shown.bs.wizard",function(){displayButtons()}),$wizard.on("keyup","input,textarea",halo.util.throttle(function(){displayButtons()},1e3)),$wizard.on("change",":input,textarea,select",halo.util.throttle(function(){displayButtons()},1e3))}var $wizard=jQuery(this),options=jQuery.extend({},$wizard.data()),$prevBtn=($wizard.find(".halo-wizard-steps > .halo-wizard-step-title"),$wizard.find(".halo-wizard-btn-previous")),$nextBtn=$wizard.find(".halo-wizard-btn-next").hide(),$finishBtn=($wizard.find(".halo-wizard-btn-cancel"),$wizard.find(".halo-wizard-btn-finish").hide());displayButtons(),bindButtons(),bindSteps()})},init:function(scope){halo.form.initMultipleSelect(scope),jQuery("[data-tree-select] > .halo-tree-select-menu",scope).each(function(){var $treeOpts=jQuery(this);jQuery(".halo-tree-select-menu",$treeOpts).each(function(){var uid=halo.util.uniqID();jQuery(this).attr("data-level-id",uid),jQuery(this).prev(".halo-tree-change-level").attr("data-level-id",uid)});var uid=halo.util.uniqID();$treeOpts.attr("data-level-id",uid),halo.form.changeTreeLevel(uid),$treeOpts.removeClass("halo-toggle-display").addClass("halo-tree-select-data")}),jQuery(".tm-tag-remove",scope).on("click",function(){jQuery(this).closest(".tm-tag").remove()}),halo.form.initUserTag(scope),halo.form.initHashTag(scope),halo.form.initTMTag(scope),halo.form.initWizard(scope),jQuery(".haloj-auto-numeric",scope).autoNumeric("init")}}}),jQuery.extend(!0,halo,{online:{list:{},setList:function(list){halo.online.list=list},changeUserOnline:function(userId,newStatus,clientType){0==newStatus?(jQuery(".halo-user-"+userId+".thumbnail").removeClass("user-online"),jQuery("#conv-contacts .halo-user-"+userId+" .fa-user").removeClass("onl")):(jQuery(".halo-user-"+userId+".thumbnail").addClass("user-online"),jQuery("#conv-contacts .halo-user-"+userId+" .fa-user").addClass("onl"))},updateStatus:function(list){if(halo.online.list=JSON.parse(list),"undefined"!=typeof halo.online.list.offline)for(var offlineUsers=halo.online.list.offline,i=0;i<offlineUsers.length;i++){var userId=offlineUsers[i];halo.online.changeUserOnline(userId,0)}if("undefined"!=typeof halo.online.list.online)for(var onlineUsers=halo.online.list.online,i=0;i<onlineUsers.length;i++){var user=onlineUsers[i];halo.online.changeUserOnline(user.id,1)}},init:function(scope){if("undefined"!=typeof halo.online.list.online)for(var onlineUsers=halo.online.list.online,i=0;i<onlineUsers.length;i++){var user=onlineUsers[i];halo.online.changeUserOnline(user.id,1)}},updater:function(scope,params){var userId=parseInt(params),newStatus=userId>0?1:0;userId=Math.abs(userId),halo.online.changeUserOnline(userId,newStatus),halo.online.showOnlineNotif(userId)},showOnlineNotif:function(userId){var $user=jQuery("#conv-contacts .halo-user-"+userId).clone();if($user.length){var lastNotif=jQuery(".halo-online-notif").last();lastNotif.length||(lastNotif=jQuery('[data-halozone="conv.panel"]'));var pos=lastNotif.position(),onlineStatus=jQuery(".fa-user",$user).hasClass("onl"),onlineText="is "+(onlineStatus?"online":"offline");if("undefined"!=typeof pos){var $notif=jQuery('<div class="halo-online-notif"><span> '+onlineText+"</span></div>").prepend($user).appendTo("body");$notif.css("position","fixed").css("top",pos.top-35+"px").css("right","10px"),$notif.fadeOut(3e3,function(){jQuery(this).remove()})}}}}}),jQuery.extend(!0,halo,{like:{like:function(context,targetId,mode){halo.jax.call("like","Like",context,targetId,mode)},unlike:function(context,targetId,mode){halo.jax.call("like","UnLike",context,targetId,mode)},dislike:function(context,targetId,mode){halo.jax.call("like","Dislike",context,targetId,mode)},undislike:function(context,targetId,mode){halo.jax.call("like","UnDislike",context,targetId,mode)}}}),jQuery.extend(!0,halo,{report:{showReport:function(context,targetId){halo.jax.call("report","ShowReport",context,targetId)},submitReport:function(context,targetId){var data=halo.util.getFormValues("popupForm");halo.jax.call("report","SubmitReport",data)}}}),jQuery.extend(!0,halo,{activity:{refresh:function(){var values=halo.util.getFormValues("streamFilters");

halo.jax.call("stream","Refresh",values)},updater:function(scope){if(jQuery("#streamFilters").length){var values=halo.util.getFormValues("streamFilters"),latestAct=jQuery("[data-actid]:first"),latestId=0;latestAct.length&&(latestId=latestAct.data("actid"));var actList=jQuery("[data-actid]").slice(0,20),actIds=[];return actList.each(function(){var actId=jQuery(this).data("actid");"undefined"!=typeof actId&&actIds.push(actId)}),values.form.context="stream",values.form.latestId=latestId,values.form.actIds=actIds,values}},updateActivity:function(data){var $newAct=jQuery(data),$oldAct=jQuery("#"+$newAct.attr("id"));if($oldAct.length){var $commentInput=jQuery(".halo-comment-input:last",$oldAct),inputZone=$commentInput.attr("data-halozone"),$commentWrapper=jQuery(".halo-stream-comment-wrapper",$oldAct),commentZone=$commentWrapper.attr("data-halozone"),$newComments=jQuery(".halo-stream-comment-item",$newAct);$newComments.each(function(){var $this=jQuery(this);"undefined"!=typeof $this.attr("id")&&0==jQuery("#"+$this.attr("id"),$oldAct).length&&("undefined"!=typeof inputZone?(halo.zone.beforeZone($this,inputZone),halo.zone.markChanged($this)):"undefined"!=typeof commentZone&&(halo.zone.insertZone($this,commentZone),halo.zone.markChanged($this)))})}},insertActivity:function(data){var $data=jQuery(data);halo.zone.markChanged($data),halo.zone.insertZone($data,"stream_content","first")},lastUpdate:new Date,loadMore:function(ele){var streamContent=jQuery('[data-halozone="stream_content"]'),d=new Date;if(streamContent.length&&d.getTime()-halo.activity.lastUpdate.getTime()>2e3){var lastAct=streamContent.children(":last"),lastId=lastAct.length?lastAct.data("actid"):0,filters=halo.util.getFormValues("streamFilters");halo.jax.call("stream","LoadOlder",lastId,filters),halo.activity.lastUpdate=d}},autoloadMore:function(e){jQuery(".halo-stream-loadmore-btn").addClass("halo-autoclick").trigger("click"),jQuery(e).hide()},init:function(scope){},toggleComment:function(ele){var $commentBlock=jQuery(ele).closest(".halo-stream-content");$commentBlock.find(".halo-comment-content, .halo-comment-input").removeClass("hidden");var $commentInput=$commentBlock.find(".halo-comment-content>.halo-comment-input .halo-comment-box");$commentInput.focus().click()}}}),jQuery.extend(!0,halo,{autoclick:{inited:!1,autoclick:function(scope){jQuery(".halo-autoclick",scope).each(function(){var $btn=jQuery(this),delta=$btn.prop("data-delta");"undefined"==typeof delta&&(delta=0),halo.util.isElementInViewport($btn,delta)&&$btn.trigger("click")})},init:function(scope){halo.autoclick.inited||(jQuery(document).on("scroll",halo.util.throttle(function(){halo.autoclick.autoclick(jQuery("html"))},100)),halo.autoclick.inited=!0),jQuery(".haloj-scrollable",scope).on("scroll",halo.util.throttle(function(){halo.autoclick.autoclick(scope)},100)),halo.autoclick.autoclick(scope)}}}),jQuery.extend(!0,halo,{lazyload:{inited:!1,loadAll:function(scope){halo.lazyload.loadImages(scope),halo.lazyload.loadUploadBtn(scope),halo.lazyload.loadSelectInput(scope),halo.lazyload.loadTreeSelect(scope),halo.lazyload.loadEllipsis(scope),halo.lazyload.loadSliders(scope)},loadImages:function(scope){jQuery("img[data-src]",scope).each(function(){var $img=jQuery(this);if(!$img.data("lazyloadedImage")&&halo.util.isElementInViewport($img,400)){var src=$img.attr("data-src");src&&($img.removeProp("data-src"),$img.prop("src",src),$img.data("lazyloadedImage",!0))}})},loadSliders:function(scope){jQuery(".halo-slider",scope).each(function(){var $slider=jQuery(this);if(!$slider.data("lazyloadedSlider")&&halo.util.isElementInViewport($slider,400)){var slickOptions=$slider.attr("data-options");slickOptions&&(slickOptions=jQuery.parseJSON(slickOptions),$slider.slick(slickOptions)),$slider.data("lazyloadedSlider",!0)}})},loadUploadBtn:function(scope){jQuery(".haloj-uploader-btn",scope).each(function(){var $btn=jQuery(this);if(!$btn.data("lazyloadedUploader")&&halo.util.isElementInViewport($btn,0)){var uid=$btn.attr("data-upload-uid");if(uid){var holder=jQuery('[data-upload-holder-uid="'+uid+'"]');if(holder.length){var uploaderId=uid;jQuery(this).attr("id","plupload-browse-button-"+uploaderId),holder.attr("id","halo-plupload-upload-ui-"+uploaderId).addClass("halo-uploader-holder");{var options=jQuery.extend({photoWidth:0,photoHeight:0,uploaderId:uploaderId},halo.uploader.singlePreviewOption);halo.uploader.uploader_init(jQuery,holder,options)}}}$btn.data("lazyloadedUploader",!0)}})},loadSelectInput:function(scope){jQuery(".haloj-selectpicker",scope).each(function(){var $input=jQuery(this);!$input.data("lazyloadedSelectInput")&&halo.util.isElementInViewport($input,0)&&($input.selectpicker(),$input.data("lazyloadedSelectInput",!0))})},loadTreeSelect:function(scope){jQuery("[data-tree-select]",scope).each(function(){var $that=jQuery(this);!$that.data("lazyloadedTreeSelect")&&halo.util.isElementInViewport($that,0)&&(jQuery("input",$that).each(function(){var input=jQuery(this);jQuery('[data-halo-value="'+input.val()+'"][data-halo-input="'+input.attr("name")+'"]').each(function(){halo.form.changeTreeSelectOption(this,!1)})}),$that.data("lazyloadedTreeSelect",!0))})},loadEllipsis:function(scope){function adjustHeight($ele,readMore){function wrapNodes($parent){var $contents=$parent.contents();$contents.length>1&&$contents.each(function(){this.nodeType===elemenNode||this.nodeType===textNode&&""!==this.nodeValue.trim()&&jQuery(this).replaceWith(jQuery("<span>"+this.nodeValue+"</span>"))})}function findEllipsisElement(elements,size){for(var i=0;i<elements.length;i++){var $this=jQuery(elements[i]),offset=$this.offset(),height=$this.height(),top=offset.top-baseTop;if(size>top&&top+height>size)return $this}return null}var $children,$found,elemenNode=1,textNode=3,size=100|jQuery($ele).data("height"),baseTop=$ele.offset().top,$wrapper=jQuery($ele);wrapNodes($wrapper),$children=$wrapper.children();var limit=10;do $found=findEllipsisElement($children,size),$found&&(wrapNodes($found),$children=$found.children()),limit--;while($found&&$children.length>1&&limit>0);if($found){if($found[0].nodeType===textNode)var lineHeight=parseFloat($found.css("line-height")),nLines=Math.floor($found.height()/lineHeight),top=$found.offset().top-baseTop,maxHeight=top+Math.ceil(nLines*lineHeight);else var maxHeight=$found.offset().top-baseTop;jQuery($ele).css("max-height",maxHeight).data("height",maxHeight)}}jQuery(".haloj-ellipsis.haloj-truncated",scope).each(function(){var $ele=jQuery(this),readMore=$ele.next().find(".haloj-readmore-btn");!$ele.data("lazyloadedEllipsis")&&readMore.length&&halo.util.isElementInViewport($ele,200)&&($ele.css("position","relative"),adjustHeight($ele,readMore),$ele.data("lazyloadedEllipsis",!0))})},loadLocations:function(){jQuery("[data-halo-map-dropdown]").each(function(){var $that=jQuery(this);halo.util.isElementInViewport($that,400)&&!Boolean($that.data("halo-loc-distance"))&&halo.location.loadScript(function(){var curPosition=halo.location.getCurrentPosition(),__loadLocCb=function(){if(curPosition){var disPosition=new google.maps.LatLng($that.data("halo-loc-lat"),$that.data("halo-loc-lng")),directionsService=new google.maps.DirectionsService,request={origin:curPosition,destination:disPosition,travelMode:google.maps.TravelMode.DRIVING};directionsService.route(request,function(response,status){if(status==google.maps.DirectionsStatus.OK){for(var legs=response.routes[0].legs,totalDistance=0,i=0;i<legs.length;++i)totalDistance+=legs[i].distance.value;totalDistance/=1e3,totalDistance=.5>totalDistance?totalDistance:Math.round(totalDistance),$that.data("halo-loc-distance",totalDistance),$that.data("halo-loc-directions",response),$that.html(.5>totalDistance?$that.data("halo-loc-name")+" ("+__halotext("nearly you")+")":$that.data("halo-loc-name")+" ("+totalDistance+"km)")}else status==google.maps.DirectionsStatus.OVER_QUERY_LIMIT&&setTimeout("__loadLocCb",halo.location.delay)})}};null==curPosition?halo.location.isDetectable()&&halo.location.autodetect({},function(){curPosition=halo.location.getCurrentPosition(),__loadLocCb()}):__loadLocCb()})})},init:function(scope){halo.lazyload.inited||(jQuery(document).on("scroll",halo.util.throttle(function(){halo.lazyload.loadAll(jQuery("html"))},100)),jQuery(document).on("shown.bs.htab",function(e){halo.lazyload.loadAll(jQuery("html")),jQuery("#post_photo").length&&halo.photo.init(jQuery("#post_photo"))}),jQuery(document).on("shown.display.halo",function(e){halo.lazyload.loadAll(jQuery("html"))}),jQuery(document).on("lazyloading.halo",function(e){halo.lazyload.loadAll(jQuery("html"))}),halo.lazyload.inited=!0),jQuery(".haloj-scrollable",scope).on("scroll",halo.util.throttle(function(){halo.lazyload.loadAll(scope)},100)),halo.util.throttle(function(){halo.lazyload.loadAll(scope)},100).apply()}}}),jQuery.extend(!0,halo,{uploader:{uploading:!1,options:{},progressOnlyOption:{multi_selection:!1,fnUploadFile:function(up,file){},fnFileAdded:function(up,files){var hundredmb=104857600,max=parseInt(up.settings.max_file_size,10);jQuery("#media-upload-error").html(""),halo.uploader.uploadStart(),plupload.each(files,function(file){if(max>hundredmb&&file.size>hundredmb&&"html5"!=up.runtime)halo.uploader.uploadSizeError(up,file,!0);else{halo.uploader.fileQueued(up,file);var cancelBtn=jQuery('<div class="halo-upload-cancle-btn halo-upload-action-btn">');cancelBtn.append(jQuery('<button type="button" class="halo-btn halo-btn-xs" title="Cancel"><i class="fa fa-minus"></button>').on("click",function(){up.removeFile(file),jQuery(this).closest("#media-item-"+file.id).remove()}));var newMediaContent=jQuery('<div class="media-item-wrapper" id="media-item-'+file.id+'">').append('<div class="progress progress-striped active halo-upload-progress"><div class="halo-upload-percent progress-bar progress-bar-success" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%"> <span class="sr-only"></span> </div></div>').append(cancelBtn);jQuery(up.el).append(newMediaContent)}}),up.refresh(),up.start()},fnFileUploaded:function(up,file,response){response=jQuery.parseJSON(response.response);var item=jQuery("#media-item-"+file.id);if("undefined"!=typeof response.error){var msg=response.error.message;alert(msg)}item.remove(),jQuery(up.el).trigger("uploader.uploadSuccess",[response])}},singlePreviewOption:{multiple_queues:!1,max_file_count:1,multi_selection:!1,fnUploadFile:function(up,file){},fnFileAdded:function(up,files){var hundredmb=104857600,max=parseInt(up.settings.max_file_size,10);jQuery(".media-item-wrapper",up.el).remove(),jQuery("#media-upload-error").html(""),halo.uploader.uploadStart(),plupload.each(files,function(file){if(max>hundredmb&&file.size>hundredmb&&"html5"!=up.runtime)halo.uploader.uploadSizeError(up,file,!0);else{halo.uploader.fileQueued(up,file);var cancelBtn=jQuery('<div class="halo-upload-cancle-btn halo-upload-action-btn">');cancelBtn.append(jQuery('<button type="button" class="halo-btn halo-btn-xs" title="Cancel"><i class="fa fa-minus"></button>').on("click",function(){up.removeFile(file);var wrapper=jQuery(this).closest("#media-item-"+file.id);wrapper.length&&(wrapper.parent().find('[name="photo_id"]').remove(),wrapper.remove())}));var preview=jQuery('<div class="halo-photo-upload-wrap">').append('<div class="halo-upload-preview"></div>').append('<div class="progress progress-striped active halo-upload-progress"><div class="halo-upload-percent progress-bar progress-bar-success" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%"> <span class="sr-only"></span> </div></div>').append(cancelBtn),newMediaContent=jQuery('<div class="media-item-wrapper" id="media-item-'+file.id+'">').append(preview);jQuery(up.el).append(newMediaContent)}}),up.refresh(),up.start()},fnFileUploaded:function(up,file,response){response=jQuery.parseJSON(response.response);var item=jQuery("#media-item-"+file.id);if("undefined"!=typeof response.error){var msg=response.error.message;alert(msg)}item.find(".halo-upload-progress").remove(),item.find(".halo-upload-preview").append('<img class="" src="'+response.image+'">'),jQuery(up.el).trigger("uploader.uploadSuccess",[response])}},getConfig:function(option){var defaultOption={uploaderId:"halo-uploader",photoWidth:60,photoHeight:60,inputName:"media_id",chunkSize:"1mb",maxFileSize:"1000mb",mediaType:"photo",allowedExtensions:"jpg,gif,png",fnInit:function(up,uploaderEl){jQuery(".moxie-shim",uploaderEl).addClass("col-md-2 col-xs-4").width("")},fnFileAdded:function(up,files){var hundredmb=104857600,max=parseInt(up.settings.max_file_size,10);jQuery("#media-upload-error").html(""),halo.uploader.uploadStart(),plupload.each(files,function(file){max>hundredmb&&file.size>hundredmb&&"html5"!=up.runtime?halo.uploader.uploadSizeError(up,file,!0):(halo.uploader.fileQueued(up,file),up.trigger("beforeUploadCb.halo"))}),up.refresh(),up.start()},fnUploadFile:function(up,file){halo.uploader.fileUploading(up,file)},fnUploadProgress:function(up,file){halo.uploader.uploadProgress(up,file)},fnError:function(up,err){halo.uploader.uploadError(err.file,err.code,err.message,up),up.refresh()},fnFileUploaded:function(up,file,response){halo.uploader.uploadSuccess(up,file,response.response)},fnUploadComplete:function(up,files){halo.uploader.uploadComplete(up,files)}};option=jQuery.extend({},defaultOption,option);var gbUploaderInit={runtimes:"html5,flash,silverlight,html4",browse_button:"plupload-browse-button-"+option.uploaderId,drop_element:"drag-drop-area-"+option.uploaderId,file_data_name:"async-upload",multiple_queues:1,max_file_size:option.maxFileSize,url:halo_jax_targetUrl,multipart_params:{com:"media",photowidth:option.photoWidth,photoheight:option.photoHeight,mediaType:option.mediaType,func:"upload",csrf_token:jQuery('meta[name="csrf_token"]').attr("content")},max_file_count:20,chunk_size:option.chunkSize,resize:{width:1920,height:1080,quality:100,crop:!1},filters:{mime_types:[{title:"Image files",extensions:"jpg,gif,png"},{title:"Zip files",extensions:"zip,avi"},{title:"Allowed Files",extensions:"*"}],prevent_duplicates:!1},rename:!0,sortable:!0,dragdrop:!0,views:{list:!0,thumbs:!0,active:"thumbs"},multipart:1,urlstream_upload:1,showTitle:!0,flash_swf_url:"http://rawgithub.com/moxiecode/moxie/master/bin/flash/Moxie.cdn.swf",silverlight_xap_url:"http://rawgithub.com/moxiecode/moxie/master/bin/silverlight/Moxie.cdn.xap"};return gbUploaderInit=jQuery.extend({},gbUploaderInit,option),this.options=gbUploaderInit,this.options},uploadStart:function(){return!0},uploadSizeError:function(up,file,over100mb){var message;message=over100mb?pluploadL10n.big_upload_queued.replace("%s",file.name)+" "+pluploadL10n.big_upload_failed.replace("%1$s",'<a class="uploader-html" href="#">').replace("%2$s","</a>"):pluploadL10n.file_exceeds_size_limit.replace("%s",file.name),jQuery("#media-items").append('<div id="media-item-'+file.id+'" class="media-item error"><p>'+message+"</p></div>"),up.removeFile(file)},uploadProgress:function(up,file){var item=jQuery("#media-item-"+file.id);jQuery(".halo-upload-percent",item).css("width",file.percent+"%").attr("aria-valuenow",""+file.percent)},uploadError:function(fileObj,errorCode,message,uploader){var max,hundredmb=104857600;switch(errorCode){case plupload.FAILED:halo.uploader.FileError(fileObj,pluploadL10n.upload_failed);break;case plupload.FILE_EXTENSION_ERROR:halo.uploader.FileError(fileObj,pluploadL10n.invalid_filetype);break;case plupload.FILE_SIZE_ERROR:uploadSizeError(uploader,fileObj);break;case plupload.IMAGE_FORMAT_ERROR:halo.uploader.FileError(fileObj,pluploadL10n.not_an_image);break;case plupload.IMAGE_MEMORY_ERROR:halo.uploader.FileError(fileObj,pluploadL10n.image_memory_exceeded);break;case plupload.IMAGE_DIMENSIONS_ERROR:halo.uploader.FileError(fileObj,pluploadL10n.image_dimensions_exceeded);break;case plupload.GENERIC_ERROR:halo.uploader.QueueError(pluploadL10n.upload_failed);break;case plupload.IO_ERROR:max=parseInt(uploader.settings.max_file_size,10),max>hundredmb&&fileObj.size>hundredmb?halo.uploader.FileError(fileObj,pluploadL10n.big_upload_failed.replace("%1$s",'<a class="uploader-html" href="#">').replace("%2$s","</a>")):halo.uploader.QueueError(pluploadL10n.io_error);break;case plupload.HTTP_ERROR:halo.uploader.QueueError(pluploadL10n.http_error);break;case plupload.INIT_ERROR:jQuery(".media-upload-form").addClass("html-uploader");break;case plupload.SECURITY_ERROR:halo.uploader.QueueError(pluploadL10n.security_error);break;default:halo.uploader.FileError(fileObj,pluploadL10n.default_error)}},QueueError:function(message){alert(message),jQuery("#media-upload-error").show().html('<div class="error"><p>'+message+"</p></div>")},FileError:function(fileObj,message){halo.uploader.itemAjaxError(fileObj.id,message)},itemAjaxError:function(id,message){var item=jQuery("#media-item-"+id),filename=item.find(".filename").text(),last_err=item.data("last-err");last_err!=id&&item.html('<div class="error-div"><a class="dismiss" href="#">'+pluploadL10n.dismiss+"</a><strong>"+pluploadL10n.error_uploading.replace("%s",jQuery.trim(filename))+"</strong> "+message+"</div>").data("last-err",id)},fileUploading:function(up,file){var hundredmb=104857600,max=parseInt(up.settings.max_file_size,10);max>hundredmb&&file.size>hundredmb&&setTimeout(function(){file.status<3&&0===file.loaded&&(wpFileError(file,pluploadL10n.big_upload_failed.replace("%1$s",'<a class="uploader-html" href="#">').replace("%2$s","</a>")),up.stop(),up.removeFile(file),up.start())},1e4)},fileQueued:function(up,fileObj){var uploaderId=up.getOption("uploaderId");jQuery(".media-blank").remove();var items=jQuery("#media-items-"+uploaderId),newMedia=jQuery(".halo-media-items",items).children().last().clone();newMedia.attr("id","media-item-"+fileObj.id).addClass("child-of-1").attr("data-halo-photo-preview","");var cancelBtn=jQuery('<div class="halo-upload-cancle-btn halo-upload-action-btn">');cancelBtn.append(jQuery('<button type="button" class="halo-btn halo-btn-xs" title="Cancel"><i class="fa fa-minus"></button>').on("click",function(){up.removeFile(fileObj),jQuery(this).closest(".halo-media-item").remove()}));var newMediaContent=jQuery('<div class="halo-media-item-wrapper halo-in-square">').append('<div class="halo-upload-preview">').append(cancelBtn).append('<div class="progress progress-striped active halo-upload-progress"><div class="halo-upload-percent progress-bar progress-bar-success" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%"> <span class="sr-only"></span> </div></div>'),showTitle=up.getOption("showTitle");showTitle&&newMediaContent.append(jQuery('<div class="halo-upload-filename original">').text(" "+fileObj.name)),newMedia.html(newMediaContent),newMediaContent.before('<div class="halo-dummy-square">');var lastMedia=up.el.find("[data-halo-photo-preview]").last();if(0==lastMedia.length){var mediaWrapper=up.el.find(".halo-media-items");newMedia.prependTo(mediaWrapper)}else 0==up.getOption("multipleUpload")?lastMedia.replaceWith(newMedia):lastMedia.after(newMedia);halo.uploader.uploading=!0},uploadComplete:function(up,files){halo.uploader.uploading=!1,up.trigger("uploadCompleteCb.halo")},uploadSuccess:function(up,file,response){response=jQuery.parseJSON(response);{var item=jQuery("#media-item-"+file.id);up.getOption("uploaderId")}if("undefined"!=typeof response.error){var msg=response.error.message;alert(msg),item.remove()}jQuery(".halo-upload-progress",item).remove(),jQuery(".halo-upload-cancle-btn",item).remove();var removeBtn=jQuery('<div class="halo-upload-remove-btn halo-upload-action-btn">');removeBtn.append(jQuery('<button type="button" class="halo-btn halo-btn-xs" title="Remove"><i class="fa fa-times"></button>').on("click",function(){item.remove()})),jQuery(".halo-upload-preview",item).append(jQuery('<img class="halo-upload-preview-img img-thumbnail img-responsive halo-center-block">').attr("src",response.image)).after(removeBtn),jQuery('[name="'+up.getOption("inputName")+'[]"]').each(function(){""==jQuery(this).val()&&jQuery(this).remove()}),item.append('<input class="mediaInput" type="hidden" data-resetable name="'+up.getOption("inputName")+'[]" value="'+response.id+'">')},beforeUploadCb:function(){jQuery(".halo-status-function-btn").length&&jQuery(".halo-status-function-btn").attr("disabled","disabled")},uploadCompleteCb:function(){jQuery(".halo-status-function-btn").length&&jQuery(".halo-status-function-btn").removeAttr("disabled")},uploader_init:function($,el,option){var gbUploaderInit=halo.uploader.getConfig(option),uploader=new plupload.Uploader(gbUploaderInit);uploader.el=jQuery(el),uploader.bind("Init",function(up){gbUploaderInit.fnInit(up,uploader.el)}),uploader.init(),uploader.bind("FilesAdded",gbUploaderInit.fnFileAdded),uploader.bind("UploadFile",gbUploaderInit.fnUploadFile),uploader.bind("UploadProgress",gbUploaderInit.fnUploadProgress),uploader.bind("Error",gbUploaderInit.fnError),uploader.bind("FileUploaded",gbUploaderInit.fnFileUploaded),uploader.bind("UploadComplete",gbUploaderInit.fnUploadComplete),uploader.bind("uploadCompleteCb.halo",halo.uploader.uploadCompleteCb),uploader.bind("beforeUploadCb.halo",halo.uploader.beforeUploadCb);var media=uploader.getOption("mediaValue");return"undefined"!=typeof media&&jQuery.isArray(media)&&jQuery.each(media,function(key,value){halo.uploader.addMedia(uploader,value)}),jQuery(el).data("uploader",uploader),uploader},addMedia:function(up,media){var items=jQuery("#media-items-"+up.getOption("uploaderId")),newMedia=jQuery(".halo-media-items",items).children().last().clone();newMedia.attr("id","media-item-"+media.id).addClass("child-of-1").attr("data-halo-photo-preview","");var removeBtn=jQuery('<div class="halo-upload-remove-btn halo-upload-action-btn">');removeBtn.append(jQuery('<button type="button" class="halo-btn halo-btn-sx" title="Remove"><i class="fa fa-times"></button>').on("click",function(){newMedia.remove()}));var newMediaContent=jQuery('<div class="halo-media-item-wrapper halo-in-square">').append(jQuery('<div class="halo-upload-preview">').append(jQuery('<img class="halo-upload-preview-img img-thumbnail img-responsive halo-center-block">').attr("src",media.image))).append(removeBtn),showTitle=up.getOption("showTitle");showTitle&&newMediaContent.append(jQuery('<div class="halo-upload-filename original">').text(" "+media.name)),newMediaContent.append('<input type="hidden" data-resetable name="'+up.getOption("inputName")+'[]" value="'+media.id+'">'),newMedia.html(newMediaContent),newMediaContent.before('<div class="halo-dummy-square">');var lastMedia=up.el.find("[data-halo-photo-preview]").last();if(0==lastMedia.length){var mediaWrapper=up.el.find(".halo-media-items");newMedia.prependTo(mediaWrapper)}else 0==up.getOption("multipleUpload")?lastMedia.replaceWith(newMedia):lastMedia.after(newMedia)},initUploaders:function(el,inOptions){var wrapper=jQuery(el).find(".halo-uploader-wrapper");"undefined"==typeof inOptions&&(inOptions={}),"string"==typeof inOptions&&(inOptions=jQuery.parseJSON(inOptions)),wrapper.length>0&&wrapper.each(function(){var data=jQuery(this).data(),options=jQuery.extend(inOptions,data);halo.uploader.uploader_init(jQuery,this,options)})},init:function(scope){halo.uploader.initUploaders(scope)}}});var pluploadL10n={queue_limit_exceeded:__halotext("You have attempted to queue too many files."),file_exceeds_size_limit:__halotext("%s exceeds the maximum upload size for this site."),zero_byte_file:__halotext("This file is empty. Please try another."),invalid_filetype:__halotext("This file type is not allowed. Please try another."),not_an_image:__halotext("This file is not an image. Please try another."),image_memory_exceeded:__halotext("Memory limit exceeded! Please try a smaller file."),image_dimensions_exceeded:__halotext("This is larger than the maximum size. Please try another."),default_error:__halotext("An error occurred in the upload. Please try again later."),missing_upload_url:__halotext("There was a configuration error. Please contact the server administrator."),upload_limit_exceeded:__halotext("You may only upload 1 file."),http_error:__halotext("HTTP error."),upload_failed:__halotext("Upload failed."),big_upload_failed:__halotext("Please try uploading this file with the %1$sbrowser uploader%2$s."),big_upload_queued:__halotext("%s exceeds the maximum upload size for the multi-file uploader when used in your browser."),io_error:__halotext("IO error."),security_error:__halotext("Security error."),file_cancelled:__halotext("File canceled."),upload_stopped:__halotext("Upload stopped."),dismiss:__halotext("Dismiss"),crunching:__halotext("Crunching&hellip;"),deleted:__halotext("moved to the trash."),error_uploading:__halotext("&#8220;%s&#8221; has failed to upload.")};jQuery.extend(!0,halo,{template:{clearInputError:function(input){var refer=input.attr("data-rule-feedback");if("undefined"!=typeof refer)jQuery('[data-feedback="'+refer+'"]').tooltip("destroy");else if(input.closest(".form-group").hasClass("has-feedback"))return void halo.template.setInputSuccess(input)},setInputError:function(input,errors){errors instanceof Array||(errors=[errors]);for(var errMsg="",i=0;i<errors.length;i++)var errMsg=errMsg+errors[i]+"\n";if(errMsg.indexOf("field.")>-1){var inputName=jQuery(input).attr("name"),inputNameDot=halo.util.convertKeyArr2KeyDot(inputName),inputLabel=jQuery('[for="'+inputName+'"]').text();if(inputLabel.length){var re=new RegExp(inputNameDot,"g");errMsg=errMsg.replace(re,"'"+inputLabel+"'")}}var container=input,refer=input.attr("data-rule-feedback");"undefined"!=typeof refer?container=jQuery('[data-feedback="'+refer+'"]'):(input.closest(".form-group").removeClass("has-success has-warning has-error"),input.closest(".form-group").addClass("has-error has-feedback")),container.tooltip(halo.template.getValidationTooltipOptions(input,errMsg)).tooltip("show"),jQuery(document).trigger("inputerror.halo",[container,errors])},setInputSuccess:function(input){var container=input,refer=input.attr("data-rule-feedback");"undefined"!=typeof refer?container=jQuery('[data-feedback="'+refer+'"]'):(input.closest(".form-group").removeClass("has-success has-warning has-error"),input.closest(".form-group").addClass("has-success has-feedback")),container.tooltip("destroy")},getValidationTooltipOptions:function(element,message){var $e=jQuery(element),options={animation:$e.data("animation")||!0,html:$e.data("html")||!1,placement:$e.data("placement")||"top",selector:$e.data("animation")||!0,title:$e.attr("title")||message,trigger:jQuery.trim("manual "+($e.data("trigger")||"")),delay:$e.data("delay")||0,container:$e.data("container")||!1};return options},init:function(scope){jQuery(".haloTextAreaAutoSzie",scope).each(function(){jQuery(this).autosize()}),jQuery(".table-halo-json-editable",scope).each(function(){jQuery(".table-halo-json-editable").jsontable()}),jQuery(".halo-switch-input",scope).each(function(){jQuery(".halo-switch-input").bootstrapSwitch()}),jQuery(".halo-slider-input",scope).each(function(){jQuery(".halo-slider-input").slider()}),jQuery(".halo-tooltip",scope).tooltip(),jQuery(scope).groupcheck(),jQuery(scope).haloStackedList(),jQuery.validator.setDefaults({ignore:[]}),jQuery(".halo-form-helpblock",scope).tooltip({html:!0,trigger:"click focus"}),jQuery(".halo-user-response-actions:not(:has(li))",scope).hide(),halo.util.countdown(scope),jQuery(".halo-filter-panel",scope).each(function(){0==jQuery(this).find('input:not([type="hidden"])').length&&jQuery(this).hide()}),halo.template.listEllipsis(scope),halo.template.initLoading(scope)},listEllipsis:function(scope){var $lists=jQuery(".haloj-list-ellipsis-more .haloc-list",scope),maxItem=4;$lists.each(function(){var $list=jQuery(this),$children=$list.children();if($children.length>maxItem){for(var $dropdown=jQuery('<li class="halo-dropdown col-xs-6"></li>').css("padding","0px"),$dropdownTitle=jQuery('<a href="#" class="halo-dropdown-toggle" data-htoggle="dropdown" role="button">'+($children.length-maxItem+1)+' More <span class="caret"></span></a>'),$dropdownMenu=jQuery('<ul class="halo-dropdown-menu" role="menu"></ul>'),i=maxItem-1;i<$children.length;i++)jQuery($children[i]).removeClass("col-xs-6").appendTo($dropdownMenu);$dropdownTitle.appendTo($dropdown),$dropdownMenu.appendTo($dropdown),$dropdown.appendTo($list)}})},getLoadingIcon:function(zoom){var size="";return"undefined"!=typeof zoom&&(size="fa-"+parseInt(zoom)+"x"),'<i class="fa fa-spinner fa-spin '+size+'"></i>'},getJaxLoading:function(zoom){return'<div class="halo-jax-loading"><div class="halo-loading-icon-wrapper">'+halo.template.getLoadingIcon(zoom)+"</div></div>"},removeStreamLoadMore:function(){jQuery("#halo-stream-loadmore").remove()},initLoading:function(scope){jQuery("[data-loading]",scope).each(function(){var $that=jQuery(this);$that.on("click",function(evt){var $container=jQuery($that.data("loading")).length?jQuery($that.data("loading")):$that;if($container.find(".halo-featured-loading").length)return!1;var complete=$that.data("complete"),title=$that.data("title")?$that.data("title"):"",size=$that.data("size"),sizeClass="undefined"!=typeof size?"fa-"+parseInt(size)+"x":"",replace=$that.data("replace")?$that.data("replace"):!1;replace&&!$container.data("cachedContent")&&$container.data("cachedContent",$that.html());var loadingContent='<span class="halo-featured-loading"><i class="halo-featured-loading-icon fa fa-spinner fa-spin '+sizeClass+'"></i>'+title+"</span>";replace&&$container.empty(),jQuery(loadingContent).css("padding","0px 3px").prependTo($container),complete&&jQuery(document).bind(complete,function(evt){jQuery(".halo-featured-loading",$container).remove(),replace&&$container.html($container.data("cachedContent"))})})})}}}),jQuery.extend(!0,halo,{zone:{initZone:function(zone){halo.init(zone)},updateZone:function(data){var replace=halo.util.findZone(data),zoneId=replace.data("halozone");if(zoneId.length){var selector="[data-halozone='"+zoneId+"']",el=jQuery(selector);el.length&&(el.replaceWith(replace),halo.zone.initZone(jQuery(selector)))}},afterZone:function(data,zoneId){var zone=jQuery(data);if(zoneId.length){var selector="[data-halozone='"+zoneId+"']",el=jQuery(selector);el.length&&(el.after(zone),halo.zone.initZone(zone))}},beforeZone:function(data,zoneId){var zone=jQuery(data);if(zoneId.length){var selector="[data-halozone='"+zoneId+"']",el=jQuery(selector);el.length&&(el.before(zone),halo.zone.initZone(zone))}},insertZone:function(data,zoneId,mode){var zone=jQuery(data);if(zoneId.length){var selector="[data-halozone='"+zoneId+"']",el=jQuery(selector);if(el.length){if("overwrite"==mode)el.html(zone);else{var pContent,halopage=zone.attr("data-halopage");if(halopage)var pSel="[data-halopage='"+halopage+"']",pContent=el.find(pSel);pContent&&pContent.length?pContent.replaceWith(zone):"first"==mode?el.prepend(zone):el.append(zone)}halo.zone.initZone(el)}}},insertZoneContent:function(data,mode){var zoneWrapper=halo.util.findZone(data),zoneId=zoneWrapper.data("halozone"),zoneContent=zoneWrapper.html();if(zoneId.length){var selector="[data-halozone='"+zoneId+"']",el=jQuery(selector);el.length&&("first"==mode?el.prepend(zoneContent):el.append(zoneContent),halo.zone.initZone(el))}},removeZone:function(zoneId){if(zoneId.length){var selector="[data-halozone='"+zoneId+"']",el=jQuery(selector);el.length&&el.remove()}},markChanged:function(data){jQuery(data).addClass("halo-changed-background"),setTimeout(function(){jQuery(data).removeClass("halo-changed-background")},6e4)}}}),jQuery.extend(!0,halo,{brief:{cache:{},showDelay:500,hideDelay:500,init:function(scope){halo.util.isMobile()||jQuery("[data-brief-context][data-brief-id]",scope).each(function(){var $this=jQuery(this),briefContext=$this.attr("data-brief-context"),briefId=$this.attr("data-brief-id"),targetId="brief_"+briefContext+"_"+briefId;$this.attr("data-popover-target",targetId);var clickEveryWhere=(jQuery(this).hpopover({html:!0,delay:{show:halo.brief.showDelay,hide:halo.brief.hideDelay},trigger:"manual",placement:"auto bottom",
container:"body",template:'<div class="popover brief-popover"><div class="arrow"></div><div data-popover-source="'+targetId+'" class="popover-content"></div></div>',content:function(){var loadingDiv='<div data-halozone="brief_'+briefContext+"_"+briefId+'" class="halo-loading container halo-brief-loading">'+halo.template.getJaxLoading(2)+"</div>";return loadingDiv}}),function(e){0!==jQuery(e.target).closest(".brief-popover").length&&(delete halo.brief.cache[briefContext+"_"+briefId],$brief=jQuery('[data-halozone="brief_'+briefContext+"_"+briefId+'"]').addClass("halo-loading")),$this.hpopover("hide")}),singleBrief=function(e){$this.hpopover("hide")};jQuery(this).on("shown.bs.hpopover",function(){var $this=jQuery(this),briefContext=$this.attr("data-brief-context"),briefId=$this.attr("data-brief-id");"undefined"==typeof halo.brief.cache[briefContext+"_"+briefId]?halo.jax.call("system","GetBrief",briefContext,briefId):halo.brief.updateBrief(briefContext,briefId,halo.brief.cache[briefContext+"_"+briefId]),jQuery('[data-popover-source="'+targetId+'"]').on("mouseenter",function(){var targetId=jQuery(this).attr("data-popover-source"),target=jQuery('[data-popover-target="'+targetId+'"]');target.addClass("in"),jQuery(this).one("mouseleave",function(){target.removeClass("in"),setTimeout(function(){target.hasClass("in")||target.hpopover("hide")},halo.brief.hideDelay)})}),jQuery(document).on("click",clickEveryWhere),jQuery(document).one("openbrief.halo",singleBrief)}).on("show.bs.hpopover",function(){jQuery(document).trigger("openbrief.halo")}),jQuery(this).on("mouseenter",function(){var $this=jQuery(this);$this.addClass("in"),setTimeout(function(){$this.hasClass("in")&&$this.hpopover("show")},halo.brief.showDelay)}),jQuery(this).on("mouseleave",function(){var $this=jQuery(this);$this.removeClass("in"),setTimeout(function(){$this.hasClass("in")||$this.hpopover("hide")},halo.brief.hideDelay)}),jQuery(this).on("hide.bs.hpopover",function(){var $this=jQuery(this),briefContext=$this.attr("data-brief-context"),briefId=$this.attr("data-brief-id");$brief=jQuery('[data-halozone="brief_'+briefContext+"_"+briefId+'"]'),$brief.length&&!$brief.hasClass("halo-loading")&&(halo.brief.cache[briefContext+"_"+briefId]=$brief),jQuery(document).off("click",clickEveryWhere),jQuery(document).off("openbrief.halo",singleBrief)})})},updateBrief:function(briefContext,briefId,content){if($brief=jQuery('[data-halozone="brief_'+briefContext+"_"+briefId+'"]'),$brief.length){var $content=jQuery(content);$brief.replaceWith($content),halo.brief.cache[briefContext+"_"+briefId]=content,halo.init($content)}}}}),jQuery.extend(!0,halo,{thumbgrid:{inited:!1,init:function(scope){halo.thumbgrid.inited||(jQuery(window).resize(halo.util.throttle(function(){halo.thumbgrid.init(jQuery(document))},100)),halo.thumbgrid.inited=!0);var $thumbs=jQuery(".halo-list-thumb",scope);if($thumbs.length){$thumbs.each(function(){this.style&&(this.style.height="")});for(var nColumn=halo.thumbgrid.getColumnCount($thumbs.first()),i=0;i<$thumbs.length;i++)if(i%nColumn==nColumn-1){for(var maxHeight=0,j=i-nColumn;i>=j;j++)maxHeight=Math.max(maxHeight,jQuery($thumbs[j]).height());for(var j=i-nColumn;i>=j;j++)jQuery($thumbs[j]).height(maxHeight)}}},getColumnCount:function($thumb){var nColumn=Math.floor($thumb.parent().width()/$thumb.width());return nColumn>=5&&(nColumn=6),nColumn}}}),jQuery.extend(!0,halo,{location:{map:null,markers:[],hasGoogleScript:!1,loadingScript:!1,loadScriptCb:null,paramsCb:[],detectable:!0,currentLocation:null,delay:1e3,wait:!0,gmapControls:{_setEvents:function(elementDom,callbackEvents){for(var evt in callbackEvents)google.maps.event.addDomListener(elementDom,evt,callbackEvents[evt])},_createElement:function(elemHTML){var $div=jQuery('<div style="margin-top: 16px; margin-right: 5px; padding-top: 2px;" class="halo-gmap-control-common"><div><div>'+elemHTML+"</div></div></div>");return $div},create:{CurrentPositionControl:function(map,callbackEvents){$div=halo.location.gmapControls._createElement('<i class="fa fa-location-arrow"></i>');var divDom=$div.get(0);return map.controls[google.maps.ControlPosition.TOP_LEFT].push(divDom),halo.location.gmapControls._setEvents(divDom,callbackEvents),divDom},RefreshAreaControl:function(map,callbackEvents){$div=halo.location.gmapControls._createElement('<i class="fa fa-refresh"></i><span class="arrow_box arrow_box_left">'+__halotext("Search this area")+"</span>"),$div.bind("halo.stop_noticeme",function(){jQuery(".arrow_box",this).hide(400)}),$div.bind("halo.noticeme",function(){jQuery(".arrow_box",this).show(400).css("display","block")}),$div.bind("halo.spin",function(){jQuery(".fa-refresh",this).addClass("fa-spin")}),$div.bind("halo.spinstop",function(){jQuery(".fa-refresh",this).removeClass("fa-spin")}),$div.bind("halo.mapreload",function(){jQuery(this).trigger("halo.stop_noticeme"),jQuery(this).trigger("halo.spin")});var divDom=$div.get(0);return map.controls[google.maps.ControlPosition.TOP_LEFT].push(divDom),halo.location.gmapControls._setEvents(divDom,callbackEvents),divDom}}},gmapCommon:{map:null,infoBox:null,display:null,clusterInfo:null,markers:[],PostMarker:function(params,map,myPosition){var icon=(halo.location.gmapCommon,__getGlobalMarkerIcon(params.type_id,params.main_cat_id)),curIcon=halo_assets_url+"/images/gmap_marker/marker_current.png",postMarker={};for(var i in params)postMarker[i]=params[i];return postMarker.marker=new google.maps.Marker({position:new google.maps.LatLng(params.lat,params.lng),map:map,draggable:!1,animation:google.maps.Animation.DROP,icon:params.is_current?curIcon:icon.normal,title:params.title}),postMarker.marker.clusterIndex=params.cluster_index,postMarker.marker.postId=params.post_id,myPosition?postMarker.currentDistance=halo.location.getDistance(myPosition,postMarker.marker.getPosition()):postMarker.currentDistance=!1,postMarker.render=function(){},postMarker.clear=function(){postMarker.marker.setAnimation(null)},postMarker.doDirections=function(originPos,directions,display){if(originPos)if(Boolean(postMarker.distance))postMarker.currentDistance&&postMarker.currentDistance<=30&&display.setDirections(postMarker.directions);else{var request={origin:originPos,destination:postMarker.marker.getPosition(),travelMode:google.maps.TravelMode.DRIVING};directions.route(request,function(response,status){if(status==google.maps.DirectionsStatus.OK){for(var totalDistance=0,legs=response.routes[0].legs,i=0;i<legs.length;++i)totalDistance+=legs[i].distance.value;totalDistance/=1e3,totalDistance=.5>totalDistance?totalDistance:Math.round(totalDistance);var distanceHTML='<i class="fa fa-road"></i> '+totalDistance+" km",content='<div class="halo-list-wrapper-post">'+jQuery(postMarker.content).find(".halo-post-distance").html(distanceHTML).closest(".halo-list-wrapper-post").html()+"</div>";postMarker.distance=totalDistance,postMarker.directions=response,postMarker.content=content,postMarker.currentDistance&&postMarker.currentDistance<=30&&display.setDirections(response)}})}},postMarker.on=function(type,handler){var that=this;google.maps.event.addListener(postMarker.marker,type,function(){handler(that)})},postMarker},clearMarkers:function(option){for(var i in halo.location.gmapCommon.markers)void 0===option||"map"==option?halo.location.gmapCommon.markers[i].setMap(null):"animation"==option&&halo.location.gmapCommon.markers[i].setAnimation(null)},clearMap:function(){halo.location.gmapCommon.clearMarkers("map"),halo.location.gmapCommon.display&&(halo.location.gmapCommon.display.setMap(null),halo.location.gmapCommon.display=null),halo.location.gmapCommon.infoBox&&(halo.location.gmapCommon.infoBox.close(),halo.location.gmapCommon.infoBox=null),halo.location.gmapCommon.markers=[]},renderMakers:function(posts,postMarkers,markers,infoBox,myPosition,directions,display,bounds,map){for(var i in posts){var postMarker=new halo.location.gmapCommon.PostMarker(posts[i],map,myPosition);postMarker.on("click",function(post){infoBox.setContent(post.content),infoBox.open(map,post.marker),halo.location.gmapCommon.clearMarkers("animation"),post.marker.setAnimation(google.maps.Animation.BOUNCE),halo.location.gmapCommon.clusterInfo&&halo.location.gmapCommon.clusterInfo.close()}),postMarker.on("mouseover",function(post){post.doDirections(myPosition,directions,display)}),jQuery(postMarker).bind("halo.marker.direction",function(){this.doDirections(myPosition,directions,display)}),postMarkers[i]=postMarker,markers[i]=postMarker.marker,bounds.extend(postMarker.marker.getPosition())}},initMarkerClusterer:function(map,markers,contents,postMarkers,myPosition,directions,display){halo.util.addRequiredScripts([halo_assets_url+"/js/markerclusterer.min.js"],function(){var mcOptions={averageCenter:!0,title:__halotext("Show more posts"),maxZoom:18},markerClusterer=new MarkerClusterer(map,markers,mcOptions);google.maps.event.addListener(markerClusterer,"mouseover",function(c){jQuery(postMarkers[c.getMarkers()[0].postId]).trigger("halo.marker.direction")}),google.maps.event.addListener(markerClusterer,"click",function(c){halo.location.gmapCommon.checkSameClusterIndex(c.getMarkers())?(markerClusterer.setZoomOnClick(!1),halo.location.gmapCommon.clusterInfo||(halo.location.gmapCommon.clusterInfo=new google.maps.InfoWindow({maxWidth:300})),halo.location.gmapCommon.clusterInfo.setContent(contents[c.getMarkers()[0].clusterIndex].replace("{distance}",jQuery(postMarkers[c.getMarkers()[0].postId].content).find(".halo-post-distance").html())),halo.location.gmapCommon.clusterInfo.open(map,c.getMarkers()[0]),halo.location.gmapCommon.infoBox&&(halo.location.gmapCommon.infoBox.close(),halo.location.gmapCommon.clearMarkers("animation"))):markerClusterer.setZoomOnClick(!0)}),google.maps.event.addListener(markerClusterer,"clusteringbegin",function(mc){})})},expandCluster:function(cluster){var ONE_RADIAN=Math.PI/180,RADIUS=1,markers=cluster.getMarkers(),clusterX=markers[0].getPosition().lat(),clusterY=markers[0].getPosition().lng();for(var i in markers){var angle=360/markers.length*i*ONE_RADIAN,lat=clusterX+Math.cos(angle)*RADIUS,lng=clusterY+Math.sin(angle)*RADIUS,position=new google.maps.LatLng(lat,lng);markers[i].setPosition(position)}},checkSamePosition:function(markers){var leng=markers.length;if(2>leng)return!1;for(var marker=markers[0],i=1;leng>i;i++)if(marker.getPosition().lat()!=markers[i].getPosition().lat()||marker.getPosition().lng()!=markers[i].getPosition().lng())return!1;return!0},checkSameClusterIndex:function(markers){if(markers.length<2)return!1;for(var index=markers[0].clusterIndex,i=1;i<markers.length;i++)if(index!=markers[i].clusterIndex)return!1;return!0}},getCurrentAddress:function(type){if(halo.location.currentLocation){var loc=halo.location.currentLocation.address[0];return loc.formatted_address}return""},setDetectable:function(val){halo.location.detectable=val},isDetectable:function(){return halo.location.detectable},getCurrentPosition:function(){return halo.location.currentLocation?halo.location.currentLocation.latlng:null},loadScript:function(callback,param){var key=jQuery("#halo_ggApiKey").attr("data-gg");if(key){if(halo.location.loadingScript)return void setTimeout(function(){halo.location.loadScript(callback,param)},200);if(halo.location.loadScriptCb=callback,halo.location.paramsCb="undefined"!=typeof param?param:[],halo.location.hasGoogleScript)callback.apply(this,halo.location.paramsCb);else{halo.location.loadingScript=!0;var script=document.createElement("script");script.type="text/javascript",script.src=halo.location.getGoogleMapUrl("__haloLoadScriptCb"),document.body.appendChild(script)}}},autodetect:function(options,callback){function setCurrentLocation(position){halo.location.loadScript(function(){var latlng=new google.maps.LatLng(position.coords.latitude,position.coords.longitude),geocoder=new google.maps.Geocoder;options=jQuery.extend(options,{latLng:latlng}),geocoder.geocode(options,function(results,status){status==google.maps.GeocoderStatus.OK?results[0]?halo.location.currentLocation={latlng:latlng,address:results}:(halo.location.setDetectable(!1),alert("No results found")):status==google.maps.GeocoderStatus.OVER_QUERY_LIMIT?(setTimeout(function(){setCurrentLocation(position)},halo.location.delay),halo.log("Geocoder failed due to: "+status)):halo.location.setDetectable(!1),callback.apply()})})}halo.location.currentLocation?callback.apply():navigator.userAgent.indexOf("Safari")>-1?geo_position_js.init()?geo_position_js.getCurrentPosition(setCurrentLocation,halo.location.error,{maximumAge:1/0,timeout:1e3}):halo.log(__halotext("Browser does not support this method to detect location")):navigator.geolocation?navigator.geolocation.getCurrentPosition(setCurrentLocation,halo.location.error,{maximumAge:1/0,timeout:1e3}):halo.log(__halotext("Browser does not support this method to detect location"))},detect:function(){halo.location.autodetect({},function(){var pos=halo.location.getCurrentPosition();pos&&halo.location.detected(pos)})},getGoogleMapUrl:function(callback){var url,key=jQuery("#halo_ggApiKey").attr("data-gg");return key||(key="AIzaSyDuiUyJp4LPYfxlRLnJvGbxj-JPAtEBOOc&sensor"),url="https://maps.googleapis.com/maps/api/js?key="+key+"&sensor=true&libraries=places&callback="+callback},clearMarkers:function(){for(var marker,i=0;marker=halo.location.markers[i];i++)marker.setMap(null);halo.location.markers=[]},onUpdateLocationMarker:function(marker){jQuery('[name="halo_checkin_lat"]').val(marker.getPosition().lat()),jQuery('[name="halo_checkin_lng"]').val(marker.getPosition().lng())},checkin:function(controlId){var locLat=jQuery('[name="halo_checkin_lat"]').val(),locLng=jQuery('[name="halo_checkin_lng"]').val(),locName=jQuery('[name="halo_checkin_name"]').val();(""+locLat).length&&(""+locLng).length&&locName.length?(halo.location.setLocationData(controlId,{lat:locLat,lng:locLng,name:locName}),halo.popup.close()):(alert(__halotext("Please enter your location name")),jQuery('[name="halo_checkin_name"]').focus())},showCheckin:function(controlId){halo.popup.setFormTitle(__halotext("Find location"));var mapCanvas='<div id="map_canvas" class="container" style="height: 400px;width: 400px"></div>',input='<input id="pac-input" name="halo_checkin_name" class="controls" type="text" placeholder="'+__halotext("Search Location")+'">',inputLat='<input type="hidden" name="halo_checkin_lat">',inputLng='<input type="hidden" name="halo_checkin_lng">',warning='<div class="halo-allow-location text-center halo-top16"><p>*Please grant Halo.Social access to your location when asked by browser.</p></div>';halo.popup.setFormContent(mapCanvas+input+inputLat+inputLng+warning),navigator.geolocation&&halo.popup.addFormAction({name:__halotext("Use My Location"),"class":"halo-btn-primary",onclick:"halo.location.detect()",href:"javascript:void(0);",icon:"crosshairs"}),halo.popup.addFormAction({name:__halotext("Use this location"),onclick:"halo.location.checkin('"+controlId+"')",icon:"check"}),halo.popup.addFormActionCancel(),halo.popup.showForm(),halo.location.loadScript(function(){var map=new google.maps.Map(document.getElementById("map_canvas"),{mapTypeId:google.maps.MapTypeId.ROADMAP}),defaultBounds=new google.maps.LatLngBounds(new google.maps.LatLng(-33.8902,151.1759),new google.maps.LatLng(-33.8474,151.2631));map.fitBounds(defaultBounds);var input=document.getElementById("pac-input");map.controls[google.maps.ControlPosition.TOP_LEFT].push(input),halo.location.map=map;var searchBox=new google.maps.places.SearchBox(input);google.maps.event.addListener(searchBox,"places_changed",function(){var places=searchBox.getPlaces();halo.location.clearMarkers();for(var place,bounds=new google.maps.LatLngBounds,i=0;place=places[i];i++){var marker=({url:place.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)},new google.maps.Marker({map:map,draggable:!0,title:place.name,position:place.geometry.location}));halo.location.markers.push(marker),bounds.extend(place.geometry.location),google.maps.event.addListener(marker,"dragend",function(){halo.location.onUpdateLocationMarker(this)}),google.maps.event.addListener(marker,"click",function(){halo.location.onUpdateLocationMarker(this)}),halo.location.onUpdateLocationMarker(marker)}map.fitBounds(bounds)}),input.focus()})},detected:function(position){jQuery("#pac-input").val(halo.location.getCurrentAddress()),jQuery("#pac-input").focus(),halo.location.clearMarkers();var marker=new google.maps.Marker({map:halo.location.map,draggable:!0,title:jQuery("#pac-input").val(),position:position});google.maps.event.addListener(marker,"dragend",function(){halo.location.onUpdateLocationMarker(this)}),google.maps.event.addListener(marker,"click",function(){halo.location.onUpdateLocationMarker(this)}),halo.location.map.setCenter(position),google.maps.event.trigger(marker,"click"),halo.location.markers.push(marker)},error:function(error){halo.log(error),halo.location.setDetectable(!1),halo.log(error.code==error.PERMISSION_DENIED?__halotext("HaloSocial does not have permission to use your location."):__halotext("Could not detect your current location."))},hasShareLocation:function(){return jQuery('[name="share_location_name"]').val().length},showNearbyPosts:function(data){halo.location.gmapCommon.clearMap(),halo.location.loadScript(function(){var map,posts=data.posts,canvasId=data.input.old.canvas_id,currentPostId=data.post_id,postMarkers=[],mapOptions={mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:data.input.old.zoom,mapTypeControl:!1},myPosition=halo.location.getCurrentPosition();halo.location.gmapCommon.map?map=halo.location.gmapCommon.map:(map=new google.maps.Map(document.getElementById(canvasId),mapOptions),halo.location.gmapCommon.map=map),"undefined"!=typeof data.input.old.center_lat&&"undefined"!=typeof data.input.old.center_lng&&map.setCenter(new google.maps.LatLng(data.input.old.center_lat,data.input.old.center_lng)),map.controls[google.maps.ControlPosition.TOP_LEFT].getAt(1)&&jQuery(map.controls[google.maps.ControlPosition.TOP_LEFT].getAt(1)).trigger("halo.spinstop"),google.maps.event.addListener(map,"dragstart",function(){}),google.maps.event.addListener(map,"dragend",function(){jQuery(RefreshAreaControl).trigger("halo.noticeme")}),google.maps.event.addListener(map,"zoom_changed",function(){jQuery(RefreshAreaControl).trigger("halo.noticeme")}),"viewport"==data.type;var directions=new google.maps.DirectionsService;halo.location.gmapCommon.display=new google.maps.DirectionsRenderer({map:map,preserveViewport:!0,suppressMarkers:!0});var bounds=new google.maps.LatLngBounds;if(halo.location.gmapCommon.infoBox=new InfoBox({content:"",boxStyle:{width:"250px",background:"url('http://google-maps-utility-library-v3.googlecode.com/svn/trunk/infobox/examples/tipbox.gif') no-repeat"},pixelOffset:new google.maps.Size(-125,-60),infoBoxClearance:new google.maps.Size(16,16),closeBoxMargin:"-17px 7px 0 0",alignBottom:!0}),google.maps.event.addListener(map,"click",function(){"undefined"!=typeof halo.location.gmapCommon.infoBox&&(halo.location.gmapCommon.infoBox.close(),halo.location.gmapCommon.clearMarkers("animation")),halo.location.gmapCommon.clusterInfo&&halo.location.gmapCommon.clusterInfo.close()}),google.maps.event.addListener(halo.location.gmapCommon.infoBox,"closeclick",function(){halo.location.gmapCommon.clearMarkers("animation")}),!map.controls[google.maps.ControlPosition.TOP_LEFT].getLength())var RefreshAreaControl=(halo.location.gmapControls.create.CurrentPositionControl(map,{click:function(){halo.location.autodetect({},function(){var myPosition=halo.location.getCurrentPosition();if(myPosition){jQuery(RefreshAreaControl).trigger("halo.mapreload");var values=halo.util.initFormValues();halo.util.setFormValue(values,"canvas_id",canvasId),halo.util.setFormValue(values,"post_id",currentPostId),halo.util.setFormValue(values,"lat",myPosition.lat()),halo.util.setFormValue(values,"lng",myPosition.lng()),halo.util.setFormValue(values,"limit",24),halo.util.setFormValue(values,"center_lat",myPosition.lat()),halo.util.setFormValue(values,"center_lng",myPosition.lng()),halo.post.getNearbyPosts(values)}})}}),halo.location.gmapControls.create.RefreshAreaControl(map,{click:function(){jQuery(RefreshAreaControl).trigger("halo.mapreload");var bounds=(map.getCenter(),map.getBounds()),topLocation=bounds.getNorthEast(),bottomLocation=bounds.getSouthWest(),values=halo.util.initFormValues();halo.util.setFormValue(values,"canvas_id",canvasId),halo.util.setFormValue(values,"post_id",currentPostId),halo.util.setFormValue(values,"limit",24),halo.util.setFormValue(values,"type","viewport"),halo.util.setFormValue(values,"toplat",topLocation.lat()),halo.util.setFormValue(values,"toplng",topLocation.lng()),halo.util.setFormValue(values,"btmlat",bottomLocation.lat()),halo.util.setFormValue(values,"btmlng",bottomLocation.lng()),halo.util.setFormValue(values,"zoom",map.getZoom()),halo.post.getNearbyPosts(values)}}));if(halo.location.gmapCommon.renderMakers(posts,postMarkers,halo.location.gmapCommon.markers,halo.location.gmapCommon.infoBox,myPosition,directions,halo.location.gmapCommon.display,bounds,map),myPosition){var marker=new google.maps.Marker({position:myPosition,map:map,title:"My location",animation:google.maps.Animation.DROP});if("latlng"==data.input.old.type&&postMarkers[data.post_id].currentDistance&&postMarkers[data.post_id].currentDistance<=30){var myInfo=new google.maps.InfoWindow({content:'<div style="width: 70px;">My location</div>'});myInfo.open(map,marker)}postMarkers[data.post_id].currentDistance&&postMarkers[data.post_id].currentDistance<=30&&postMarkers[data.post_id].doDirections(myPosition,directions,halo.location.gmapCommon.display),bounds.extend(myPosition)}"latlng"==data.input.old.type,halo.location.gmapCommon.initMarkerClusterer(map,halo.location.gmapCommon.markers,data.cluster_content,postMarkers,myPosition,directions,halo.location.gmapCommon.display)})},init:function(scope){var __parseSize=function(){var m=halo.util.isMobile(),wrapWidth=500,wrapHeight=450,paddingWidth=30,paddingHeight=20;return{m:m,mapClass:m?"":"halo-map-popover",wrapWidth:wrapWidth,innerHeight:wrapHeight-paddingHeight,innerWidth:wrapWidth-paddingWidth}};jQuery("[data-halo-map-dropdown]",scope).each(function(){var link=jQuery(this),canvasId=link.data("halo-loc-id")+"-canvas",targetId=canvasId;link.attr("data-popover-target",targetId);jQuery(this).hpopover({html:!0,container:"body",placement:"auto top",delay:{show:100,hide:500},trigger:"manual",template:'<div class="popover '+__parseSize().mapClass+'"><div class="arrow"></div><div data-popover-source="'+targetId+'" class="popover-content"></div></div>',content:function(){if(__parseSize().m)var canvas='<div id="'+canvasId+'" class="halo-map-canvas halo-map-loading">';else var canvas='<div id="'+canvasId+'" class="halo-map-canvas halo-map-loading" style="height:'+__parseSize().innerHeight+'px; paddingLeft: 0px; paddingRight: 0px">';return canvas}});jQuery(this).on("mouseenter touchstart",function(e){var $this=jQuery(this);$this.hasClass("iiln")||($this.addClass("in"),setTimeout(function(){$this.hasClass("in")&&$this.hpopover("show")},halo.brief.showDelay))}),jQuery(this).on("mouseleave",function(){var $this=jQuery(this);$this.removeClass("in"),setTimeout(function(){$this.hasClass("in")||$this.hpopover("hide")},halo.brief.hideDelay)}),jQuery(this).on("show.bs.hpopover",function(evt){}).on("shown.bs.hpopover",function(){var link=jQuery(this),address=link.data("halo-loc-name"),lat=link.data("halo-loc-lat"),lng=link.data("halo-loc-lng"),canvasId=link.data("halo-loc-id")+"-canvas";halo.location.loadScript(function(){var bounds=new google.maps.LatLngBounds,point=new google.maps.LatLng(lat,lng),mapOptions={center:point,mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:12,mapTypeControl:!1},map=new google.maps.Map(document.getElementById(canvasId),mapOptions),marker=new google.maps.Marker({position:point,map:map,draggable:!0,icon:halo_assets_url+"/images/gmap_marker/marker_default.png",title:address}),$fullBtn=jQuery('<div title="'+__halotext("Show full map of similar posts")+'" style="margin-top: 5px; margin-right: 5px; cursor: pointer;" class="halo-gmap-control"><i class="fa fa-plus-circle"></i> Full view</div>'),fullBtnDom=$fullBtn.get(0);map.controls[google.maps.ControlPosition.TOP_RIGHT].push(fullBtnDom),google.maps.event.addDomListener(fullBtnDom,"click",function(){link.trigger("click"),link.hpopover("hide")});var __loadMarkerInfo=function(distance){var contentInfo='<div><i class="fa fa-road"></i> '+distance+" km</div>";.5>distance&&(contentInfo='<div><i class="fa fa-road"></i> '+__halotext("location near you")+" </div>");var infowindow=new google.maps.InfoWindow({content:contentInfo});infowindow.open(map,marker)},myPosition=halo.location.getCurrentPosition(),__loadLocCb=function(){if(myPosition){var positionDistance=halo.location.getDistance(myPosition,point),hasDirect=15>=positionDistance,directionsDisplay=new google.maps.DirectionsRenderer({preserveViewport:!0,suppressMarkers:!0});if(directionsDisplay.setMap(map),Boolean(link.data("halo-loc-distance")))__loadMarkerInfo(link.data("halo-loc-distance")),hasDirect&&directionsDisplay.setDirections(link.data("halo-loc-directions"));else{var directionsService=new google.maps.DirectionsService,request={origin:myPosition,destination:point,travelMode:google.maps.TravelMode.DRIVING};directionsService.route(request,function(response,status){if(status==google.maps.DirectionsStatus.OK){for(var legs=response.routes[0].legs,totalDistance=0,i=0;i<legs.length;++i)totalDistance+=legs[i].distance.value;totalDistance/=1e3,totalDistance=.5>totalDistance?totalDistance:Math.round(totalDistance),link.data("halo-loc-distance",totalDistance),link.data("halo-loc-directions",response),link.html(.5>totalDistance?link.data("halo-loc-name")+" ("+__halotext("nearly you")+")":link.data("halo-loc-name")+" ("+totalDistance+"km)"),hasDirect&&directionsDisplay.setDirections(response),__loadMarkerInfo(totalDistance)}else status==google.maps.DirectionsStatus.OVER_QUERY_LIMIT})}if(hasDirect){{new google.maps.Marker({position:myPosition,map:map,draggable:!0,title:__halotext("You are here")})}bounds.extend(point),bounds.extend(myPosition),map.fitBounds(bounds)}}};null==myPosition?halo.location.isDetectable()&&halo.location.autodetect({},function(){myPosition=halo.location.getCurrentPosition(),__loadLocCb()}):__loadLocCb(),jQuery('[data-popover-source="'+targetId+'"]').on("mouseenter",function(){var targetId=jQuery(this).attr("data-popover-source"),target=jQuery('[data-popover-target="'+targetId+'"]');target.addClass("in"),jQuery(this).one("mouseleave",function(){target.removeClass("in"),target.hasClass("in")||target.hpopover("hide"),setTimeout(function(){target.hasClass("in")||target.hpopover("hide")},halo.brief.hideDelay)})})})})}),jQuery("[data-halo-map-dropdown]",scope).each(function(){var conWidth=.8*jQuery(window).width(),conHeight=.9*jQuery(window).height(),$that=jQuery(this);$that.haloMagnificPopup({mainClass:"mfp-img-mobile",type:"inline",items:{src:'<div style="background-position: center center; background-color: #fff; max-width:'+conWidth+'px; width: auto; margin: 0px auto; position: relative;" class="halo-map-canvas-container"><div style="width: '+conWidth+"px; height: "+conHeight+'px;" id="'+$that.data("halo-loc-id")+'-map-canvas"></div></div>'},callbacks:{beforeOpen:function(){halo.location.gmapCommon.map=null},open:function(){$that.hpopover("hide");{var canvasId=$that.data("halo-loc-id")+"-map-canvas",postLat=$that.data("halo-loc-lat"),postLng=$that.data("halo-loc-lng"),postAddress=($that.data("post-id"),$that.data("halo-loc-name"));$that.data("halo-loc-id").split("-")}jQuery("#"+canvasId).closest(".mfp-wrap").css("z-index","99999999"),jQuery("#"+canvasId).closest(".mfp-content").find(".mfp-close").css({top:"-32px",color:"#ccc"}),halo.location.loadScript(function(){var map,latlng=new google.maps.LatLng(postLat,postLng),mapOptions={mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:15,mapTypeControl:!1,center:latlng};halo.location.gmapCommon.map?map=halo.location.gmapCommon.map:(map=new google.maps.Map(document.getElementById(canvasId),mapOptions),halo.location.gmapCommon.map=map);var marker=new google.maps.Marker({position:latlng,map:map,title:postAddress,animation:google.maps.Animation.DROP}),info=new google.maps.InfoWindow({content:postAddress});info.open(map,marker)})},afterClose:function(){halo.location.gmapCommon.markers=[]}}})}),jQuery(document.body).on("touchstart",function(e){if(void 0==jQuery(e.target).data("halo-map-dropdown")){var target=jQuery("[data-halo-map-dropdown]",scope);target.hpopover("hide"),target.removeClass("in")}}),halo.location.initLocationField(scope)},setLocationData:function(controlId,datum){var control=jQuery("#"+controlId);if(control.length){var input=jQuery(".halo-field-location-name",control).last(),latInput=jQuery(".halo-field-location-lat",control),lngInput=jQuery(".halo-field-location-lng",control);latInput.val(datum.lat),lngInput.val(datum.lng),input.val(datum.name),input.trigger("location.change.halo",[datum])}},initLocationField:function(scope){function initCurrentLocationDetect(scope){var detectBtns=jQuery(".halo-field-location-detect",scope);detectBtns.each(function(){{var $this=jQuery(this),$control=$this.closest(".halo-location-control"),input=jQuery(".halo-field-location-name",$control),latInput=jQuery(".halo-field-location-lat",$control),lngInput=jQuery(".halo-field-location-lng",$control);$this.attr("id")}$this.on("click",function(){halo.location.autodetect({},function(){var pos=halo.location.getCurrentPosition();pos?(latInput.val(pos.lat()),lngInput.val(pos.lng()),input.val(halo.location.getCurrentAddress()),$control.trigger("changeFilter.halo")):alert("We can not detect your current position")})})})}function initGmapPlaceSearch($ele){{var $this=jQuery($ele),input=jQuery(".halo-field-location-name",$this),latInput=jQuery(".halo-field-location-lat",$this),lngInput=jQuery(".halo-field-location-lng",$this);$this.attr("id")}halo.location.loadScript(function($ele,nameInput,latInput,lngInput){function fillInAddress(){var place=autocomplete.getPlace();if(place.geometry){var loc=place.geometry.location;latInput.val(loc.lat()),lngInput.val(loc.lng());var datum={name:input.val(),lat:loc.lat(),lng:loc.lng()};input.trigger("location.change.halo",[datum]),$ele.trigger("changeFilter.halo")}}if(nameInput&&nameInput.length){var autocomplete=new google.maps.places.Autocomplete(nameInput[0],{types:["geocode"]});google.maps.event.addListener(autocomplete,"place_changed",function(){fillInAddress()})}},[$this,input,latInput,lngInput])}function initHALOPlaceSearch($ele){function suggestionTemplate(context){return Hogan.compile('<p class="name">{{name}}</p>').render(context)}function showMap(lat,lng,title,canvasId){halo.location.loadScript(function(){{var myLatlng=new google.maps.LatLng(lat,lng),myOptions={zoom:16,center:myLatlng,mapTypeId:google.maps.MapTypeId.ROADMAP},map=new google.maps.Map(document.getElementById(canvasId),myOptions);new google.maps.Marker({position:myLatlng,map:map,draggable:!0,title:title})}})}var $this=jQuery($ele),input=jQuery(".halo-field-location-name",$this),controlId=(jQuery(".halo-field-location-lat",$this),jQuery(".halo-field-location-lng",$this),$this.attr("id")),locations=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:halo.util.mergeUrlParams(halo_jax_targetUrl,{term:"%QUERY",com:"autocomplete",func:"searchLocations",csrf_token:jQuery('meta[name="csrf_token"]').attr("content")}),beforeSend:function(jqXhr,settings){return settings.data=JSON.stringify({com:"autocomplete",func:"searchLocations",csrf_token:jQuery('meta[name="csrf_token"]').attr("content")}),!0}}});locations.initialize(),input.typeahead({highlight:!0},{name:"locations",displayKey:"name",source:locations.ttAdapter(),templates:{header:'<div class="halo-location-suggestion-header"><a href="javascript:void(0)" onclick="halo.location.showCheckin(\''+controlId+"');return false;\">"+__halotext("Click here to check in your location")+"</a></div>",
empty:'<div class="halo-location-not-found text-center">'+__halotext("No Location matched")+"</div>",suggestion:suggestionTemplate,footer:'<div id="halo-location-suggestion" class="halo-location-suggestion hidden" style="height:150px"></div>'},engine:Hogan}).on("typeahead:cursorchanged",function(object,datum){jQuery("#halo-location-suggestion").removeClass("hidden"),showMap(datum.lat,datum.lng,datum.name,"halo-location-suggestion")}).on("typeahead:selected",function(object,datum){halo.location.setLocationData(controlId,datum)}).on("typeahead:autocompleted",function(object,datum){halo.location.setLocationData(controlId,datum)}).on("keydown",function(e){var code=e.keyCode||e.which;return code!=halo.keycode.ENTER||e.shiftKey||(e.preventDefault(),""!=jQuery.trim(jQuery(this).val()))?void 0:(halo.location.setLocationData(controlId,{lng:"",lat:"",name:""}),!1)})}var controls=jQuery(".halo-location-control",scope);controls.each(function(){var $this=jQuery(this),placeType=$this.attr("data-place-type");switch(placeType){case"halo":initHALOPlaceSearch($this);break;case"gmap":default:initGmapPlaceSearch($this)}}),initCurrentLocationDetect(scope)},getDistance:function(pos1,pos2){var r=3963,lat1=pos1.lat()/57.2958,lng1=pos1.lng()/57.2958,lat2=pos2.lat()/57.2958,lng2=pos2.lng()/57.2958,dis=r*Math.acos(Math.sin(lat1)*Math.sin(lat2)+Math.cos(lat1)*Math.cos(lat2)*Math.cos(lng2-lng1));return dis}}}),jQuery.extend(!0,halo,{emoji:{setup:!1,runSetup:function(){halo.emoji.setup||(emojify.setConfig({emojify_tag_type:"div",only_crawl_id:null,img_dir:halo_assets_url+"/images/emoji",ignored_tags:{SCRIPT:1,TEXTAREA:1,A:1,PRE:1,CODE:1}}),halo.emoji.setup=!0)},init:function(scope){halo.emoji.runSetup(),emojify.run(jQuery(scope)[0])},popular:["smile","scream","bamboo","heart_eyes","grin","kissing_heart","smiley","wink","grinning","sweet_potato","stuck_out_tongue_winking_eye","smirk","ok_hand","stuck_out_tongue_closed_eyes","clap","raised_hands","dancer","joy","kissing_closed_eyes","pensive","skull","unamused","full_moon_with_face","princess","angry","kiss","flushed","weary","see_no_evil","hear_no_evil","stuck_out_tongue","disappointed","sleepy","kissing","relieved","cry","rage","-1","+1","muscle","facepunch","sunglasses","cupid","broken_heart","fire","two_hearts","v","heart"]}}),jQuery.extend(!0,halo,{markdown:{init:function(scope){halo.util.isMobile()||"undefined"!=typeof HTMLDocument&&scope instanceof HTMLDocument||jQuery('textarea[data-provide="markdown"]',jQuery(scope)).markdown()}}}),!function($){"use strict";function updateInput($table){var data=[],$container=$table.closest(".halo-jsontable-container"),input=jQuery('[name="'+$table.attr("data-jsoninput")+'"]',$container),readonly=$table.attr("data-jsonreadonly");if(input.length&&("undefined"==typeof readonly||readonly===!1)){var rows=jQuery("thead,tr",$table);rows.each(function(){var cells=jQuery("th,td",jQuery(this)),rowData=[],isEmptyRow=!0;cells.each(function(){var text=jQuery(this).text();text==String.fromCharCode(halo.keycode.NBSP)&&(text=""),rowData.push(text),text.length&&(isEmptyRow=!1)}),isEmptyRow||data.push(rowData)}),input.val(JSON.stringify(data))}}function getNextCell(cell,table){var nextCell=cell.nextAll("td").first();if(!nextCell.length){var nextRow=cell.parent().nextAll("tr").first();nextRow.length||(nextRow=Jsontable.prototype.addRow(table,-1)),nextCell=jQuery("td",nextRow).first()}return nextCell}function getPrevCell(cell,table){var prevCell=cell.prev("td");if(!prevCell.length){var prevRow=cell.parent().prev("tr");if(!prevRow.length)return cell;prevCell=jQuery("td",prevRow).last()}return prevCell}function renderTable($this,element,options){var $table=jQuery(element),$container=$table.closest(".halo-jsontable-container"),input=jQuery('[name="'+options.jsoninput+'"]',$container);if(input.length){var data;try{data=jQuery.parseJSON(input.val())}catch(err){data=jQuery.parseJSON(input.attr("data-default"))}var $thead=jQuery("<thead></thead>"),$tbody=jQuery("<tbody></tbody>");if(jQuery.isArray(data)&&data.length){var hasBody=!1;if(jQuery.each(data,function(index,row){if(jQuery.isArray(row))if(0==index)$thead=jQuery("<thead></thead>"),jQuery.each(row,function(i,col){$thead.append("<th>"+col+"</th>")});else{var $tr=jQuery("<tr></tr>");jQuery.each(row,function(i,col){$tr.append("<td>"+col+"</td>")}),$tbody.append($tr),hasBody=!0}}),!hasBody){var $emptyRow=jQuery("<tr></tr>");jQuery("th",$thead).each(function(){$emptyRow.append("<td></td>")}),$tbody.append($emptyRow)}}else $thead=jQuery("<thead><th></th><th></th></thead>"),$tbody=jQuery("<tr><td></td><td></td></tr>");if($table.html($thead),$table.append($tbody),!jQuery(".halo-table-toolbar",$table.closest(".form-group")).length&&!options.jsonreadonly){var $toolbar=jQuery('<div class="halo-table-toolbar"></div>');input.after($toolbar);var addButton=jQuery('<a class="halo-btn halo-btn-default halo-btn-xs halo-jsontable-add-btn" href="javascript:void(0)" title="'+__halotext("Add New Row")+'"><i class="fa fa-plus-square"></i> </a>');addButton.on("click",function(e){Jsontable.prototype.addRow($table,-1)}),$toolbar.append(addButton);var deleteButton=jQuery('<a class="halo-btn halo-btn-default halo-btn-xs halo-jsontable-delete-btn" href="javascript:void(0)" title="'+__halotext("Delete Selected Row")+'"><i class="fa fa-times-circle"></i> </a>');deleteButton.on("click",function(e){Jsontable.prototype.deleteRows($table)}),$toolbar.append(deleteButton);var insertButton=jQuery('<a class="halo-btn halo-btn-default halo-btn-xs halo-jsontable-insert-btn" href="javascript:void(0)" title="'+__halotext("Insert Row Above")+'"><i class="fa fa-sign-in"></i> </a>');insertButton.on("click",function(e){var rows=jQuery("tr",$table),selectedRowPos=-1;rows.each(function(index,value){jQuery(value).hasClass("info")&&(selectedRowPos=index)}),Jsontable.prototype.addRow($table,selectedRowPos)}),$toolbar.append(insertButton);var clearButton=jQuery('<a class="halo-btn halo-btn-default halo-btn-xs halo-jsontable-clear-btn" href="javascript:void(0)" title="'+__halotext("Erase table")+'"><i class="fa fa-eraser"></i> </a>');clearButton.on("click",function(e){input.val(input.attr("data-default")),renderTable($this,element,options)}),$toolbar.append(clearButton)}}}var tablecell="[data-jsontable] td,[data-jsontable] th",Jsontable=function(element,options){this.$element=jQuery(element),this.options=options,this.init(element,options)};Jsontable.DEFAULTS={interval:5e3,jsonreadonly:!1,jsoninput:null},Jsontable.prototype={constructor:Jsontable,init:function(element,options){var $this=jQuery(this);return renderTable($this,element,options),!1},addRow:function($table,pos){var $newRow=jQuery("<tr></tr>");jQuery("th",$table).each(function(){$newRow.append("<td></td>")});var $rows=jQuery("tr",$table);return $rows.length&&"undefined"!=typeof $rows[pos]?jQuery($rows[pos]).after($newRow):jQuery("tbody",$table).append($newRow),updateInput($table),$newRow},deleteRows:function($table){var $rows=jQuery("tr.info",$table);$rows.length&&$rows.remove(),updateInput($table)},selectRow:function(e){var $e=jQuery(this),$table=$e.closest("[data-jsontable]");jQuery("tr",$table).removeClass("info"),$e.closest("tr").addClass("info")},inlineEdit:function(e){var targetElement=jQuery(this),$table=targetElement.closest("[data-jsontable]"),readonly=$table.attr("data-jsonreadonly");if("undefined"!=typeof readonly&&readonly!==!1)return!1;var replaceWith=jQuery('<input class="halo-inlineEditInput" type="text" />');replaceWith.on("blur",function(){jQuery(this).trigger("inlineEdit.done")}),replaceWith.on("keydown",function(e){var code=e.keyCode||e.which;if(code==halo.keycode.ENTER&&!e.shiftKey||code==halo.keycode.TAB){if(jQuery(this).trigger("inlineEdit.done"),e.shiftKey)var cell=getPrevCell(targetElement,$table);else var cell=getNextCell(targetElement,$table);return null!==cell&&cell.trigger("click.jsontable.data-api"),!1}return code==halo.keycode.ESCAPE?(jQuery(this).trigger("inlineEdit.cancel"),e.stopImmediatePropagation(),e.stopPropagation(),!1):void 0}),replaceWith.on("inlineEdit.done",function(){var text=jQuery(this).val();""==text&&(text=String.fromCharCode(halo.keycode.NBSP)),targetElement.text(jQuery(this).val()),targetElement.show(),jQuery(this).remove();var $table=targetElement.closest("[data-jsontable]");$table.length&&updateInput($table)}),replaceWith.on("inlineEdit.cancel",function(){targetElement.show(),jQuery(this).remove()});var headerElement=jQuery(jQuery("th",$table)[targetElement.index()]),height=Math.max(targetElement.outerHeight(),headerElement.height()),width=Math.max(targetElement.outerWidth(),headerElement.width());targetElement.hide();var text=targetElement.text();return text==String.fromCharCode(halo.keycode.NBSP)&&(text=""),replaceWith.css("height",height).css("width",width).val(text),targetElement.after(replaceWith),replaceWith.focus(),!1}};var old=jQuery.fn.jsontable;jQuery.fn.jsontable=function(option){return this.each(function(){var $this=jQuery(this),data=$this.data("jsontable"),options=jQuery.extend({},Jsontable.DEFAULTS,$this.data(),"object"==typeof option&&option);data||$this.data("jsontable",data=new Jsontable(this,options)),"string"==typeof option&&data[option].call($this)})},jQuery.fn.jsontable.Constructor=Jsontable,jQuery.fn.jsontable.noConflict=function(){return jQuery.fn.jsontable=old,this},jQuery(document).on("click.jsontable.data-api",tablecell,Jsontable.prototype.inlineEdit).on("click.jsontable.data-api",tablecell,Jsontable.prototype.selectRow)}(window.jQuery),!function($){function cutOffOverflowTab(){jQuery(".halo-tab-overflow").each(function(){var $this=jQuery(this),$currList=jQuery(".halo-overflow-dropdown > .halo-overflow-list",$this).first(),$tabsContainer=$this.children(".nav-tabs");$currList.length&&($currList.children("li").appendTo($tabsContainer),$currList.closest(".halo-overflow-dropdown").remove());var maxWidth=$this.width(),$moreList=jQuery('<ul class="halo-overflow-list halo-dropdown-menu" role="menu"></ul>'),$more=jQuery('<li class="halo-overflow-dropdown halo-dropdown"><a href="#" data-htoggle="dropdown">'+__halotext("More")+' <b class="caret"></b></a></li>');$more.append($moreList);var moreWidth=80,sumWidth=0;$tabsContainer.children("li").each(function(){var $li=jQuery(this);sumWidth+=$li.width(),maxWidth>sumWidth+moreWidth||$li.appendTo($moreList)}),sumWidth+moreWidth>maxWidth&&$tabsContainer.append($more)})}function showTab(ele,dir){var currentTab=jQuery(ele),targetTab=null;if(currentTab.length&&(targetTab=1==dir?currentTab.next():currentTab.prev(),targetTab&&targetTab.length)){var targetTabId=targetTab.attr("id");if(targetTabId){var targetTab=jQuery('[data-target="#'+targetTabId+'"]');targetTab.length&&targetTab.htab("show")}}}jQuery(document).on("ready",function(e){cutOffOverflowTab()}),jQuery(window).on("resize",halo.util.throttle(function(){cutOffOverflowTab()},500)),jQuery(document).on("swipeleft",".halo-tab-overflow .halo-hammer",halo.util.throttle(function(e){showTab(this,1)},300)),jQuery(document).on("swiperight",".halo-tab-overflow .halo-hammer",halo.util.throttle(function(e){showTab(this,-1)},300))}(window.jQuery),!function($){function cutOffOverflowedItems(scope,firstItem){jQuery(".halo-stacked-list",scope).addBack(".halo-stacked-list").each(function(){var $this=jQuery(this);$this.css("visibility","hidden");var stackedClass=$this.attr("data-stacked-class");"undefined"==typeof stackedClass&&(stackedClass="halo-btn halo-btn-default");var $currList=jQuery(".halo-stacked-items > .halo-overflow-list",$this),$listContainer=jQuery(".halo-list-container",$this);$currList.length&&($currList.children().appendTo($listContainer),$currList.closest(".halo-stacked-items").remove());var maxWidth=$this.width(),$moreList=jQuery('<ul class="halo-dropdown-menu halo-overflow-list" role="menu"></ul>'),$more=jQuery('<li class="halo-stacked-items halo-dropdown dropup"><a href="#" class="'+stackedClass+'" data-htoggle="dropdown"><i class="fa fa-th-list"></i></a></li>');$more.append($moreList);var moreWidth=80,sumWidth=0,$itemsList=[];"undefined"!=typeof firstItem&&firstItem.length?($itemsList.push(firstItem),firstItem.nextAll().each(function(){$itemsList.push(jQuery(this))}),jQuery(firstItem.prevAll().get().reverse()).each(function(){$itemsList.push(jQuery(this))})):$itemsList=jQuery.merge($itemsList,jQuery(".halo-list-container > li",$this)),jQuery.each($itemsList,function(){var $li=jQuery(this);sumWidth+=$li.width(),$li.appendTo(maxWidth>sumWidth+moreWidth?$listContainer:$moreList)}),$moreList.children().length&&sumWidth+moreWidth>maxWidth&&$listContainer.append($more),$this.css("visibility","visible")})}jQuery(document).on("click.halostackedlist.api",".halo-stacked-items .halo-dropdown-menu > li",function(e){cutOffOverflowedItems(jQuery(this).closest(".halo-stacked-list").parent(),jQuery(this))}),jQuery(document).on("click.halostackedlist.api",".halo-stacked-items .halo-dropdown-menu > li > .halo-dropdown-toggle",function(e){var $li=jQuery(this).parent();cutOffOverflowedItems($li.closest(".halo-stacked-list").parent(),$li)}),jQuery(document).on("ready",function(e){cutOffOverflowedItems(document)}),jQuery(window).on("resize",halo.util.throttle(function(){cutOffOverflowedItems(document)},500));jQuery.fn.hpopover;jQuery.fn.haloStackedList=function(options){return this.each(function(){cutOffOverflowedItems(jQuery(this))})}}(window.jQuery),!function($){function updateCtrlState(groupcheck){var $ctrl=jQuery('[data-halo-groupcheck="'+groupcheck+'"].halo-groupcheck-ctrl');if($ctrl.length){var checkedList=jQuery('[data-halo-groupcheck="'+groupcheck+'"].halo-groupcheck-ele:checked'),list=jQuery('[data-halo-groupcheck="'+groupcheck+'"].halo-groupcheck-ele');list.length&&(list.length==checkedList.length?($ctrl.prop("checked",!0),$ctrl.removeClass("halo-groupcheck-partial")):checkedList.length?($ctrl.prop("checked",!0),$ctrl.addClass("halo-groupcheck-partial")):($ctrl.prop("checked",!1),$ctrl.removeClass("halo-groupcheck-partial")))}}function init(scope){jQuery("[data-halo-groupcheck]",scope).each(function(){updateCtrlState(jQuery(this).attr("data-halo-groupcheck"))})}jQuery.fn.groupcheck;jQuery.fn.groupcheck=function(option){return this.each(function(){init(this)})},jQuery(document).on("click",".halo-groupcheck-ctrl",function(e){var $this=jQuery(this),groupcheck=$this.attr("data-halo-groupcheck"),checked=$this.prop("checked");$this.removeClass("halo-groupcheck-partial"),jQuery('[data-halo-groupcheck="'+groupcheck+'"].halo-groupcheck-ele').prop("checked",checked)}),jQuery(document).on("click",".halo-groupcheck-ele",function(e){var groupcheck=jQuery(this).attr("data-halo-groupcheck");groupcheck.length&&updateCtrlState(groupcheck)}),jQuery(document).on("ready",function(){init(this)})}(window.jQuery),function($,window,undefined){var $allDropdowns=jQuery();jQuery.fn.dropdownHover=function(options){return"ontouchstart"in document?this:($allDropdowns=$allDropdowns.add(this.parent()),this.each(function(){var timeout,$this=jQuery(this),$parent=$this.parent(),defaults={delay:500,instantlyCloseOthers:!0},data={delay:jQuery(this).data("delay"),instantlyCloseOthers:jQuery(this).data("close-others")},showEvent="show.bs.hdropdown",hideEvent="hide.bs.hdropdown",settings=jQuery.extend(!0,{},defaults,options,data);$parent.hover(function(event){return $parent.hasClass("open")||$this.is(event.target)?($allDropdowns.find(":focus").blur(),settings.instantlyCloseOthers===!0&&$allDropdowns.removeClass("open"),window.clearTimeout(timeout),$parent.addClass("open"),void $this.trigger(showEvent)):!0},function(){timeout=window.setTimeout(function(){$parent.removeClass("open"),$this.trigger(hideEvent)},settings.delay)}),$this.hover(function(){$allDropdowns.find(":focus").blur(),settings.instantlyCloseOthers===!0&&$allDropdowns.removeClass("open"),window.clearTimeout(timeout),$parent.addClass("open"),$this.trigger(showEvent)}),$parent.find(".dropdown-submenu").each(function(){var subTimeout,$this=jQuery(this);$this.hover(function(){window.clearTimeout(subTimeout),$this.children(".halo-dropdown-menu").show(),$this.siblings().children(".halo-dropdown-menu").hide()},function(){var $submenu=$this.children(".halo-dropdown-menu");subTimeout=window.setTimeout(function(){$submenu.hide()},settings.delay)})})}))},jQuery(document).ready(function(){jQuery('[data-hover="dropdown"]').dropdownHover()})}(jQuery,this),!function($){"use strict";function toggleDisplay(e){var $target,$this=jQuery(this),targetSelector=$this.attr("data-target");$target="undefined"!=typeof targetSelector?jQuery(targetSelector):jQuery(this).nextAll(".halo-toggle-display").first();var isHidden=$target.hasClass("hidden"),siblingsSelector=jQuery(this).attr("data-siblings");jQuery(siblingsSelector).addClass("hidden"),isHidden?($target.removeClass("hidden"),$target.trigger("shown.display.halo")):($target.addClass("hidden"),$target.trigger("hidden.display.halo"))}var displayEle='[data-htoggle="display"]';jQuery(document).on("click.halodisplay.data-api",displayEle,toggleDisplay)}(window.jQuery),!function($){"use strict";function toggleUIHandler(event){toggleUI(this)}function toggleUI(ele,retries,stopPropagate){var $ele=jQuery(ele),targetSelector=$ele.attr("data-uitoggle");if(retries=retries?retries:5,targetSelector){var uiSettings,parts=targetSelector.split(".");if(parts.length>1){var pkg=parts[0],uiKey=parts.slice(1).join(".");if("undefined"!=typeof __toggleUISettings[pkg]){uiSettings=__toggleUISettings[pkg][uiKey];var uiKey=$ele.attr("data-uikey");if(!stopPropagate&&uiKey){var similarSelector='[data-uitoggle^="'+parts[0]+"."+parts[1]+'"][data-uikey="'+uiKey+'"]',$propagation=jQuery(similarSelector);$propagation.length&&$propagation.each(function(){var $this=jQuery(this);$this[0]!=$ele[0]&&toggleUI($this,5,!0)})}applyUISetting($ele,uiSettings)}else retries--,retries&&halo.jax.call("system","loadUISettings",pkg,halo.util.throttle(function(){toggleUI($ele,retries)},100))}}}function applyUISetting($ele,uiSettings){uiSettings&&uiSettings.func&&halo.uitoggle[uiSettings.func]&&halo.uitoggle[uiSettings.func].apply($ele,[uiSettings])}var eleSelector="[data-uitoggle]",__toggleUISettings={};jQuery(document).on("click",eleSelector,toggleUIHandler),jQuery.extend(!0,halo,{uitoggle:{savePkg:function(pkg,data){var obj=JSON&&JSON.parse(data)||jQuery.parseJSON(data);__toggleUISettings[pkg]=obj},toggle:function(settings){var $this=jQuery(this),eleHtml=$this.outerHTML();if(settings.states&&jQuery.isArray(settings.states)){for(var states=settings.states,i=0,found=-1;i<states.length&&-1===found;)if(jQuery.isArray(states[i])){for(var j=0,skip=!1;j<states[i].length&&!skip;){if(eleHtml.search(states[i][j])<0){skip=!0;break}j++}if(!skip){found=i;break}i++}if(found>=0){var newState=(found+1)%states.length;$this.haloReplaceHtml(states[found],states[newState])}}},replace:function(settings){var $this=jQuery(this);$this.haloReplaceHtml(settings.sVal,settings.nVal)},hide:function(settings){jQuery(this).hide()}}})}(window.jQuery),!function($){"use strict";jQuery(document).on("shown.bs.htab",'a[data-htoggle="tab"][data-ondisplay]',function(){var $this=jQuery(this),handler=$this.attr("data-ondisplay");halo.util.setUrlParam({},halo.util.getQueryObj(this.href));var tmpFunc=new Function(handler);tmpFunc.context=$this,tmpFunc();var ptitle=$this.attr("data-title");ptitle&&halo.util.updatePageTitle(ptitle)}),jQuery(document).on("ready",function(){var $active=jQuery('.active a[data-htoggle="tab"][data-ondisplay]'),handler=$active.attr("data-ondisplay");if($active.length){var tmpFunc=new Function(handler);tmpFunc.context=$active,tmpFunc()}})}(window.jQuery),!function($){"use strict";jQuery(document).on("click.halo.pagination","a.halo-pagination-link[data-pagination-page]",halo.util.throttle(function(event){event.preventDefault();var $this=jQuery(this),page=$this.attr("data-pagination-index"),$form=$this.closest("form"),keepUrl=!1;$this.hasClass("halo-pagination-auto")&&(keepUrl=!0),halo.util.changePage($form,page,keepUrl)},1e3)).on("click.halo.pagination","a.halo-paging-nav-prev, a.halo-paging-nav-next",function(event){event.preventDefault();var $this=jQuery(this),page=$this.attr("data-pagination-index"),wrapper=$this.closest(".halo-section-container");if(wrapper.length){var $form=jQuery(".halo-pagniation-frm",wrapper),keepUrl=!1;$this.hasClass("halo-pagination-auto")&&(keepUrl=!0),halo.util.changePage($form,page,keepUrl)}})}(window.jQuery),!function($){"use strict";function toggleContent(e){var filterContentId=jQuery(this).attr("data-filter-content");jQuery("#"+filterContentId).toggleClass("hidden")}function toggleItem(e){var $this=jQuery(this),$singleContainer=$this.closest(".halo-single-select");$singleContainer.length&&jQuery(".halo-filter-toggle",$singleContainer).each(function(index,ele){ele!=$this[0]&&setState(jQuery(ele),"unchecked")}),isChecked($this)?setState($this,"unchecked"):setState($this,"checked");var $filterLabel=getFilterLabel($this);$filterLabel.trigger("change")}function changeText(e){var $this=jQuery(this),$label=getFilterLabel($this),tagManager=getTagManager($label);$this.attr("data-halo-value",$this.val());var tagId=getTagId($this),lbl=$this.val(),dataLabel=$this.attr("data-halo-label");if(dataLabel)lbl="["+dataLabel+": "+lbl+"]";else{var $filterTitle=jQuery(".halo-filter-title",$this.closest(".halo-filter-rule"));lbl=$filterTitle.length?"["+$filterTitle.text()+": "+lbl+"]":lbl}lbl=lbl.replace(/,/g," - ");var value=$this.val();""==value?tagManager.tagsManager("spliceTag",tagId):(tagManager.tagsManager("spliceTagSilent",tagId),$this.val(value),isChecked($this)&&tagManager.tagsManager("pushTag",lbl,!1,tagId)),$label.trigger("change")}function changeTag(e){var $this=jQuery(this),$label=getFilterLabel($this),tagManager=getTagManager($label);$this.attr("data-halo-value",$this.val());var tagId=getTagId($this),lbl=$this.val(),dataLabel=$this.attr("data-halo-label");if(dataLabel)lbl=""+dataLabel+": ";else{var $filterTitle=jQuery(".halo-filter-title",$this.closest(".halo-filter-rule"));lbl=$filterTitle.length?""+$filterTitle.text()+": ":lbl}var value=$this.val();if(""==value);else{var $tagInputs=jQuery('input[data-tag-orgid="'+tagId+'"]'),newTagValues=value.split(",");$tagInputs.each(function(){var $this=jQuery(this),val=$this.val(),index=newTagValues.indexOf(val);if(index>-1)newTagValues.splice(index,1);else{var removeTagId=$this.attr("id");tagManager.tagsManager("spliceTagSilent",removeTagId)}}),newTagValues.length&&jQuery.each(newTagValues,function(index,value){var newTagId=halo.util.uniqID();jQuery('<input class="halo-filter-tag-child" type="hidden" data-tag-orgid="'+tagId+'" id="'+newTagId+'" value="'+value+'">').insertAfter($this),tagManager.tagsManager("pushTag","[#"+value+"]",!1,newTagId)})}$label.trigger("change")}function changeLocation(e){var $this=jQuery(this),$label=getFilterLabel($this),tagManager=getTagManager($label);$this.attr("data-halo-value",$this.val());var tagId=getTagId($this),lbl=$this.val(),$filterTitle=jQuery(".halo-filter-title",$this.closest(".halo-filter-rule"));lbl=$filterTitle.length?"["+$filterTitle.text()+": "+lbl+"]":lbl;var value=$this.val();""==value?tagManager.tagsManager("spliceTag",tagId):(tagManager.tagsManager("spliceTagSilent",tagId),$this.val(value),isChecked($this)&&tagManager.tagsManager("pushTag",lbl,!1,tagId)),$label.trigger("change")}function getTagManager($label){function onDeleteFilterTag(event){$label.trigger("change")}function onRemoveFilterTag(event,tagName,tagId){var $this=jQuery("#"+tagId),inputName=$this.attr("data-halo-input"),inputVal=$this.attr("data-halo-value");if(inputName)var $input=jQuery('[name="'+inputName+'"]',$this.closest(".halo-filter"));else{var $input=$this;inputName=$this.attr("name")}if($input.length){removeTag($this);var params={},val=jQuery.trim($input.val());if($this.hasClass("halo-filter-toggle"))$input.val(halo.util.remValFromArrText(inputVal,val));else if($this.hasClass("halo-filter-text"))$input.val($this.val());else if($this.hasClass("halo-filter-tag-child")){var $oldInput=$input;$input=jQuery("#"+$input.attr("data-tag-orgid")),inputName=$input.attr("name"),$input.val(halo.util.remValFromArrText($oldInput.val(),jQuery.trim($input.val()))).trigger("tm:sync"),$oldInput.remove()}else if($this.hasClass("halo-filter-location")){$this.val(""),$input.val($this.val());var $inputLat=$input.siblings(".halo-field-location-lat").val(""),$inputLng=$input.siblings(".halo-field-location-lng").val("");params[$inputLat.attr("name")]=$inputLat.val(),params[$inputLng.attr("name")]=$inputLng.val()}params[inputName]=$input.val(),updateUrl($this,params)}}function onAddFilterTag(event,tagName,tagId){var $this=jQuery("#"+tagId),inputName=$this.attr("data-halo-input"),inputVal=$this.attr("data-halo-value");if(inputName)var $input=jQuery('[name="'+inputName+'"]',$this.closest(".halo-filter"));else{var $input=$this;inputName=$this.attr("name")}if($input.length){var params={},val=jQuery.trim($input.val());if($this.hasClass("halo-filter-toggle"))$input.val(halo.util.addValToArrText(inputVal,val));else if($this.hasClass("halo-filter-text"))$input.val($this.val());else if($this.hasClass("halo-filter-tag-child"))$input=jQuery("#"+$input.attr("data-tag-orgid")),inputName=$input.attr("name");else if($this.hasClass("halo-filter-location")){$input.val($this.val());var $inputLat=$input.siblings(".halo-field-location-lat"),$inputLng=$input.siblings(".halo-field-location-lng");params[$inputLat.attr("name")]=$inputLat.val(),params[$inputLng.attr("name")]=$inputLng.val()}params[inputName]=$input.val(),updateUrl($this,params)}}function updateUrl($ele,params){if(inited){var $label=getFilterLabel($ele),oldParams=$label.data("oldParams");halo.util.setUrlParam(params,oldParams),$label.data("oldParams",halo.util.getCurrentQueryObj())}}var id=$label.attr("id");if("undefined"==typeof tagManagers[id]){var tagManager=$label.tagsManager({onlyTagList:!0,tagClass:"tm-tag-info",tagsContainer:jQuery("."+id),preventSubmitOnEnter:!0,hiddenTagListName:"",externalTagId:!0}).on("tm:popped",onRemoveFilterTag).on("tm:spliced",onRemoveFilterTag).on("tm:pushed",onAddFilterTag).on("tm:delete",onDeleteFilterTag);tagManagers[id]=tagManager}return tagManagers[id]}function getTagId($ele){return $ele.attr("id")}function getFilterLabel($ele){var labelId=$ele.closest(".halo-filter-content").attr("data-filter-label"),$label=jQuery("#"+labelId);return $label}function setState($ele,state){function updateFilterTag($ele){var $title=$ele.hasClass("halo-tree-node")?$ele.next():$ele,lbl=$title.clone().children().remove().end().text(),tagManager=getTagManager($label),$filterTitle=jQuery(".halo-filter-title",$ele.closest(".halo-filter-rule"));lbl=$filterTitle.length?"["+$filterTitle.text()+": "+lbl+"]":lbl;var tagId=($ele.attr("data-halo-input"),$ele.attr("data-halo-value"),getTagId($ele));isChecked($ele)?tagManager.tagsManager("pushTag",lbl,!1,tagId):tagManager.tagsManager("spliceTag",tagId)}var $this=$ele,$isChecked=jQuery("i",$this).first(),$label=getFilterLabel($this);if(isChecked($this)&&"checked"!=state)$isChecked.replaceWith(jQuery(unCheckedIcon));else{if(isChecked($this)||"checked"!=state)return;$isChecked.replaceWith(jQuery(checkedIcon))}updateFilterTag($this)}function isChecked($ele){if($ele.hasClass("halo-filter-toggle")){var $isChecked=jQuery("i",$ele).first();return $isChecked.hasClass("checked-filter")}return $ele.hasClass("halo-filter-text")||$ele.hasClass("halo-filter-tag")?$ele.val().length>0:$ele.hasClass("halo-filter-location")?$ele.val().length>0:void 0}function removeTag($ele){$ele.hasClass("halo-filter-toggle")?setState($ele,"unchecked"):$ele.hasClass("halo-filter-text")&&$ele.val("")}var displayEle='[data-htoggle="filter"]',filterItem=".halo-filter-content .halo-filter-toggle[id]",filterText=".halo-filter-content .halo-filter-text[id]",filterTag=".halo-filter-content .halo-filter-tag[id]",filterSlider=".halo-filter-content .halo-filter-slider[id]",filterLocation=".halo-filter-content .halo-filter-location[id]",checkedIcon='<i class="fa fa-check-square-o text-success checked-filter"></i>',unCheckedIcon='<i class="fa fa-square-o"></i>',inited=!1,tagManagers={};jQuery(document).on("click.filterDisplay.data-api",displayEle,toggleContent).on("click.filterItem.data-api",filterItem,toggleItem).on("change.filterItem.data-api",filterText,changeText).on("change.filterItem.data-api",filterTag,changeTag).on("slideStop.filterItem.data-api",filterSlider,changeText).on("location.change.halo",filterLocation,changeLocation).ready(function(){jQuery('.halo-filter [name*="filter"]').each(function(){var $input=jQuery(this),filterName=$input.attr("name"),filterVal=jQuery.trim($input.val()),filterItems=filterVal.length?filterVal.split(","):[];jQuery.each(filterItems,function(index,val){var $ele=jQuery('.halo-filter [data-halo-input="'+filterName+'"][data-halo-value="'+val+'"]');$ele.length&&($ele.hasClass("halo-filter-toggle")?setState($ele,"checked"):$ele.hasClass("halo-filter-text")?$ele.each(function(index,ele){jQuery(ele).val(val),jQuery(ele).trigger("change")}):$ele.hasClass("halo-filter-location")&&$ele.each(function(index,ele){jQuery(ele).val(val),jQuery(ele).trigger("location.change.halo")}))}),inited=!0})})}(window.jQuery),jQuery.extend(!0,halo,{ga:{options:{config:{trackingId:"UA-XXXX-Y",cookieDomain:"auto"},hits:[]},inited:!1,debug:!1,loadedApi:!1,init:function(scope){if(!halo.ga.inited){halo.ga.inited=!0;var $e=jQuery("#halo_gatracking"),options=null;if($e.length)try{options=jQuery.parseJSON($e.attr("data-ga")),halo.ga.debug=parseInt($e.attr("data-gadebug"))}catch(ex){}"undefined"!=typeof options&&null!=options&&halo.ga.setupConfig(options),jQuery(document).on("halo_share",function(e,network){var params={socialNetwork:network,socialAction:"share",socialTarget:location.href};halo.ga.exe_social(params)})}},setupConfig:function(options){options=jQuery.extend({},halo.ga.options,options),HALOModernizr.load({load:("https:"==location.protocol?"//ssl":"//www")+".google-analytics.com/analytics.js",complete:function(){setTimeout(function(){ga("create",options.config);var hits=options.hits;halo.ga.processHits(hits)},100)}})},processHits:function(hits){jQuery.isArray(hits)||(hits=jQuery.parseJSON(hits));for(var i=0;i<hits.length;i++){var hit=hits[i];"undefined"!=typeof halo.ga["exe_"+hit.handler]&&(halo.ga.debug&&(hit.params.hitCallback=function(){halo.log("sent data",hit.handler,hit.params)}),halo.ga["exe_"+hit.handler].apply(this,[hit.params]))}},exe_pageview:function(params){"undefined"!=typeof ga&&ga("send","pageview",params)},exe_event:function(params){"undefined"!=typeof ga&&ga("send","event",params)},exe_social:function(params){"undefined"!=typeof ga&&ga("send","social",params)},exe_timing:function(params){"undefined"!=typeof ga&&ga("send","timing",params)},getData:function(query,cb){function initGGClientAPI(){function checkAuth(){gapi.auth.authorize({client_id:clientId,scope:scopes,immediate:!0},handleAuthResult)}function handleAuthResult(authResult){authResult?(jQuery(".authorize-wrapper").hide(),loadAnalyticsClient()):handleUnAuthorized()}function handleUnAuthorized(){var authorizeButton=jQuery(".authorize-button"),authorizeWrapper=jQuery(".authorize-wrapper");authorizeWrapper.show(),authorizeButton.on("click",handleAuthClick)}function handleAuthClick(event){return gapi.auth.authorize({client_id:clientId,scope:scopes,immediate:!1},handleAuthResult),!1}function loadAnalyticsClient(){gapi.client.load("analytics","v3",makeApiCall)}var clientId=jQuery("#halo_ggClientId").attr("data-gg"),apiKey=jQuery("#halo_ggApiKey").attr("data-gg"),scopes="https://www.googleapis.com/auth/analytics.readonly";return"undefined"==typeof clientId||" undefined"==typeof apiKey?{}:(gapi.client.setApiKey(apiKey),void window.setTimeout(checkAuth,1))}function makeApiCall(){var restRequest=gapi.client.request({path:"/analytics/v3/data/ga",params:query});restRequest.execute(handleCoreReportingResults)}function handleCoreReportingResults(results){return results.error?(jQuery.isFunction(cb)&&cb.apply(this,[results]),!1):void(jQuery.isFunction(cb)&&cb.apply(this,[results]));

}halo.ga.loadedApi?makeApiCall():HALOModernizr.load([{load:["https://apis.google.com/js/client.js"],complete:function(){setTimeout(function(){initGGClientAPI(),halo.ga.loadedApi=!0},100)}}])}}}),jQuery.extend(!0,halo,{autohide:{init:function(scope){$ele=jQuery(".halo-autohide",scope),$ele.length&&setTimeout(function(){jQuery(".halo-autohide").remove()},5e3)}}}),+function($){"use strict";var Tagging=function(element,options){this.tagApi=this.type=this.options=this.enabled=this.$element=null,this.init("tagging",element,options)};Tagging.DEFAULTS={selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',taggingFilters:"",trigger:"hover focus",title:"",delay:0,html:!1,container:!1},Tagging.prototype.init=function(type,element,options){function addTag(e,datum){that.addTag(datum),input.trigger("tagadded.halo")}this.enabled=!0,this.type=type,this.$element=jQuery(element),this.options=this.getOptions(options);var $element=this.$element,that=this,input=jQuery('<input name="tagginginput" value="" class="form-control">').insertBefore($element);$element.attr("type","hidden");var $tagsContainer=$element.parent();that.tagApi=input.tagsManager({onlyTagList:!0,tagClass:"tm-tag-info",tagsContainer:$tagsContainer,preventSubmitOnEnter:!0,externalTagId:!0}).on("tm:popped",function(tag,tagId){$element.val(that.tagApi.data("tlid").join(","))}).on("tm:spliced",function(tag,tagId){$element.val(that.tagApi.data("tlid").join(","))});var tags=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:halo.util.mergeUrlParams(halo_jax_targetUrl,{term:"%QUERY",com:"autocomplete",func:"searchUsers",csrf_token:jQuery('meta[name="csrf_token"]').attr("content")+(that.options.taggingFilters.length?"&"+that.options.taggingFilters:"")}),beforeSend:function(jqXhr,settings){return settings.data=JSON.stringify({com:"autocomplete",func:"searchUsers",csrf_token:jQuery('meta[name="csrf_token"]').attr("content")}),!0}}});tags.initialize(),input.typeahead({highlight:!0},{name:"tags",displayKey:"name",source:tags.ttAdapter(),templates:{empty:that.emptyTemplate(),suggestion:that.suggestionTemplate},engine:Hogan}).on("typeahead:selected",addTag).on("typeahead:autocompleted",addTag).on("focusout",function(){that.doneTagging()}).on("keydown",function(e){var code=e.keyCode||e.which;return code!=halo.keycode.ENTER||e.shiftKey||(e.preventDefault(),""!=jQuery.trim(jQuery(this).val()))?void 0:(that.doneTagging(),!1)})},Tagging.prototype.getDefaults=function(){return Tagging.DEFAULTS},Tagging.prototype.getOptions=function(options){return options=jQuery.extend({},this.getDefaults(),this.$element.data(),options)},Tagging.prototype.addTag=function(datum){this.tagApi.tagsManager("pushTag",datum.name,!1,datum.id),this.$element.val(this.tagApi.data("tlid").join(","));var newTagRemoveId=this.tagApi.data("tm_rndid")+"_Remover_"+datum.id,that=this;jQuery("#"+newTagRemoveId).on("click",function(e){that.spliceTag(datum.id),jQuery(this).closest(".tm-tag").remove()})},Tagging.prototype.suggestionTemplate=function(context){return Hogan.compile('<p class="name"><image class="halo-suggestion-img" src={{image}}>{{name}}</p>').render(context)},Tagging.prototype.emptyTemplate=function(){return'<div class="halo-location-not-found text-center">'+__halotext("No User Matched")+"</div>"},Tagging.prototype.doneTagging=function(){return!0},Tagging.prototype.spliceTag=function(tagId){this.tagApi.tagsManager("spliceTag",tagId)};var old=jQuery.fn.tagging;jQuery.fn.tagging=function(option){return this.each(function(){var $this=jQuery(this),data=$this.data("bs.tagging"),options="object"==typeof option&&option;data||$this.data("bs.tagging",data=new Tagging(this,options)),"string"==typeof option&&data[option]()})},jQuery.fn.tagging.Constructor=Tagging,jQuery.fn.tagging.noConflict=function(){return jQuery.fn.tagging=old,this}}(window.jQuery),+function($){jQuery(document).ready(function(){+function($){"use strict";var Popover=function(element,options){this.init("hpopover",element,options)};if(!jQuery.fn.tooltip)throw new Error("Popover requires tooltip.js");Popover.DEFAULTS=jQuery.extend({},jQuery.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),Popover.prototype=jQuery.extend({},jQuery.fn.tooltip.Constructor.prototype),Popover.prototype.constructor=Popover,Popover.prototype.getDefaults=function(){return Popover.DEFAULTS},Popover.prototype.setContent=function(){var $tip=this.tip(),title=this.getTitle(),content=this.getContent();$tip.find(".popover-title")[this.options.html?"html":"text"](title),$tip.find(".popover-content")[this.options.html?"html":"text"](content),$tip.removeClass("fade top bottom left right in"),$tip.find(".popover-title").html()||$tip.find(".popover-title").hide()},Popover.prototype.applyPlacement=function(offset,placement){var replace,$tip=this.tip(),width=$tip[0].offsetWidth,height=$tip[0].offsetHeight,marginTop=parseInt($tip.css("margin-top"),10),marginLeft=parseInt($tip.css("margin-left"),10);isNaN(marginTop)&&(marginTop=0),isNaN(marginLeft)&&(marginLeft=0),offset.top=offset.top+marginTop,offset.left=offset.left+marginLeft,$tip.offset(offset).addClass("in");var actualWidth=$tip[0].offsetWidth,actualHeight=$tip[0].offsetHeight,elePos=halo.util.getPosition(this.$element);if(offset.left=elePos.left,$tip.offset(offset),"top"==placement&&actualHeight!=height&&(replace=!0,offset.top=offset.top+height-actualHeight),/bottom|top/.test(placement)){var delta=0,windowWidth=jQuery(window).width();if(windowWidth/2>actualWidth){var elePost=halo.util.getPosition(this.$element);delta=actualWidth-elePost.width,elePost.left<windowWidth/2?(offset.left=elePost.left,delta>0&&this.replaceArrow(delta,actualWidth,"left")):(offset.left=elePost.right-actualWidth,delta>0&&this.replaceArrow(-delta,actualWidth,"left")),$tip.offset(offset)}else{if(offset.left<0)delta=-2*offset.left,offset.left=0,$tip.offset(offset),actualWidth=$tip[0].offsetWidth,actualHeight=$tip[0].offsetHeight,this.replaceArrow(delta-width+actualWidth,actualWidth,"left");else if(width+offset.left>windowWidth){offset.left=windowWidth-width-10,$tip.offset(offset);var pos=this.getPosition();this.replaceArrow(-(2*pos.width),actualWidth,"left")}var centerTip=offset.left+actualWidth/2,centerTarget=elePos.left+elePos.width/2;centerTarget>=offset.left&&centerTarget<=offset.left+actualWidth&&(delta=2*(centerTip-centerTarget),this.replaceArrow(delta,actualWidth,"left"))}}else this.replaceArrow(actualHeight-height,actualHeight,"top");replace&&$tip.offset(offset)},Popover.prototype.replaceArrow=function(delta,dimension,position){this.arrow().css(position,delta?50*(1-delta/dimension)+"%":"")},Popover.prototype.hasContent=function(){return this.getTitle()||this.getContent()},Popover.prototype.getContent=function(){var $e=this.$element,o=this.options;return $e.attr("data-content")||("function"==typeof o.content?o.content.call($e[0]):o.content)},Popover.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},Popover.prototype.tip=function(){return this.$tip||(this.$tip=jQuery(this.options.template)),this.$tip};var old=jQuery.fn.hpopover;jQuery.fn.hpopover=function(option){return this.each(function(){var $this=jQuery(this),data=$this.data("bs.hpopover"),options="object"==typeof option&&option;data||$this.data("bs.hpopover",data=new Popover(this,options)),"string"==typeof option&&data[option]()})},jQuery.fn.hpopover.Constructor=Popover,jQuery.fn.hpopover.noConflict=function(){return jQuery.fn.hpopover=old,this}}(window.jQuery),+function($){"use strict";function updateFilterGroup(ele){var $this=jQuery(ele),$filterLabel=$this.closest(".halo-filter").find(".halo-filter-label-input"),params={},$inputs=$this.find(".halo-popoverfilter-sub-input");$inputs.each(function(){params[jQuery(this).attr("name")]=jQuery(this).val()});$filterLabel.data("oldParams");$filterLabel.data("oldParams",halo.util.getCurrentQueryObj()),$filterLabel.trigger("change")}var ns={};ns.DateFilter=function(element,options,e){e&&(e.stopPropagation(),e.preventDefault()),this.$element=jQuery(element),this.$newElement=null,this.$button=null,this.$menu=null,this.options=options,this.$startdate=null,this.$enddate=null,this.$title=null,this.init()},ns.DateFilter.DEFAULTS=jQuery.extend({},{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),ns.DateFilter.prototype={getDefaults:function(){return DateFilter.DEFAULTS},init:function(){this.$newElement=this.$element.find(".halo-popupfilter-content"),this.$menu=this.$newElement.find("> .halo-dropdown-menu"),this.$button=this.$newElement.find("> button"),this.$startdate=this.$element.find(".start-date-input"),this.$enddate=this.$element.find(".end-date-input"),this.$within=this.$element.find(".within-date-input"),this.$morethan=this.$element.find(".morethan-date-input"),this.$title=this.$element.find(".filter-option"),this.originalTitle=this.$title.text(),this.activeMode=null,this.clickListener(),this.updateTitle()},render:function(){},setSize:function(){var width=Math.min(jQuery(window).width()-40,400);this.$menu.css({width:width+"px"})},clickListener:function(){var that=this;this.$newElement.on("touchstart.dropdown",".halo-dropdown-menu",function(e){e.stopPropagation()}),this.$newElement.on("click",function(e){that.setSize()}),this.$menu.on("click",function(e){e.preventDefault(),e.stopPropagation()}),this.$element.change(function(){that.render(!1)}),this.$startdate.change(function(){that.activeMode="between",that.resetValues(["$startdate","$enddate"]),that.updateTitle()}),this.$enddate.change(function(){that.activeMode="between",that.resetValues(["$startdate","$enddate"]),that.updateTitle()}),this.$within.change(function(evt){return!isNaN(jQuery(this).val())&&jQuery(this).val()>=0&&(that.activeMode="within",that.resetValues(["$"+that.activeMode]),that.updateTitle()),isNaN(jQuery(this).val())||jQuery(this).val()<0?(evt.preventDefault(),!1):void 0}),this.$morethan.change(function(evt){return!isNaN(jQuery(this).val())&&jQuery(this).val()>=0&&(that.activeMode="morethan",that.resetValues(["$"+that.activeMode]),that.updateTitle()),isNaN(jQuery(this).val())||jQuery(this).val()<0?(evt.preventDefault(),!1):void 0})},resetValues:function(exclusive){var keys=["$startdate","$enddate","$within","$morethan"];for(var key in keys)exclusive.indexOf(keys[key])<0&&"undefined"!=typeof this[keys[key]]&&this[keys[key]].val("")},updateTitle:function(){var title=[],titleStr=this.originalTitle,that=this;switch(null===that.activeMode&&(that.$startdate.val()||that.$enddate.val()?that.activeMode="between":that.$within.val()?that.activeMode="within":that.$morethan.val()?that.activeMode="morethan":that.activeMode="between"),that.activeMode){case"between":that.$startdate.val()&&title.push(that.$startdate.attr("data-halo-label")+" "+that.$startdate.val()),that.$enddate.val()&&title.push(that.$enddate.attr("data-halo-label")+" "+that.$enddate.val()),title.length&&(titleStr=title.join(" - "));break;case"within":that.$within.val()&&(titleStr=that.$within.attr("data-halo-label")+" "+that.$within.val()+" "+__halotext("day(s)"));break;case"morethan":that.$morethan.val()&&(titleStr=that.$morethan.attr("data-halo-label")+" "+that.$morethan.val()+" "+__halotext("day(s)"))}that.setAtiveLabel(that.activeMode),that.$title.html(titleStr),that.$button.attr("title",titleStr)},setAtiveLabel:function(mode){var modes={between:"dateBetween",within:"dateWithin",morethan:"dateMorethan"};if("undefined"!=typeof modes[mode]){var selector='[data-type="'+modes[mode]+'"] .halo-option-item';this.$newElement.find(".halo-option-item").empty(),this.$newElement.find(selector).append('<span class="fa fa-check"></span>')}}},ns.RangeFilter=function(element,options,e){e&&(e.stopPropagation(),e.preventDefault()),this.$element=jQuery(element),this.$newElement=null,this.$button=null,this.$menu=null,this.options=options,this.$startdate=null,this.$enddate=null,this.$title=null,this.init()},ns.RangeFilter.DEFAULTS=jQuery.extend({},{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),ns.RangeFilter.prototype={getDefaults:function(){return DateFilter.DEFAULTS},init:function(){this.$newElement=this.$element.find(".halo-popupfilter-content"),this.$menu=this.$newElement.find("> .halo-dropdown-menu"),this.$button=this.$newElement.find("> button"),this.$min=this.$element.find(".min-range-input"),this.$max=this.$element.find(".max-range-input"),this.$na=this.$element.find(".na-range-input"),this.$checkbox=this.$element.find(".halo-checkbox-filter"),this.$title=this.$element.find(".filter-option"),this.originalTitle=this.$title.text(),this.activeMode=null,this.clickListener(),this.updateTitle()},render:function(){},setSize:function(){var width=Math.min(jQuery(window).width()-40,400);this.$menu.css({width:width+"px"})},clickListener:function(){var that=this;this.$newElement.on("touchstart.dropdown",".halo-dropdown-menu",function(e){e.stopPropagation()}),this.$newElement.on("click",function(e){that.setSize()}),this.$menu.on("click",function(e){e.preventDefault(),e.stopPropagation()}),this.$checkbox.on("click",function(e){var input=jQuery(this).find(".halo-checkbox-input");if(input.length){var val=input.val()?"":1;input.val(val),input.trigger("change")}}),this.$element.change(function(){that.render(!1)}),this.$min.on("keypress",function(e){var code=e.keyCode||e.which;13==code&&jQuery(this).trigger("change")}),this.$min.change(function(){that.activeMode="between",that.resetValues(["$min","$max"]),that.updateTitle();var max=parseFloat(that.$max.autoNumeric("get")),min=parseFloat(that.$min.autoNumeric("get"));min>max&&(max=min),that.$max.autoNumeric("set",max)}),this.$max.on("keypress",function(e){var code=e.keyCode||e.which;13==code&&jQuery(this).trigger("change")}),this.$max.change(function(){that.activeMode="between",that.resetValues(["$min","$max"]),that.updateTitle();var max=parseFloat(that.$max.autoNumeric("get")),min=parseFloat(that.$min.autoNumeric("get"));min>max&&(min=max),that.$min.autoNumeric("set",min)}),this.$na.change(function(){jQuery(this).val()?(that.activeMode="na",that.resetValues(["$na"])):(that.activeMode="empty",that.resetValues([])),that.updateTitle()})},resetValues:function(exclusive){var keys=["$min","$max","$na"];for(var key in keys)exclusive.indexOf(keys[key])<0&&"undefined"!=typeof this[keys[key]]&&this[keys[key]].val("")},updateTitle:function(){var title=[],titleStr=this.originalTitle,that=this;switch(null===that.activeMode&&(that.$min.val()||that.$max.val()?that.activeMode="between":that.$na.val()?that.activeMode="na":that.activeMode="between"),that.activeMode){case"between":that.$min.val()&&title.push(that.$min.attr("data-halo-label")+" "+that.$min.val()),that.$max.val()&&title.push(that.$max.attr("data-halo-label")+" "+that.$max.val()),title.length&&(titleStr=titleStr+": "+title.join(" - "));break;case"na":that.$na.val()&&(titleStr=titleStr+": "+that.$na.attr("data-halo-label"))}that.setAtiveLabel(that.activeMode),that.$title.html(titleStr),that.$button.attr("title",titleStr)},setAtiveLabel:function(mode){var modes={between:"rangeBetween",na:"rangeNa",empty:"empty"};if("undefined"!=typeof modes[mode]){var selector='[data-type="'+modes[mode]+'"] .halo-option-item';this.$newElement.find(".halo-option-item").empty(),this.$newElement.find(".halo-option-item").append('<span class="fa fa-square-o"></span>'),this.$newElement.find(selector).empty(),this.$newElement.find(selector).append('<span class="fa fa-check"></span>')}}},ns.LocationFilter=function(element,options,e){e&&(e.stopPropagation(),e.preventDefault()),this.$element=jQuery(element),this.$newElement=null,this.$button=null,this.$menu=null,this.options=options,this.$startdate=null,this.$enddate=null,this.$title=null,this.init()},ns.LocationFilter.DEFAULTS=jQuery.extend({},{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),ns.LocationFilter.prototype={getDefaults:function(){return LocationFilter.DEFAULTS},init:function(){this.$newElement=this.$element.find(".halo-popupfilter-content"),this.$menu=this.$newElement.find("> .halo-dropdown-menu"),this.$button=this.$newElement.find("> button"),this.$title=this.$element.find(".filter-option"),this.$inputName=this.$element.find(".halo-field-location-name"),this.$inputLat=this.$element.find(".halo-field-location-lat"),this.$inputLng=this.$element.find(".halo-field-location-lng"),this.$distance=this.$element.find(".halo-field-location-distance"),this.clickListener(),this.render()},render:function(){this.updateTitle()},setSize:function(){var width=Math.min(jQuery(window).width()-40,400);this.$menu.css({width:width+"px"})},clickListener:function(){var that=this;this.$newElement.on("touchstart.dropdown",".halo-dropdown-menu",function(e){e.stopPropagation()}),this.$newElement.on("click",function(e){that.setSize()}),this.$menu.on("click",function(e){e.preventDefault(),e.stopPropagation()}),this.$menu.on("changeFilter.halo",function(){that.updateTitle()}),this.$distance.change(function(){that.updateTitle()})},updateTitle:function(){var titleStr=this.originalTitle;this.$inputName.val()&&this.$distance.val()&&(titleStr=this.$distance.attr("data-halo-label")+" "+this.$inputName.val()+" "+this.$distance.val()+" km"),this.$title.html(titleStr),this.$button.attr("title",titleStr)}},ns.SelectFilter=function(element,options,e){this.$element=jQuery(element),this.$newElement=this.$element.find(".halo-popupfilter-content"),this.$newElement.selectpicker({})},ns.SelectFilter.DEFAULTS=jQuery.extend({},{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),ns.TextFilter=function(element,options,e){this.$element=jQuery(element),this.$newElement=this.$element.find(".halo-popupfilter-content")},ns.TextFilter.DEFAULTS=jQuery.extend({},{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'});var old=jQuery.fn.popupfilter;jQuery.fn.popupfilter=function(option){return this.each(function(){var $this=jQuery(this),data=$this.data("bs.popupfilter"),options="object"==typeof option&&option;if(!data){var filterType=$this.attr("data-filter-type");filterType&&"undefined"!=typeof ns[filterType]?$this.data("bs.popupfilter",data=new ns[filterType](this,options)):$this.data("bs.popupfilter",data=new ns.DateFilter(this,options))}"string"==typeof option&&data[option]()})},jQuery.fn.popupfilter.noConflict=function(){return jQuery.fn.popupfilter=old,this},jQuery(document).on("change",".halo-popoverfilter-input",halo.util.throttle(function(){var $filterLabel=jQuery(this).closest(".halo-filter").find(".halo-filter-label-input"),$this=jQuery(this),params={};params[$this.attr("name")]=$this.val();$filterLabel.data("oldParams");$filterLabel.data("oldParams",halo.util.getCurrentQueryObj()),$filterLabel.trigger("change")},300)).on("changeFilter.halo","div.halo-popoverfilter-input",halo.util.throttle(function(){updateFilterGroup(jQuery(this))},300)).on("change",".halo-popoverfilter-sub-input",halo.util.throttle(function(){var $ele=jQuery(this).closest(".halo-popoverfilter-input");$ele.length&&updateFilterGroup($ele)},300))}(window.jQuery)})}(window.jQuery),+function($){"use strict";var Wizard=function(element){this.element=$(element)};Wizard.prototype.show=function(){var $this=this.element,$steps=$this.closest(".halo-wizard-steps"),selector=$this.attr("data-target");if(selector||(selector=$this.attr("href"),selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,"")),!$this.parent(".halo-wizard-step-title").hasClass("active")){var previous=$steps.find(".active:last a")[0],e=$.Event("show.bs.wizard",{relatedTarget:previous});if($this.trigger(e),!e.isDefaultPrevented()){var $target=$(selector);this.activate($this.parent(".halo-wizard-step-title"),$steps),this.activate($target,$target.parent(),function(){$this.trigger({type:"shown.bs.wizard",relatedTarget:previous})})}}},Wizard.prototype.activate=function(element,container,callback){function next(){$active.removeClass("active").find("> .halo-dropdown-menu > .active").removeClass("active"),element.addClass("active"),transition?(element[0].offsetWidth,element.addClass("in")):element.removeClass("fade"),callback&&callback()}var $active=container.find("> .active"),transition=callback&&$.support.transition&&$active.hasClass("fade");transition?$active.one($.support.transition.end,next).emulateTransitionEnd(150):next(),$active.removeClass("in")};var old=$.fn.wizard;$.fn.wizard=function(option){return this.each(function(){var $this=$(this),data=$this.data("bs.wizard");data||$this.data("bs.wizard",data=new Wizard(this)),"string"==typeof option&&data[option]()})},$.fn.wizard.Constructor=Wizard,$.fn.wizard.noConflict=function(){return $.fn.wizard=old,this},$(document).on("click.bs.wizard.data-api",'[data-htoggle="wizard"]',function(e){e.preventDefault(),$(this).parent().hasClass("disabled")||$(this).wizard("show")})}(window.jQuery),jQuery.extend(!0,halo,{scroll:{init:function(scope){if(halo.util.isMobile()){var doc=jQuery(document);doc.scrollTop()>0&&jQuery(".halo-scrolltop").show(),doc.on("scroll",function(){doc.scrollTop()>0?jQuery(".halo-scrolltop").show():jQuery(".halo-scrolltop").hide()})}else jQuery(".nicescroll-rails:not(:last-child)",jQuery(".halo-notification-wrapper").parent()).each(function(){jQuery(this).remove()}),jQuery(".halo-nicescroll, .halo-notification-content, .halo-conv-entry-wrapper,.halo-stream-more-activity ul",scope).each(function(){var $this=jQuery(this),scrollOpt={autohidemode:!1,nativeparentscrolling:!1,cursoropacitymax:.7,horizrailenabled:!1};scrollOpt=jQuery.extend({},scrollOpt,$this.data());var $scroll=$this.niceScroll(scrollOpt);$scroll.resize(),$this.closest(".halo-dropdown").length&&$this.closest(".halo-dropdown").on("hidden.bs.hdropdown",function(){$scroll.hide()}).on("shown.bs.hdropdown",function(){$scroll.show()});var $popoverContent=$this.closest(".popover");if($popoverContent.length){var $popover=halo.util.closest($this,'[data-htoggle="popover"]');$popover.length&&$popover.on("hidden.bs.hpopover",function(){$scroll.hide(),jQuery(".nicescroll-rails",$popoverContent).remove()}).on("shown.bs.hpopover",function(){$scroll.show()})}})}}});